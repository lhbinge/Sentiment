##===============================##
## READING IN THE DATA: BUILDING ##
##===============================##
#BER.B1 <- read.csv("Building.csv", header=TRUE, sep=";",na.strings = "", skipNul = TRUE)
#BER.B2 <- read.csv("Building_pre2001.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
BER.B <- rbind.fill(read.csv("Building.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE),
read.csv("Building_pre2001.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE))
BER.B <- BER.B[,1:22]
colnames(BER.B)[1:6] <- c("region","id","sector","weight","factor","surveyQ")
BER.B$surveyQ <- toupper(BER.B$surveyQ)
BER.B[nrow(BER.B)+1,1:5] <- BER.B[nrow(BER.B),1:5]
BER.B[nrow(BER.B),"surveyQ"] <- "2005Q4"
BER.B[nrow(BER.B)+1,1:5] <- BER.B[nrow(BER.B),1:5]
BER.B[nrow(BER.B),"surveyQ"] <- "1998Q3"
BER.B[nrow(BER.B)+1,1:5] <- BER.B[nrow(BER.B),1:5]
BER.B[nrow(BER.B),"surveyQ"] <- "1993Q4"
BER.B[nrow(BER.B)+1,1:5] <- BER.B[nrow(BER.B),1:5]
BER.B[nrow(BER.B),"surveyQ"] <- "2000Q2"
BER.B$region <- factor(BER.B$region)
BER.B$sector <- factor(BER.B$sector) #could include labels
BER.B$id <- factor(BER.B$id)
BER.B$surveyQ <- factor(BER.B$surveyQ)
#BER.B$surveyQ <- factor(BER.B$surveyQ, levels=c(levels(BER.B$surveyQ),"05Q4"))
# replace 1,2,3 (Up, Same, Down) responses with 1,0,-1
for(i in 7:22) {
BER.B[,i] <- replace(BER.B[,i], BER.B[,i]==2, 0)
BER.B[,i] <- replace(BER.B[,i], BER.B[,i]==3,-1)
}
BER.B$Q1 <- replace(BER.B$Q1, BER.B$Q1==0,-1) # replace 0 (Unsatisfactory) responses with -1
##Weighted versions--------------------------------------------------------------------------------------------------------------------
w.Conf_cc <- NULL
w.Act_prod <- NULL
w.Conf_prod <- NULL
w.Act_GBC <- NULL
w.Conf_GBC <- NULL
w.Empl <- NULL
i <- 0
for(kwartaal in levels(BER.B$surveyQ)) {
i <- i+1
temp <- subset(BER.B,BER.B$surveyQ==kwartaal)
w.Conf_cc[i] <- sum(temp$Q1*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q1)], na.rm=TRUE)
w.Act_prod[i] <- sum(temp$Q3A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3A)], na.rm=TRUE)
w.Conf_prod[i] <- sum(temp$Q3P*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)], na.rm=TRUE)
w.Act_GBC[i] <- sum(temp$Q2A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2A)], na.rm=TRUE)
w.Conf_GBC[i] <- sum(temp$Q2P*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)], na.rm=TRUE)
w.Empl[i] <- sum(temp$Q4A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q4A)], na.rm=TRUE)
}
w.indicators.B <- as.data.frame(cbind(w.Conf_cc,w.Act_prod,w.Conf_prod,w.Act_GBC,w.Conf_GBC,w.Empl))
w.indicators.B <- cbind(Date=levels(BER.B$surveyQ),w.indicators.B)
#---------------------------------------------------------------------------------------------------------------------------------------
w.Uncert_fl.prod <- NULL
w.Uncert_fl.GBC <- NULL
i <- 0
for(kwartaal in levels(BER.B$surveyQ)) {
i <- i+1
temp <- subset(BER.B,BER.B$surveyQ==kwartaal)
fr.up <- sum((temp$Q3P*temp$factor)[temp$Q3P>0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)],na.rm=TRUE)
fr.down <- sum((temp$Q3P*temp$factor)[temp$Q3P<0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)],na.rm=TRUE)
w.Uncert_fl.prod[i] <- sqrt(fr.up-fr.down-(fr.up+fr.down)^2)
fr.up <- sum((temp$Q2P*temp$factor)[temp$Q2P>0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)],na.rm=TRUE)
fr.down <- sum((temp$Q2P*temp$factor)[temp$Q2P<0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)],na.rm=TRUE)
w.Uncert_fl.GBC[i] <- sqrt(fr.up-fr.down-(fr.up+fr.down)^2)
}
w.indicators.B <- cbind(w.indicators.B,w.Uncert_fl.prod,w.Uncert_fl.GBC)
#---------------------------------------------------------------------------
View(w.indicators.B)
indicators.B <- aggregate(BER.B$Q1, by=list(BER.B$surveyQ), FUN=mean, na.rm=TRUE)
colnames(indicators.B) <- c("Date","Conf_cc")
indicators.B <- cbind(indicators.B, Act_prod = aggregate(BER.B$Q3A, by=list(BER.B$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.B <- cbind(indicators.B, Conf_prod = aggregate(BER.B$Q3P, by=list(BER.B$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.B <- cbind(indicators.B, Act_GBC = aggregate(BER.B$Q2A, by=list(BER.B$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.B <- cbind(indicators.B, Conf_GBC = aggregate(BER.B$Q2P, by=list(BER.B$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.B <- cbind(indicators.B, Empl = aggregate(BER.B$Q4A, by=list(BER.B$surveyQ), FUN=mean, na.rm=TRUE)[,2])
altBER <- BER.B
altBER$Q4A <- replace(altBER$Q4A, altBER$Q4A==-1,1) # replace -1 (Down) responses with 1
indicators.B <- cbind(indicators.B, Empl_turn = aggregate(altBER$Q4A, by=list(altBER$surveyQ), FUN=mean, na.rm=TRUE)[,2])
# Kan dit verander na standard error or standard deviation?
se <- function(x) sqrt(var(x,na.rm=TRUE)/length(na.omit(x))*(length(na.omit(x))-1)) #adjust for (n-1)
indicators.B <- cbind(indicators.B, Uncert_fl.prod = aggregate(BER.B$Q3P, by=list(BER.B$surveyQ), FUN=se)[,2])
indicators.B <- cbind(indicators.B, Uncert_fl.GBC = aggregate(BER.B$Q2P, by=list(BER.B$surveyQ), FUN=se)[,2])
View(indicators.B)
##============================##
## READING IN THE DATA: TRADE ##
##============================##
BER.R <- read.csv("Retail.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
BER.W <- read.csv("Wholesale.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
#BER.V <- read.csv("Motor.csv", header=TRUE, sep=";",na.strings = "", skipNul = TRUE)
BER.T <- rbind(BER.R,BER.W)
BER.T <- rbind.fill(BER.T,read.csv("Trade_pre2001.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE))
BER.T <- BER.T[,1:21]
colnames(BER.T)[1:6] <- c("region","id","sector","weight","factor","surveyQ")
BER.T$surveyQ <- toupper(BER.T$surveyQ)
BER.T[nrow(BER.T)+1,1:5] <- BER.T[nrow(BER.T),1:5]
BER.T[nrow(BER.T),"surveyQ"] <- "2005Q4"
BER.T[nrow(BER.T)+1,1:5] <- BER.T[nrow(BER.T),1:5]
BER.T[nrow(BER.T),"surveyQ"] <- "1993Q3"
BER.T[nrow(BER.T)+1,1:5] <- BER.T[nrow(BER.T),1:5]
BER.T[nrow(BER.T),"surveyQ"] <- "1992Q4"
BER.T$region <- factor(BER.T$region)
BER.T$sector <- factor(BER.T$sector) #could include labels
BER.T$id <- factor(BER.T$id)
BER.T$surveyQ <- factor(BER.T$surveyQ)
#BER.T$surveyQ <- factor(BER.T$surveyQ, levels=c(levels(BER.T$surveyQ),"05Q4"))
# replace 1,2,3 (Up, Same, Down) responses with 1,0,-1
for(i in 7:21) {
BER.T[,i] <- replace(BER.T[,i], BER.T[,i]==2, 0)
BER.T[,i] <- replace(BER.T[,i], BER.T[,i]==3,-1)
}
BER.T$Q1 <- replace(BER.T$Q1, BER.T$Q1==0,-1) # replace 0 (Unsatisfactory) responses with -1
##=============================##
## CALCULATE INDICATORS: TRADE ##
##=============================##
indicators.T <- aggregate(BER.T$Q1, by=list(BER.T$surveyQ), FUN=mean, na.rm=TRUE)
colnames(indicators.T) <- c("Date","Conf_cc")
indicators.T <- cbind(indicators.T, Act_prod = aggregate(BER.T$Q3A, by=list(BER.T$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.T <- cbind(indicators.T, Conf_prod = aggregate(BER.T$Q3P, by=list(BER.T$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.T <- cbind(indicators.T, Act_GBC = aggregate(BER.T$Q2A, by=list(BER.T$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.T <- cbind(indicators.T, Conf_GBC = aggregate(BER.T$Q2P, by=list(BER.T$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.T <- cbind(indicators.T, Empl = aggregate(BER.T$Q5A, by=list(BER.T$surveyQ), FUN=mean, na.rm=TRUE)[,2])
altBER <- BER.T
altBER$Q5A <- replace(altBER$Q5A, altBER$Q5A==-1,1) # replace -1 (Down) responses with 1
indicators.T <- cbind(indicators.T, Empl_turn = aggregate(altBER$Q5A, by=list(altBER$surveyQ), FUN=mean, na.rm=TRUE)[,2])
# Kan dit verander na standard error or standard deviation?
se <- function(x) sqrt(var(x,na.rm=TRUE)/length(na.omit(x))*(length(na.omit(x))-1)) #adjust for (n-1)
indicators.T <- cbind(indicators.T, Uncert_fl.prod = aggregate(BER.T$Q3P, by=list(BER.T$surveyQ), FUN=se)[,2])
indicators.T <- cbind(indicators.T, Uncert_fl.GBC = aggregate(BER.T$Q2P, by=list(BER.T$surveyQ), FUN=se)[,2])
dups <- BER.T[duplicated(BER.T[,c("id","surveyQ")]) | duplicated(BER.T[,c("id","surveyQ")], fromLast = TRUE),]
uniBER.T <- BER.T[!duplicated(BER.T[,c("id","surveyQ")]),]
errors1 <- indicators.T[,c(1,9)]
errors2 <- indicators.T[,c(1,9)]
tel <- 2
for(i in levels(uniBER.T$id)){
tel <- tel + 1
#BER.T$counter <- as.numeric(BER.T$survey)
exp.error <- indicators.T[,c(1,9)]
data <- subset(uniBER.T, uniBER.T$id==i)
#data <- data[order(data$counter),]
exp.error <- merge(exp.error, data, by.x="Date",by.y="surveyQ", all.x = TRUE)
for(t in 1:(nrow(exp.error))) {
exp.error$error1[t] <- exp.error$Q3A[t+1] - exp.error$Q3P[t]
exp.error$error2[t] <- exp.error$Q2A[t+1] - exp.error$Q2P[t]
}
errors1 <- cbind(errors1, exp.error$error1)
colnames(errors1)[tel] <- as.character(i)
errors2 <- cbind(errors2, exp.error$error2)
colnames(errors2)[tel] <- as.character(i)
}
# Kan dit verander na standard error or standard deviation?
uncert <- transform(errors1, SD=apply(errors1[,c(-1,-2)],1,se))[,c(1,ncol(errors1)+1)]
indicators.T <- cbind(indicators.T, Uncert_ee.prod = uncert[,2])
uncert <- transform(errors2, SD=apply(errors2[,c(-1,-2)],1,se))[,c(1,ncol(errors2)+1)]
indicators.T <- cbind(indicators.T, Uncert_ee.GBC = uncert[,2])
##Weighted versions--------------------------------------------------------------------------------------------------------------------
w.Conf_cc <- NULL
w.Act_prod <- NULL
w.Conf_prod <- NULL
w.Act_GBC <- NULL
w.Conf_GBC <- NULL
w.Empl <- NULL
i <- 0
for(kwartaal in levels(BER.T$surveyQ)) {
i <- i+1
temp <- subset(BER.T,BER.T$surveyQ==kwartaal)
w.Conf_cc[i] <- sum(temp$Q1*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q1)], na.rm=TRUE)
w.Act_prod[i] <- sum(temp$Q3A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3A)], na.rm=TRUE)
w.Conf_prod[i] <- sum(temp$Q3P*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)], na.rm=TRUE)
w.Act_GBC[i] <- sum(temp$Q2A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2A)], na.rm=TRUE)
w.Conf_GBC[i] <- sum(temp$Q2P*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)], na.rm=TRUE)
w.Empl[i] <- sum(temp$Q5A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q5A)], na.rm=TRUE)
}
w.indicators.T <- as.data.frame(cbind(w.Conf_cc,w.Act_prod,w.Conf_prod,w.Act_GBC,w.Conf_GBC,w.Empl))
w.indicators.T <- cbind(Date=levels(BER.T$surveyQ),w.indicators.T)
#---------------------------------------------------------------------------------------------------------------------------------------
w.Uncert_fl.prod <- NULL
w.Uncert_fl.GBC <- NULL
i <- 0
for(kwartaal in levels(BER.T$surveyQ)) {
i <- i+1
temp <- subset(BER.T,BER.T$surveyQ==kwartaal)
fr.up <- sum((temp$Q3P*temp$factor)[temp$Q3P>0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)],na.rm=TRUE)
fr.down <- sum((temp$Q3P*temp$factor)[temp$Q3P<0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)],na.rm=TRUE)
w.Uncert_fl.prod[i] <- sqrt(fr.up-fr.down-(fr.up+fr.down)^2)
fr.up <- sum((temp$Q2P*temp$factor)[temp$Q2P>0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)],na.rm=TRUE)
fr.down <- sum((temp$Q2P*temp$factor)[temp$Q2P<0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)],na.rm=TRUE)
w.Uncert_fl.GBC[i] <- sqrt(fr.up-fr.down-(fr.up+fr.down)^2)
}
w.indicators.T <- cbind(w.indicators.T,w.Uncert_fl.prod,w.Uncert_fl.GBC)
#---------------------------------------------------------------------------------------------------------------------------------------
View(w.indicators.T)
View(indicators.T)
dups <- BER.B[duplicated(BER.B[,c("id","surveyQ")]) | duplicated(BER.B[,c("id","surveyQ")], fromLast = TRUE),]
uniBER.B <- BER.B[!duplicated(BER.B[,c("id","surveyQ")]),]
errors1 <- indicators.B[,c(1,9)]
errors2 <- indicators.B[,c(1,9)]
tel <- 2
for(i in levels(uniBER.B$id)){
tel <- tel + 1
#BER.B$counter <- as.numeric(BER.B$survey)
exp.error <- indicators.B[,c(1,9)]
data <- subset(uniBER.B, uniBER.B$id==i)
#data <- data[order(data$counter),]
exp.error <- merge(exp.error, data, by.x="Date",by.y="surveyQ", all.x = TRUE)
for(t in 1:(nrow(exp.error))) {
exp.error$error1[t] <- exp.error$Q3A[t+1] - exp.error$Q3P[t]
exp.error$error2[t] <- exp.error$Q2A[t+1] - exp.error$Q2P[t]
}
errors1 <- cbind(errors1, exp.error$error1)
colnames(errors1)[tel] <- as.character(i)
errors2 <- cbind(errors2, exp.error$error2)
colnames(errors2)[tel] <- as.character(i)
}
# Kan dit verander na standard error or standard deviation?
uncert <- transform(errors1, SD=apply(errors1[,c(-1,-2)],1,se))[,c(1,ncol(errors1)+1)]
indicators.B <- cbind(indicators.B, Uncert_ee.prod = uncert[,2])
uncert <- transform(errors2, SD=apply(errors2[,c(-1,-2)],1,se))[,c(1,ncol(errors2)+1)]
indicators.B <- cbind(indicators.B, Uncert_ee.GBC = uncert[,2])
View(indicators.B)
##=====================================##
## READING IN THE DATA: Motor Vehicles ##
##=====================================##
#BER.V1 <- read.csv("Motor.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
#BER.V2 <- read.csv("Motor_pre2001.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
BER.V <- rbind.fill(read.csv("Motor.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE),
read.csv("Motor_pre2001.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE))
BER.V <- BER.V[,1:28]
colnames(BER.V)[1:6] <- c("region","id","sector","weight","factor","surveyQ")
BER.V$surveyQ <- toupper(BER.V$surveyQ)
BER.V[nrow(BER.V)+1,1:5] <- BER.V[nrow(BER.V),1:5]
BER.V[nrow(BER.V),"surveyQ"] <- "2005Q4"
BER.V[nrow(BER.V)+1,1:5] <- BER.V[nrow(BER.V),1:5]
BER.V[nrow(BER.V),"surveyQ"] <- "1992Q4"
BER.V[nrow(BER.V)+1,1:5] <- BER.V[nrow(BER.V),1:5]
BER.V[nrow(BER.V),"surveyQ"] <- "1993Q3"
BER.V$region <- factor(BER.V$region)
BER.V$sector <- factor(BER.V$sector) #could include labels
BER.V$id <- factor(BER.V$id)
BER.V$surveyQ <- factor(BER.V$surveyQ)
#BER.V$surveyQ <- factor(BER.V$surveyQ, levels=c(levels(BER.V$surveyQ),"05Q4"))
# replace 1,2,3 (Up, Same, Down) responses with 1,0,-1
for(i in 7:28) {
BER.V[,i] <- replace(BER.V[,i], BER.V[,i]==2, 0)
BER.V[,i] <- replace(BER.V[,i], BER.V[,i]==3,-1)
}
BER.V$Q1 <- replace(BER.V$Q1, BER.V$Q1==0,-1) # replace 0 (Unsatisfactory) responses with -1
BER.V$Q6 <- replace(BER.V$Q6, BER.V$Q6==0,-1) # replace 0 (Unsatisfactory) responses with -1
BER.V$Q10 <- replace(BER.V$Q10, BER.V$Q10==0,-1) # replace 0 (Unsatisfactory) responses with -1
##======================================##
## CALCULATE INDICATORS: Motor Vehicles ##
##======================================##
indicators.V <- aggregate(BER.V$Q1, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)
colnames(indicators.V) <- c("Date","Conf_cc.new")
indicators.V <- cbind(indicators.V, Conf_cc.used = aggregate(BER.V$Q6, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Conf_cc.spare = aggregate(BER.V$Q10, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Act_prod.new = aggregate(BER.V$Q3A, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Act_prod.used = aggregate(BER.V$Q8A, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Act_prod.spare = aggregate(BER.V$Q12A, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Conf_prod.new = aggregate(BER.V$Q3P, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Conf_prod.used = aggregate(BER.V$Q8P, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Conf_prod.spare = aggregate(BER.V$Q12P, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Act_GBC.new = aggregate(BER.V$Q2A, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Act_GBC.used = aggregate(BER.V$Q7A, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Act_GBC.spare = aggregate(BER.V$Q11A, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Conf_GBC.new = aggregate(BER.V$Q2P, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Conf_GBC.used = aggregate(BER.V$Q7P, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.V <- cbind(indicators.V, Conf_GBC.spare = aggregate(BER.V$Q11P, by=list(BER.V$surveyQ), FUN=mean, na.rm=TRUE)[,2])
# Kan dit verander na standard error or standard deviation?
se <- function(x) sqrt(var(x,na.rm=TRUE)/length(na.omit(x))*(length(na.omit(x))-1)) #adjust for (n-1)
indicators.V <- cbind(indicators.V, Uncert_fl.prod.new = aggregate(BER.V$Q3P, by=list(BER.V$surveyQ), FUN=se)[,2])
indicators.V <- cbind(indicators.V, Uncert_fl.prod.used = aggregate(BER.V$Q8P, by=list(BER.V$surveyQ), FUN=se)[,2])
indicators.V <- cbind(indicators.V, Uncert_fl.prod.spare = aggregate(BER.V$Q12P, by=list(BER.V$surveyQ), FUN=se)[,2])
indicators.V <- cbind(indicators.V, Uncert_fl.GBC.new = aggregate(BER.V$Q2P, by=list(BER.V$surveyQ), FUN=se)[,2])
indicators.V <- cbind(indicators.V, Uncert_fl.GBC.used = aggregate(BER.V$Q7P, by=list(BER.V$surveyQ), FUN=se)[,2])
indicators.V <- cbind(indicators.V, Uncert_fl.GBC.spare = aggregate(BER.V$Q11P, by=list(BER.V$surveyQ), FUN=se)[,2])
dups <- BER.V[duplicated(BER.V[,c("id","surveyQ")]) | duplicated(BER.V[,c("id","surveyQ")], fromLast = TRUE),]
uniBER.V <- BER.V[!duplicated(BER.V[,c("id","surveyQ")]),]
errors1 <- indicators.V[,c(1,9)]
errors2 <- indicators.V[,c(1,9)]
errors3 <- indicators.V[,c(1,9)]
errors4 <- indicators.V[,c(1,9)]
errors5 <- indicators.V[,c(1,9)]
errors6 <- indicators.V[,c(1,9)]
tel <- 2
for(i in levels(uniBER.V$id)){
tel <- tel + 1
#BER.V$counter <- as.numeric(BER.V$survey)
exp.error <- indicators.V[,c(1,9)]
data <- subset(uniBER.V, uniBER.V$id==i)
#data <- data[order(data$counter),]
exp.error <- merge(exp.error, data, by.x="Date",by.y="surveyQ", all.x = TRUE)
for(t in 1:(nrow(exp.error))) {
exp.error$error1[t] <- exp.error$Q3A[t+1] - exp.error$Q3P[t]
exp.error$error2[t] <- exp.error$Q2A[t+1] - exp.error$Q2P[t]
exp.error$error3[t] <- exp.error$Q8A[t+1] - exp.error$Q8P[t]
exp.error$error4[t] <- exp.error$Q7A[t+1] - exp.error$Q7P[t]
exp.error$error5[t] <- exp.error$Q12A[t+1] - exp.error$Q12P[t]
exp.error$error6[t] <- exp.error$Q11A[t+1] - exp.error$Q11P[t]
}
errors1 <- cbind(errors1, exp.error$error1)
colnames(errors1)[tel] <- as.character(i)
errors2 <- cbind(errors2, exp.error$error2)
colnames(errors2)[tel] <- as.character(i)
errors3 <- cbind(errors3, exp.error$error3)
colnames(errors3)[tel] <- as.character(i)
errors4 <- cbind(errors4, exp.error$error4)
colnames(errors4)[tel] <- as.character(i)
errors5 <- cbind(errors5, exp.error$error5)
colnames(errors5)[tel] <- as.character(i)
errors6 <- cbind(errors6, exp.error$error6)
colnames(errors6)[tel] <- as.character(i)
}
# Kan dit verander na standard error or standard deviation?
uncert <- transform(errors1, SD=apply(errors1[,c(-1,-2)],1,se))[,c(1,ncol(errors1)+1)]
indicators.V <- cbind(indicators.V, Uncert_ee.prod.new = uncert[,2])
uncert <- transform(errors2, SD=apply(errors2[,c(-1,-2)],1,se))[,c(1,ncol(errors2)+1)]
indicators.V <- cbind(indicators.V, Uncert_ee.GBC.new = uncert[,2])
uncert <- transform(errors1, SD=apply(errors3[,c(-1,-2)],1,se))[,c(1,ncol(errors3)+1)]
indicators.V <- cbind(indicators.V, Uncert_ee.prod.used = uncert[,2])
uncert <- transform(errors2, SD=apply(errors4[,c(-1,-2)],1,se))[,c(1,ncol(errors4)+1)]
indicators.V <- cbind(indicators.V, Uncert_ee.GBC.used = uncert[,2])
uncert <- transform(errors1, SD=apply(errors5[,c(-1,-2)],1,se))[,c(1,ncol(errors5)+1)]
indicators.V <- cbind(indicators.V, Uncert_ee.prod.spare = uncert[,2])
uncert <- transform(errors2, SD=apply(errors6[,c(-1,-2)],1,se))[,c(1,ncol(errors6)+1)]
indicators.V <- cbind(indicators.V, Uncert_ee.GBC.spare = uncert[,2])
##Weighted versions--------------------------------------------------------------------------------------------------------------------
w.Conf_cc <- NULL
w.Act_prod <- NULL
w.Conf_prod <- NULL
w.Act_GBC <- NULL
w.Conf_GBC <- NULL
i <- 0
for(kwartaal in levels(BER.V$surveyQ)) {
i <- i+1
temp <- subset(BER.V,BER.V$surveyQ==kwartaal)
w.Conf_cc[i] <- sum(temp$Q1*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q1)], na.rm=TRUE)
w.Act_prod[i] <- sum(temp$Q3A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3A)], na.rm=TRUE)
w.Conf_prod[i] <- sum(temp$Q3P*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)], na.rm=TRUE)
w.Act_GBC[i] <- sum(temp$Q2A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2A)], na.rm=TRUE)
w.Conf_GBC[i] <- sum(temp$Q2P*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)], na.rm=TRUE)
}
w.indicators.V <- as.data.frame(cbind(w.Conf_cc,w.Act_prod,w.Conf_prod,w.Act_GBC,w.Conf_GBC,w.Empl))
w.indicators.V <- cbind(Date=levels(BER.V$surveyQ),w.indicators.V)
#---------------------------------------------------------------------------------------------------------------------------------------
w.Uncert_fl.prod <- NULL
w.Uncert_fl.GBC <- NULL
i <- 0
for(kwartaal in levels(BER.V$surveyQ)) {
i <- i+1
temp <- subset(BER.V,BER.V$surveyQ==kwartaal)
fr.up <- sum((temp$Q3P*temp$factor)[temp$Q3P>0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)],na.rm=TRUE)
fr.down <- sum((temp$Q3P*temp$factor)[temp$Q3P<0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)],na.rm=TRUE)
w.Uncert_fl.prod[i] <- sqrt(fr.up-fr.down-(fr.up+fr.down)^2)
fr.up <- sum((temp$Q2P*temp$factor)[temp$Q2P>0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)],na.rm=TRUE)
fr.down <- sum((temp$Q2P*temp$factor)[temp$Q2P<0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)],na.rm=TRUE)
w.Uncert_fl.GBC[i] <- sqrt(fr.up-fr.down-(fr.up+fr.down)^2)
}
w.indicators.V <- cbind(w.indicators.V,w.Uncert_fl.prod,w.Uncert_fl.GBC)
#---------------------------------------------------------------------------------------------------------------------------------------
View(w.indicators.V)
View(indicators.V)
##===============================##
## READING IN THE DATA: SERVICES ##
##===============================##
BER.S <- read.csv("Services.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
colnames(BER.S)[1:6] <- c("region","id","sector","weight","factor","surveyQ")
BER.S$surveyQ <- toupper(BER.S$surveyQ)
BER.S[nrow(BER.S)+1,1:5] <- BER.S[nrow(BER.S),1:5]
BER.S[nrow(BER.S),"surveyQ"] <- "2005Q4"
BER.S$region <- factor(BER.S$region)
BER.S$sector <- factor(BER.S$sector) #could include labels
BER.S$id <- factor(BER.S$id)
BER.S$surveyQ <- factor(BER.S$surveyQ)
#BER.S$surveyQ <- factor(BER.S$surveyQ, levels=c(levels(BER.S$surveyQ),"05Q4"))
# replace 1,2,3 (Up, Same, Down) responses with 1,0,-1
for(i in 7:21) {
BER.S[,i] <- replace(BER.S[,i], BER.S[,i]==2, 0)
BER.S[,i] <- replace(BER.S[,i], BER.S[,i]==3,-1)
}
BER.S$Q1 <- replace(BER.S$Q1, BER.S$Q1==0,-1) # replace 0 (Unsatisfactory) responses with -1
##================================##
## CALCULATE INDICATORS: SERVICES ##
##================================##
indicators.S <- aggregate(BER.S$Q1, by=list(BER.S$surveyQ), FUN=mean, na.rm=TRUE)
colnames(indicators.S) <- c("Date","Conf_cc")
indicators.S <- cbind(indicators.S, Act_prod = aggregate(BER.S$Q3A, by=list(BER.S$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.S <- cbind(indicators.S, Conf_prod = aggregate(BER.S$Q3P, by=list(BER.S$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.S <- cbind(indicators.S, Act_GBC = aggregate(BER.S$Q2A, by=list(BER.S$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.S <- cbind(indicators.S, Conf_GBC = aggregate(BER.S$Q2P, by=list(BER.S$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators.S <- cbind(indicators.S, Empl = aggregate(BER.S$Q4A, by=list(BER.S$surveyQ), FUN=mean, na.rm=TRUE)[,2])
altBER <- BER.S
altBER$Q4A <- replace(altBER$Q4A, altBER$Q4A==-1,1) # replace -1 (Down) responses with 1
indicators.S <- cbind(indicators.S, Empl_turn = aggregate(altBER$Q4A, by=list(altBER$surveyQ), FUN=mean, na.rm=TRUE)[,2])
# Kan dit verander na standard error or standard deviation?
se <- function(x) sqrt(var(x,na.rm=TRUE)/length(na.omit(x))*(length(na.omit(x))-1)) #adjust for (n-1)
indicators.S <- cbind(indicators.S, Uncert_fl.prod = aggregate(BER.S$Q3P, by=list(BER.S$surveyQ), FUN=se)[,2])
indicators.S <- cbind(indicators.S, Uncert_fl.GBC = aggregate(BER.S$Q2P, by=list(BER.S$surveyQ), FUN=se)[,2])
dups <- BER.S[duplicated(BER.S[,c("id","surveyQ")]) | duplicated(BER.S[,c("id","surveyQ")], fromLast = TRUE),]
uniBER.S <- BER.S[!duplicated(BER.S[,c("id","surveyQ")]),]
errors1 <- indicators.S[,c(1,9)]
errors2 <- indicators.S[,c(1,9)]
tel <- 2
for(i in levels(uniBER.S$id)){
tel <- tel + 1
#BER.S$counter <- as.numeric(BER.S$survey)
exp.error <- indicators.S[,c(1,9)]
data <- subset(uniBER.S, uniBER.S$id==i)
#data <- data[order(data$counter),]
exp.error <- merge(exp.error, data, by.x="Date",by.y="surveyQ", all.x = TRUE)
for(t in 1:(nrow(exp.error))) {
exp.error$error1[t] <- exp.error$Q3A[t+1] - exp.error$Q3P[t]
exp.error$error2[t] <- exp.error$Q2A[t+1] - exp.error$Q2P[t]
}
errors1 <- cbind(errors1, exp.error$error1)
colnames(errors1)[tel] <- as.character(i)
errors2 <- cbind(errors2, exp.error$error2)
colnames(errors2)[tel] <- as.character(i)
}
# Kan dit verander na standard error or standard deviation?
uncert <- transform(errors1, SD=apply(errors1[,c(-1,-2)],1,se))[,c(1,ncol(errors1)+1)]
indicators.S <- cbind(indicators.S, Uncert_ee.prod = uncert[,2])
uncert <- transform(errors2, SD=apply(errors2[,c(-1,-2)],1,se))[,c(1,ncol(errors2)+1)]
indicators.S <- cbind(indicators.S, Uncert_ee.GBC = uncert[,2])
##Weighted versions--------------------------------------------------------------------------------------------------------------------
w.Conf_cc <- NULL
w.Act_prod <- NULL
w.Conf_prod <- NULL
w.Act_GBC <- NULL
w.Conf_GBC <- NULL
w.Empl <- NULL
i <- 0
for(kwartaal in levels(BER.S$surveyQ)) {
i <- i+1
temp <- subset(BER.S,BER.S$surveyQ==kwartaal)
w.Conf_cc[i] <- sum(temp$Q1*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q1)], na.rm=TRUE)
w.Act_prod[i] <- sum(temp$Q3A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3A)], na.rm=TRUE)
w.Conf_prod[i] <- sum(temp$Q3P*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)], na.rm=TRUE)
w.Act_GBC[i] <- sum(temp$Q2A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2A)], na.rm=TRUE)
w.Conf_GBC[i] <- sum(temp$Q2P*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)], na.rm=TRUE)
w.Empl[i] <- sum(temp$Q4A*temp$factor, na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q4A)], na.rm=TRUE)
}
w.indicators.S <- as.data.frame(cbind(w.Conf_cc,w.Act_prod,w.Conf_prod,w.Act_GBC,w.Conf_GBC,w.Empl))
w.indicators.S <- cbind(Date=levels(BER.S$surveyQ),w.indicators.S)
#---------------------------------------------------------------------------------------------------------------------------------------
w.Uncert_fl.prod <- NULL
w.Uncert_fl.GBC <- NULL
i <- 0
for(kwartaal in levels(BER.S$surveyQ)) {
i <- i+1
temp <- subset(BER.S,BER.S$surveyQ==kwartaal)
fr.up <- sum((temp$Q3P*temp$factor)[temp$Q3P>0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)],na.rm=TRUE)
fr.down <- sum((temp$Q3P*temp$factor)[temp$Q3P<0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q3P)],na.rm=TRUE)
w.Uncert_fl.prod[i] <- sqrt(fr.up-fr.down-(fr.up+fr.down)^2)
fr.up <- sum((temp$Q2P*temp$factor)[temp$Q2P>0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)],na.rm=TRUE)
fr.down <- sum((temp$Q2P*temp$factor)[temp$Q2P<0], na.rm=TRUE)/sum(temp$factor[!is.na(temp$Q2P)],na.rm=TRUE)
w.Uncert_fl.GBC[i] <- sqrt(fr.up-fr.down-(fr.up+fr.down)^2)
}
w.indicators.S <- cbind(w.indicators.S,w.Uncert_fl.prod,w.Uncert_fl.GBC)
#---------------------------------------------------------------------------------------------------------------------------------------
View(w.indicators.S)
View(indicators.S)
#Rename BER.B$Q5A temporarily and create NAs for BER.V$empl
tempBER.M <- BER.M[,c("id","surveyQ","Q20","Q3A","Q3P","Q7A","Q7P","Q8A")]
colnames(tempBER.M) <- c("id","surveyQ","Q1","Q3A","Q3P","Q2A","Q2P","Q4A")
tempBER.T <- BER.T[,c("id","surveyQ","Q1","Q3A","Q3P","Q2A","Q2P","Q5A")]
colnames(tempBER.T) <- c("id","surveyQ","Q1","Q3A","Q3P","Q2A","Q2P","Q4A")
tempBER.V <- BER.V[,c("id","surveyQ","Q1","Q3A","Q3P","Q2A","Q2P","Q4A")]
tempBER.V[,"Q4A"] <- NA
BER <- tempBER.M
BER <- rbind(BER,BER.B[,c("id","surveyQ","Q1","Q3A","Q3P","Q2A","Q2P","Q4A")],tempBER.T,tempBER.V,
BER.S[,c("id","surveyQ","Q1","Q3A","Q3P","Q2A","Q2P","Q4A")])
indicators <- aggregate(BER$Q1, by=list(BER$surveyQ), FUN=mean, na.rm=TRUE)
colnames(indicators) <- c("Date","Conf_cc")
indicators <- cbind(indicators, Act_prod = aggregate(BER$Q3A, by=list(BER$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators <- cbind(indicators, Conf_prod = aggregate(BER$Q3P, by=list(BER$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators <- cbind(indicators, Act_GBC = aggregate(BER$Q2A, by=list(BER$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators <- cbind(indicators, Conf_GBC = aggregate(BER$Q2P, by=list(BER$surveyQ), FUN=mean, na.rm=TRUE)[,2])
indicators <- cbind(indicators, Empl = aggregate(BER$Q4A, by=list(BER$surveyQ), FUN=mean, na.rm=TRUE)[,2])
altBER <- BER
altBER$Q4A <- replace(altBER$Q4A, altBER$Q4A==-1,1) # replace -1 (Down) responses with 1
indicators <- cbind(indicators, Empl_turn = aggregate(altBER$Q4A, by=list(altBER$surveyQ), FUN=mean, na.rm=TRUE)[,2])
# Kan dit verander na standard error or standard deviation?
se <- function(x) sqrt(var(x,na.rm=TRUE)/length(na.omit(x))*(length(na.omit(x))-1)) #adjust for (n-1)
indicators <- cbind(indicators, Uncert_fl.prod = aggregate(BER$Q3P, by=list(BER$surveyQ), FUN=se)[,2])
indicators <- cbind(indicators, Uncert_fl.GBC = aggregate(BER$Q2P, by=list(BER$surveyQ), FUN=se)[,2])
#The expectations of firms in question 31 in period t are compared to the realization of firms in question 7A in period t+4.
#Also compare the expectations of firms in questions 3P & 7P in period t to the realizations in questions 3A & 7A in period t+1.
dups <- BER[duplicated(BER[,c("id","surveyQ")]) | duplicated(BER[,c("id","surveyQ")], fromLast = TRUE),]
uniBER <- BER[!duplicated(BER[,c("id","surveyQ")]),]
errors1 <- indicators[,c(1,9)]
errors2 <- indicators[,c(1,9)]
tel <- 2
for(i in levels(uniBER$id)){
tel <- tel + 1
#BER.S$counter <- as.numeric(BER.S$survey)
exp.error <- indicators[,c(1,9)]
data <- subset(uniBER, uniBER$id==i)
#data <- data[order(data$counter),]
exp.error <- merge(exp.error, data, by.x="Date",by.y="surveyQ", all.x = TRUE)
for(t in 1:(nrow(exp.error))) {
exp.error$error1[t] <- exp.error$Q3A[t+1] - exp.error$Q3P[t]
exp.error$error2[t] <- exp.error$Q2A[t+1] - exp.error$Q2P[t]
}
errors1 <- cbind(errors1, exp.error$error1)
colnames(errors1)[tel] <- as.character(i)
errors2 <- cbind(errors2, exp.error$error2)
colnames(errors2)[tel] <- as.character(i)
}
# Kan dit verander na standard error or standard deviation?
uncert <- transform(errors1, SD=apply(errors1[,c(-1,-2)],1,se))[,c(1,ncol(errors1)+1)]
indicators <- cbind(indicators, Uncert_ee.prod = uncert[,2])
uncert <- transform(errors2, SD=apply(errors2[,c(-1,-2)],1,se))[,c(1,ncol(errors2)+1)]
indicators <- cbind(indicators, Uncert_ee.GBC = uncert[,2])
View(indicators)
