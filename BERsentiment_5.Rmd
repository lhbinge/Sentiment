---
output: 
    pdf_document:
        fig_caption: yes
        number_sections: true
fontsize: 12pt
geometry: margin=1in
bibliography: References.bib
csl: harvard.csl
---

#Methods for Aggregating Disparate Qualitative Survey Responses: An Application to Business Sentiment in South Africa
##Introduction
The global financial crisis was associated with unusually low levels of confidence and heightened uncertainty among firms. According to the @ECB2013, weak business sentiment contributed to a large extent to the Great Recession and to the lacklustre subsequent recovery. More recently, there has been increased uncertainty around the implications of the Brexit referendum [@Jackson2017] and the policy direction under President Trump [@Shen2017]. The idea that weak business sentiment influenced economic activity has inspired a substantial literature examining the impact of changes in sentiment, and especially uncertainty, on investment and output decisions. 

Business sentiment covers two distinct concepts: *confidence* and *uncertainty*. For the purposes of this chapter, business confidence is the degree of optimism that firms hold, or their perceptions of, current and future business conditions [@Mendicino2013]. Business uncertainty is the inability of firms to forecast the probability of future events occurring [@Knight1921]. It is challenging to measure these concepts [@Santero1996], as both are not directly observable and their definitions are difficult to operationalise. 

Analysts typically aggregate information from business and consumer surveys to construct proxies for confidence. Popular confidence indicators include the European Commission's Economic Sentiment Index and the Ifo Business Climate Indicator in Germany [@UN2015]. A wide range of proxies for uncertainty have been proposed in the literature, including measures based on financial market information, forecaster disagreement and business tendency surveys. 

The primary aim in this chapter is to explore aggregation methods for estimating business confidence and uncertainty in South Africa, using the microeconomic data from the BER business tendency surveys. Although measuring business sentiment is challenging, survey-based indicators can be helpful in discovering agents' opinions on future economic developments [@OECD2003]. Survey-based measures have the advantage that they are derived from the opinions of key economic agents [@Girardi2015], are available earlier than official statistics, and are usually not subject to revisions [@ECB2013]. This chapter will use the responses from the BER surveys to create proxies for business confidence and uncertainty in South Africa.

To date, there has been little research on business sentiment in South Africa, in part due to the difficulty of measurement. As far as research on confidence is concerned, only two business confidence indicators are regularly published for South Africa: the SACCI BCI and the BER BCI. The SACCI BCI is a composite measure of economic activity, rather than a confidence indicator in the way used in the literature. The BER BCI is a measure of confidence derived from the BER's business tendency surveys. It is based on a single question on current conditions. The survey responses are weighted in an ad hoc manner, and the services sector survey is excluded from the calculation. As far as research on uncertainty, as opposed to confidence, is concerned, only a few studies have created proxies for uncertainty in South Africa (e.g. @Redl2015 and @Hlatshwayo2016). No study has fully exploited the information contained in the BER business tendency surveys to construct proxies for business uncertainty in South Africa. 

The challenge in aggregating the microeconomic data from the BER business tendency surveys is to identify an underlying pattern from the disparate views of individual agents. In the chapter, an attempt is made to capture the full distribution of the qualitative survey responses, by calculating the first and second weighted cross-sectional moments of the distribution. The composite indicators of business confidence and uncertainty are based on these moments. 

Two composite confidence indicators are calculated in this chapter. The first is the cross-sectional mean of responses to questions on current business conditions, and the second is the cross-sectional mean of responses to questions on expected future business conditions [@OECD2003]. Three composite uncertainty indicators are calculated. The first is the scaled cross-sectional standard deviation of forward-looking responses [@Girardi2015]. The second is the cross-sectional mean of individual firm forecast errors, and the third is the cross-sectional standard deviation of forecast errors [@Arslan2011; @Bachmann2013]. 

The new composite indicators attempt to improve on the existing measures of sentiment for South Africa, by incorporating more of the available information from the qualitative business tendency surveys. The composite indicators incorporate the survey responses from questions on general business conditions, output, employment, orders placed and profitability. For each question, the responses are weighted by firm size and subsector size to produce sectoral indicators, including the services sector. The sectoral indicators are then weighted by GDP share to produce the overall aggregate composite indicators.

As in the previous chapter, the validity of the indicators is assessed by testing their conformity to existing measures. The two confidence indicators are compared with the BER BCI and the SACCI BCI. The three composite uncertainty indicators are compared with a measure of financial market uncertainty and the economic policy uncertainty indicator created by @Hlatshwayo2016. In addition, a composite overall measure of uncertainty is constructed, which combines the survey-based uncertainty indicators with the measures of financial market and economic policy uncertainty.

Similar to the previous chapter, the indicators are evaluated to determine whether they improve on the existing indicators. In this chapter, the indicators are evaluated according to their comovement with real GDP growth (i.e. their tracking record). The leading indicator properties of the confidence indices are also evaluated, in terms of the timing of their turning points and concordance with the official SARB business cycle. 

The primary aim in this dissertation is to demonstrate aggregation methods that may be useful in overcoming specific data challenges in order to create useful macroeconomic indicators. The previous chapter constructed various quality-adjusted measures of the mean of the distribution of growth rates in art prices. This chapter calculates various measures of the mean and standard deviation of survey responses, as well as forecast errors, as proxies for confidence and uncertainty. 

To demonstrate the usefulness of the aggregation methods and the estimated indicators, as well as provide an additional validity test, this chapter further examines the relationship between business sentiment and real economic activity in South Africa. There has been little analysis of this relationship in the South African context (e.g. @Pellissier2002 and @Redl2015). The newly constructed sentiment indicators are therefore exploited to examine the relationship between business sentiment and real economic activity in South Africa. In particular, the hypothesis is tested that there is significant comovement between the sentiment indicators and real GDP growth, using a standard VAR framework. The chapter presents an investigation into the relationship between the indicators and real GDP growth, including the timing of this relationship and the extent to which correlation is conditional on other economic variables. The following sections provide a review of the literature on confidence and uncertainty.

##Confidence
For the purposes of this chapter, business confidence involves firms' perceptions of, or degree of optimism regarding, current business conditions and the expected future business climate [@Mendicino2013]. In this chapter, firms' perceptions of current and future business conditions are measured using the BER business tendency surveys. Two sets of composite confidence indicators are calculated: one as the cross-sectional mean of responses to questions on current business conditions, and the other as the cross-sectional mean of responses to questions on expected future business conditions [@OECD2003].

This section demonstrates the importance of accurate measures of business confidence. It begins with a review of the theoretical links between confidence and macroeconomic outcomes. The section then discusses the empirical literature. First, the measurement challenges and the approaches to operationalising the definition of confidence are discussed. Second, the evidence on the impact of confidence on economic outcomes is examined. It is argued that improved empirical measures may be useful as leading indicators of the business cycle, as well as for forecasting real GDP growth. 

###Macro Theory and Confidence
In this section, the theoretical channels through which confidence may influence economic outcomes are discussed. While confidence measures are popular indicators, the stance of the academic literature is more ambiguous [@Barsky2012]. A review of the literature suggests three alternative views, which range from the view that confidence measures have an important causal role in the business cycle, to the view that they contain useful predictive information but play a limited causal role, to the view that they have no value, even in forecasting. In this section these three views are briefly discussed.

According to the so-called 'animal spirits' view, psychological factors have a causal impact on economic fluctuations distinct from fundamentals [@Carroll1994]. This view is most closely associated with @Keynes1936, who argued that: "Our decisions to do something positive, the full consequence of which will be drawn out over many days to come, can only be taken as a result of animal spirits - of a spontaneous urge to action rather than inaction, and not as the outcome of a weighted average of quantitative benefits multiplied by quantitative probabilities." The original Keynesian view finds resonance in the more recent literature, with @Akerlof2015 arguing that in the face of uncertainty, decisions about the future are based on animal spirits, rather than a weighted average of quantitative benefits and probabilities, as rational theory would dictate. 

Thus, psychological factors are drivers of consumption and investment decisions in the face of uncertainty, due to the difficulty of making accurate forecasts [@Pagan2013]. For firms, waves of optimism and pessimism may cause errors in their expectations about future demand and profits. When firms are optimistic about future demand and profits, they decide to accumulate capital. If their expectations are not met, there will be a period of reduced investment, which may cause a recession [@Beaudry2004]. These errors therefore generate cycles through increases and decreases in investment [@Leduc2010]. 

For consumers, optimistic income expectations lead them to increase their discretionary expenditures. These expectations depend not only on economic fundamentals, such as income or prices, but also on psychological factors. Psychological factors therefore influence consumers' perceptions of their economic environment and may become an independent source of economic fluctuations through their impact on their decisions [@Mendicino2013]. @Blanchard1993, for instance, argued that a negative consumption shock, which was associated with an exogenous shift in pessimism, was the cause of the 1990/1991 US recession. @Akerlof2015 argued that deteriorating confidence, one of the main elements of animal spirits, was an important reason for the global financial crisis and subsequent recession.

Models with multiple equilibria provide a potential causal link between confidence and fluctuations in economic activity, where the equilibria may be determined by sentiment [@Taylor2007]. The level of confidence is a potential variable that can determine which equilibrium occurs. For example, if a crisis of confidence causes a banking panic, the economy may settle at a suboptimal equilibrium, in respect of social welfare. If confidence is high, the economy may settle at an optimal equilibrium [@Leduc2010]. In this context, confidence is a prediction of a future outcome, which may become self-fulfilling [@Akerlof2015].

According to the animal spirits view, therefore, confidence has a potentially important causal impact on economic outcomes. In contrast, the so-called 'news' view argues that confidence indicators contain useful predictive information for economic output, but play a limited causal role. 

According to the news view, any relationship between confidence measures and subsequent real activity means that confidence measures contain information about current and future fundamentals of the economy [@Barsky2012]. Confidence can proxy for news that agents receive about future productivity, which is not yet reflected in econometricians' information sets, by aggregating information from various sources [@Cochrane1994; @Barsky2012]. Confidence indicators reflect agents' expectations about future fundamentals and economic conditions, which are not summarised in other macroeconomic variables. When agents are optimistic, they give positive responses to surveys. These are confirmed, on average, and real activity eventually increases as predicted by the confidence indicator [@Carroll1994]. 

From the rational expectations point of view, confidence should reflect the expected values of economic fundamentals and should not offer any additional predictive information [@Beaudry2004]. However, a number of studies (e.g. @Beaudry2004 and @VanAarle2012) analyse models where agents receive imperfect signals about future productivity growth and use these signals to make investment decisions. In this context, confidence refers to a state where agents receive an above-average signal, which may generate a wave of optimism. Rational agents then learn gradually about the true state of the economy and adjust their expectations. In this environment, occasional recessions reflect the availability of good quality information on which agents act.

Other factors, such as frictions in capital markets, may explain the predictive information contained in confidence indicators. For instance, an increase in confidence may reflect higher future income, but borrowing constraints can prevent higher current consumption in anticipation of an increase in income. As a result, consumption will increase only when actual income increases, and a rise in consumer confidence will predict the future consumption increase [@ECB2013]. 

The literature therefore sets out various theoretical links between confidence and economic activity. Yet, it is not clear whether confidence indicators repackage information already contained in other economic variables, or whether they contain useful independent predictive information about the economy. If they contain predictive information, it is not clear whether they reflect animal spirits, or aggregated information on agents' expectations of future outcomes not captured by the macroeconomic data [@Mendicino2013; @Akerlof2015]. The following section provides a review of the empirical literature on confidence, by discussing the approaches to calculating proxies for confidence, as well as the evidence on the impact of confidence on economic outcomes. 

###Empirical Findings
The empirical literature has tried to establish whether there is predictive information in confidence indicators, over and above economic fundamentals, and if so, whether confidence has a separate causal impact on economic activity. Although the findings have not been conclusive, the majority of studies seems to find that confidence indicators are at least positively related to real economic activity [@Taylor2007]. The inconclusive findings may be due to two main challenges: how to construct proxies for confidence and how to establish whether it has a separate causal impact on real economic activity. In the following sections these two challenges are discussed. 

####Measuring Confidence
Confidence cannot be observed or measured directly, which makes it challenging to construct proxies for it [@Santero1996]. Analysts typically aggregate responses from business and consumer surveys. These surveys usually contain a small number of qualitative questions, which can be answered quickly by respondents. Indicators are derived from the subjective answers to questions on past, current and future developments. The assumption is that agents' form opinions about economic conditions before a specific business activity is implemented (e.g. new production plans, employment, or purchases). These opinions may be called 'confidence'. The most important advantage of these surveys is that they are available long before official statistics become available. Moreover, they are not subject to revisions and avoid problems with trends and seasonality.   

The most common and widely used method to aggregate survey responses is to calculate so-called balance statistics. In the context of business tendency surveys, balances are simple averages of survey responses. For most survey questions, there are three reply options, e.g. 'up', 'the same', or 'down'. Balances are calculated as the difference between the percentage of positive answers and negative answers. Balances are simple to implement and understand, and are considered both practical and entirely adequate for cyclical analysis [@OECD2003].[^21]

[^21]: Diffusion indices are a slight variation on balances. In the context of business tendency surveys, they indicate the degree to which the change is diffused throughout the sample. The most common way to calculate a diffusion index consists of taking the percentage of respondents answering positively and adding it to half of the percentage of respondents reporting 'unchanged'. Thus, diffusion indices are a linear transformation of balances and have the same information content (OECD 2003).

Although balances are by far the most common method used by statistical agencies and analysts to aggregate the surveys, a few more sophisticated methods have been discussed in the literature, including a probabilistic approach, a regression approach, and a latent factor approach [@Nardo2003].[^22] However, these approaches usually require actual quantitative reference series for the relevant variables, which is restrictive in the case of business confidence, where quantitative reference series are unavailable. Moreover, these methods can become unreliable when exceptional events have a large impact on the correlation between the survey data and the quantitative reference data [@UN2015].

[^22]: The probabilistic approach assumes a probability distribution for the variable concerned, and the measure is a function of this specific probability distribution. The regression approach uses the relationship between survey responses of the past and actual values to quantify respondents' expectations about the future. The measures are a function of specific regression models (Nardo, 2003). In the latent factor approach, the percentages of each response are a function of a common 'latent measure' observed by respondents, but not by econometricians. 

Nevertheless, the evidence suggests that balance statistics tend to produce indicators that are very similar to those produced by more sophisticated methods. For instance, the Italian National Statistical Agency found a very high correlation between balances and more sophisticated indictors when using three-option responses [@OECD2003]. @Driver2004 assessed different ways of aggregating qualitative data from the UK employers' business survey into quantitative indicators for a number of variables. They found that the balance statistic was a satisfactory aggregation method for the survey responses on output, investment, and exports. Weighted balance statistics are therefore used in this chapter to calculate summary statistics for the responses to each survey question.

The balances from multiple questions are typically used to calculate composite confidence indicators, as opposed to using a single question. As no single cause explains all cyclical fluctuations over the long term, it necessary to have information from many possible sources of change, i.e. to use all potentially important information [@VanAarle2012]. Composite indicators have the capacity to react to various sources of economic fluctuations, while being resilient to fluctuations affecting single components. They often have fewer false alarms and fewer missed turning points than individual components and tend to have more stable lead-times. [@ECB2013]. In this chapter, composite confidence indicators are calculated by incorporating the responses to a number of questions.

Composite confidence indicators of this type are available for most countries. The European Commission, for instance, builds composite indicators by aggregating the survey responses from five sectors, using multiple questions on current and expected conditions. For example, the industrial indicator is an average of the balances of questions relating to production expectations, stocks of goods (with an inverted sign), and order books, while the retail trade indicator is an average of balances of questions relating to the present and future business situation and stocks (with an inverted sign) [@OECD2003]. The aggregate Economic Sentiment Index is a weighted average, using value added shares, of confidence in the manufacturing, construction, retail, and services sectors, as well as for consumers [@ECB2013]. @Taylor2007 and @Mendicino2013 used these composite confidence indicators for a number of European countries in investigating the impact of confidence on economic activity.

Another prominent example is the Ifo Business Climate Indicator, which is used as a leading indicator in Germany. It is computed as a geometric mean of the balances referring to the current business situation and the business outlook in the next six months [@UN2015]. The results for the manufacturing, construction, wholesale and retail sectors are weighted according to the importance of the industry. @Bachmann2010 and @Bachmann2013 used the Ifo Business Climate Survey, as well as the Philadelphia Fed's Business Outlook Survey, to calculate composite indices of current and expected conditions. @Barsky2012 used the Consumer Sentiment Index, published by the University of Michigan as a composite forward-looking measure of confidence. @Kabundi2004 used a dynamic factor model to calculate a composite indicator from the French Statistics Institute's business survey data. 

Two indicators of confidence are published in South Africa: the RMB/BER Business Confidence Index (BER BCI) and the South African Chamber of Commerce and Industry Business Confidence Index (SACCI BCI). The BER BCI, discussed in more detail below, is constructed from the BER's quarterly business tendency surveys, which are similar to the business tendency surveys conducted all over the world. The BER BCI is constructed from a specific question (Q1) that appears in all of the surveys: "Are prevailing business conditions: satisfactory, or unsatisfactory?" The BCI is the weighted percentage of respondents who rated prevailing business conditions as 'satisfactory' and is therefore based on the perceptions of business people [@Kershoff2002]. The survey responses are weighted (except the building survey), and the BER BCI is calculated as the unweighted mean of five sectoral indices (excluding the services sector). The BER BCI is an index of current conditions, as opposed to expected conditions, which is independent of external macroeconomic variables [@Pellissier2002].

The SACCI BCI, formerly known as the SACOB BCI, is a composite index of 13 quantitative sub-indices thought to have the greatest influence on the business mood. These include the exchange rate, inflation, the prime rate, retail sales volumes, credit extension, commodity prices, import and export volumes, new vehicle sales, utility services, manufacturing production, building plans passed, and the stock market index. The SACCI BCI is an *ex post* measure of actual activity, which is dependent on external macroeconomic variables. The rationale is that recent business activity is indicative of the degree of business confidence [@SACCI2011]. In this sense, the SACCI BCI is a composite measure of economic activity, rather than a confidence indicator in the way it is used in the literature.

In summary, to construct proxies of confidence, analysts typically calculate balances to aggregate responses from business and consumer surveys. They often calculate composite measures based on a set of questions for each sector, including questions on current and expected conditions. In South Africa there are only two regularly published business confidence indicators: the BER BCI and the SACCI BCI. The SACCI BCI is not a true confidence measure, and the BER BCI is a measure of current conditions, based on a single question, with survey responses weighted in an ad hoc manner. 

A primary objective of this chapter is to explore aggregation methods, to try to improve on the existing measures of confidence for South Africa. The chapter calculates composite indicators of business confidence based on the BER business tendency survey microeconomic data. The composite indicators incorporate the survey responses to a number of questions, maintaining a distinction between current and expected conditions. The responses are weighted to produce sectoral and aggregate indicators, which are analysed separately. The indices also incorporate the services sector, which is not currently part of the BER BCI. These confidence indicators are then used to investigate the relationship between confidence and economic activity. The following section provides a review of the evidence on the impact of confidence on economic outcomes.

####The Impact of Confidence
The majority of studies seems to find that confidence indicators are at least positively related to real economic activity, although this does not necessarily imply a causal relationship [@ECB2013]. Confidence indicators have been found to be useful in some cases as leading indicators, as well as for forecasting, even after controlling for other economic variables. Even in cases where the unique information content is limited, the timeliness of survey indicators may make them useful for monitoring developments and for real-time forecasting (nowcasting). 

The empirical literature has often investigated the extent to which confidence indicators contain predictive information over and above economic fundamentals [@UN2015]. A number of studies have shown that both consumer and business confidence indicators provided valuable information for forecasting real activity, which was not contained in other economic variables [e.g. @Santero1996; @Ludvigson2004; @Kabundi2004; @Parigi2004; @Taylor2007; @Leduc2013; @Mendicino2013; @Martinsen2014; and @Kilic2016]. 

In an influential study, @Barsky2012 found that positive shocks to consumer confidence led to significant, slow-building, and permanent responses in consumption and income. If confidence contained no news about future fundamentals, and reflected only animal spirits, one would expect transitory responses. @Barsky2012 concluded that their results supported the 'news' view of confidence.

The @ECB2013 found that confidence indicators can play a significant role in predicting recessions. They included the European Consumer Sentiment Index, along with the OECD leading indicator for the euro area in a probit model. This model captured business cycle phases relatively well, with probabilities increasing when recessions occurred. The drawback was that probabilities also increased in some periods when there were no recessions, i.e. there were some false positives.

The forecasting ability of confidence indicators might be offset by other indicators during ordinary times, while increasing notably during unusual events [@UN2015]. The @ECB2013 found that shocks to confidence played a relatively small role during normal times, but were important during more extreme episodes such as financial crises and recessions. The impact was asymmetric: large decreases in confidence were more important in predicting future changes in consumption than large increases. This pointed to a non-linear and asymmetric relationship between confidence and economic fluctuations. 

Even if confidence indicators are just a synthesis of economic variables and do not carry information over and above other economic series, they may still be useful for monitoring economic developments and for real-time forecasting of economic activity. This is because they are available before official quantitative statistics and are subject only to limited revisions [@Santero1996]. In the euro area, for instance, official statistics are released at least 45 days after the reference month (e.g. data for January is only available by mid-March). Business surveys are usually available before the end of the reference month (e.g. the Italian survey data are released about 45 days before industrial production). Confidence indicators can provide valuable information on the evolution of the economy over this period, which is one of the reasons why they are popular [@Parigi2004]. In this sense, even if the confidence indicators are coincident indicators of real activity, that they are available earlier means that they are quasi-leading indicators.

A number of studies have demonstrated that confidence indicators are useful for nowcasting economic activity. @Gayer2014 evaluated the impact of new releases of financial, real and survey data (using the EC surveys) on nowcasting euro-area GDP throughout each quarter. They found that survey and real data improved forecast accuracy throughout the sequence of nowcasts. Confidence indicators contained predictive content even after controlling for timeliness, due to their broad sectoral coverage and forward-looking nature. Similarly, @Matheson2007 found that business survey indicators improved real-time forecasting accuracy. This was due not only to their timeliness, but also to the underlying quality of the data. The results were consistent with the literature showing that survey indicators are not only timely proxies for hard data, but also contain complementary information for understanding business cycle developments.

Relatively few studies have analysed confidence indicators in South Africa. @Pellissier2002 examined the ability of the two South African business confidence indicators, the BER BCI and SACCI BCI, as business cycle indicators. He argued that both BCIs seemed to exhibit a coincident rather than a leading relationship with the business cycle, and that the BER BCI seemed to display stable turning point attributes. More recently, @Laubscher2014 found that the BER BCI was one of the closest predictors of the official reference business cycle turning points and was useful as a leading indicator. The BER's BCI is also used by the SARB as one of the component series of its official leading indicator of the business cycle [@Venter2005a].

The BER BCI has occasionally been included in larger datasets in forecasting exercises. For instance, @Gupta2010 analysed the impact of monetary policy on house price growth in South Africa using a factor augmented vector autoregression. The models were based on 241 quarterly series, including real, nominal, financial and intangible variables, such as confidence indices. @Gupta2011 used similar large factor models, with a large cross-section of macroeconomic time series, to forecast per capita growth, inflation, and the interest rate. Confidence indices were also included in the dataset of 267 quarterly series. 

@Kabundi2016 included the BER Consumer Confidence Index (BER CCI) and the SACCI BCI to forecast real GDP growth in South Africa in real time. They argue that the timeliness of the variables was especially important. The BER CCI and the SACCI BCI are published four and two weeks before the end of the reference quarter. This implies that soft data can be useful in forecasting exercises. 

In this chapter, the relationship between business confidence and real activity in South Africa is examined. An attempt is made to establish whether there is a significant positive relationship between the indicators and real GDP growth, the timing of this relationship, and whether it remains significant after taking other economic variables into account. The following section turns to the literature on uncertainty. 

##Uncertainty
@Knight1921 defined uncertainty as agents' "inability to forecast the likelihood of events happening." Uncertainty refers to a lack of knowledge of the set of possible outcomes and their associated probabilities (e.g. the number of coins ever produced is uncertain), which makes forecasting difficult. According to this definition, uncertainty is distinct from the concept of risk, which refers to a known probability distribution of a set of outcomes (e.g. a coin toss). Nevertheless, researchers usually refer to a single concept of uncertainty, which is typically a mixture of uncertainty and risk [@Bloom2014]. 

In this chapter, the inability of firms to forecast future events are measured using the BER business tendency surveys. Three sets of composite uncertainty indicators are calculated. The first is the scaled cross-sectional standard deviation of forward-looking responses. The second is the cross-sectional mean of individual firm forecast errors, and the third is the cross-sectional standard deviation of firm forecast errors [@Arslan2011; @Bachmann2013; @Girardi2015].

This section demonstrates the importance of accurate measures of uncertainty. It begins with a review of the theoretical links between uncertainty and macroeconomic outcomes. The section then turns to the empirical literature, by first discussing measurement challenges and the approaches to operationalising the definition of uncertainty, and then examining the evidence on the impact of uncertainty on economic outcomes. This is relevant not only for examining the relationship between uncertainty and real economic activity, but also to the chapter as a whole, as the measurement problem is of significant concern. It is argued that improved empirical measures may help to clear up the mixed results in the literature. 

###Macro Theory and Uncertainty
In this section, the theoretical channels through which uncertainty may influence economic outcomes are discussed. The theoretical literature emphasises two negative and two positive channels through which uncertainty can influence economic activity. Most of the focus is on 'real options' theory, based on @Bernanke1983. Uncertainty may have economic consequences when there is a degree of irreversibility to firms' actions. Firms receive new information over time, reducing uncertainty and increasing their ability to undertake the optimal investment. If the value of time, i.e. the benefit of new information, exceeds the costs of committing to a suboptimal project, it is rational to wait before committing to an investment [@Binding2015]. Because it increases the value of waiting for new information, uncertainty delays the current rate of investment [@Bernanke1983]. Thus, the option value of waiting increases as uncertainty increases [@Bloom2014]. 

This theory has led to the idea of a 'wait-and-see' effect [@Bloom2009]. If a firm faces large fixed adjustment costs,[^23] higher uncertainty about future demand makes new investments and hiring less attractive. Firms try to minimise the number of times this fixed adjustment cost must be paid. When the future is uncertain, in the sense that demand could be either very high or low, it makes sense to wait until the uncertainty has been resolved [@Bachmann2010]. Facing a more uncertain environment, firms delay investment and hiring, i.e. they 'wait and see' how the future will unfold, which leads to a decrease in economic activity. As the future unfolds, there is pent-up demand for capital and labour. Firms are closer to their adjustment triggers in subsequent periods, leading to a rebound and even an overshoot in economic activity. Thus, the initial decrease is followed by a swift recovery and overshoot in economic activity [@Bachmann2013]. 

[^23]: For capital, these costs can be both physical (equipment may have been damaged in installation and removal) and financial (discounts for used goods). For labour, adjustment costs include recruitment, search frictions, training, and severance pay.

Uncertainty can also negatively affect economic activity through risk aversion and risk premia. If investors are risk averse, higher uncertainty increases risk premia, by increasing the probability of default [@Redl2015]. The accompanying increase in borrowing costs can reduce growth, as highlighted in studies of uncertainty under financial constraints (summarised in @Bloom2014 and @Bachmann2013). In models where agents have pessimistic beliefs, and uncertainty about the future is too high to form a probability distribution, agents act as though the worst outcomes will occur (so-called ambiguity aversion). As uncertainty increases and the range of possible outcomes increases, the worst possible outcome becomes worse, leading agents to decrease investment and hiring. In contrast, if agents are optimistic (they assume the best case), uncertainty can have a positive impact on activity [@Bloom2014]. 

@Bloom2014 also referred to two other channels through which uncertainty can have a positive effect on economic activity. The 'growth options' argument is based on the idea that uncertainty can create call option effects, whereby uncertainty may increase investment if the size of the potential prize increases. This is due to the potential for an increase in upside gains, while the downside loss is limited to initial sunk costs, leading to an increase in expected investment returns [@Redl2015]. 

The Oi-Hartman-Abel effect highlights the possibility that firms may be risk-loving if they can expand to exploit good outcomes and contract to insure against bad outcomes. For example, if a firm can easily double production if prices increase, and halve production if prices decrease, it should desire a mean-preserving increase in uncertainty. This is because it receives 200% in good times and 50% during bad times. In effect, the firm can partly insure against bad outcomes by contracting and can exploit good outcomes by expanding. For this mechanism to work, firms need to be able to expand or contract easily in response to good or bad outcomes. @Bloom2014 argued that this effect is not very strong in the short run because of adjustment costs, but may be more powerful in the medium to long run.

@Bonciani2015 argued that in a general equilibrium framework, these effects may or may not be completely offset. In a New Keynesian Model, for instance, the monetary authority can partially offset the negative effects of uncertainty by reducing the nominal interest rate. They argue that this is the most important reason why many studies do not find a strong effect. However, when the monetary authority is constrained by the zero lower bound, or when there is imperfect pass-through, the effects of uncertainty become more significant, as the central bank cannot perfectly respond to the shock. 

The theoretical literature therefore sets out potential channels through which uncertainty may have a positive or negative impact on economic activity. It then becomes an empirical question to determine the direction and significance of the impact. The following section provides a review of the empirical literature on uncertainty, by discussing the approaches to calculating proxies for uncertainty, as well as the evidence on the impact of uncertainty on economic outcomes. 

###Empirical Findings
The recent surge in research on uncertainty has been driven by the idea that uncertainty increased during the financial crisis, and its potential role in shaping the Great Recession. In addition, the availability of empirical proxies for uncertainty has increased, along with the ability to include uncertainty in a wide range of models [@Bloom2014]. Although the majority of studies seems to find that uncertainty indicators are at least negatively related to real economic activity, the findings have not been conclusive. The inconclusive findings may be due to the two main challenges when it comes to empirical work on uncertainty: how to construct proxies for uncertainty and how to distinguish a separate causal impact of uncertainty. In this section these two challenges are discussed.

####Measuring uncertainty
It is unsurprising that there is no perfect measure of uncertainty, given its broad definition and the potential influence of a broad range of factors. A wide range of proxies for uncertainty have been proposed in the literature. These proxies can be grouped into five major categories, depending on the nature of the data used for their construction [@Bloom2014]. All proxies for uncertainty measure a specific type of uncertainty, and have strengths and weaknesses. 

The first category uses financial data, with the majority of studies using as proxies the implied or realised volatility in the stock market, GDP, bond yields, and exchange rates. The rationale is that more volatile series are more difficult to forecast, and are associated with a greater degree of uncertainty [@Bloom2014]. @Bloom2009, @Baker2013, @Bonciani2015 and @Leduc2015, for instance, used stock market volatility as a proxy for uncertainty. A popular proxy is the Chicago Board Options Exchange Market Volatility Index, which focuses on the implied volatility of the S&P 500 Index. It reflects the dispersion of market participants' estimates of future stock prices, as measured by the implied volatility across all options with a given time to maturity. The most frequent criticism is that developments on stock markets may only partly reflect developments in the real economy [@Girardi2015]. 

The second category uses new information to construct uncertainty indicators. The most prominent examples are proxies based on references to 'uncertainty' in the media. @Baker2015, for instance, developed economic policy uncertainty indices based on the frequency of references to policy uncertainty in newspapers. This was combined with disagreement among forecasters on future government purchases and inflation, and the number of tax code provisions about to expire. One criticism is that the selection of newspapers and search terms entails a certain degree of subjectivity [@Girardi2015].

The third category is derived from the disagreement among professional forecasters. The rationale is that a larger dispersion of opinions about the future indicates a higher degree of uncertainty. @Popescu2010, for instance, used a proxy for uncertainty based on the dispersion of professional forecasts of consumption, industrial production, investment, output, prices and interest rates in the German economy. The downside is that the factors influencing a limited set of professional forecasters might differ from those influencing producers and consumers [@Girardi2015].

The fourth category uses the responses from business and consumer surveys. @Bachmann2010 and @Bachmann2013, for instance, used the dispersion of business survey responses, as well as the dispersion in individual forecast errors to construct proxies for the US and Germany. @Arslan2011 used a similar measure of squared expectations errors to construct uncertainty indicators for Turkey. @Girardi2015 derived similar survey-based indicators, but with the difference that they were available in real-time, and used aggregated responses on all forward-looking questions. @Leduc2015 also used a survey-based proxy for uncertainty, measured as the fraction of respondents who listed uncertainty as a factor limiting their spending plans. Survey-based measures have the advantage that they are derived from opinions of key economic agents, as opposed to outside observers (e.g. professional forecasters) or the choices of investors on financial markets [@Girardi2015]. In this chapter, composite uncertainty indicators are calculated by using the BER business tendency surveys.

A fifth category was introduced by @Jurado2015. They argued that indicators of uncertainty should reflect the common variation across a vast array of variables, and that the forecastable component of each series should be removed when calculating volatility. They constructed new indicators using a large dataset of macroeconomic and financial indicators, as well as firm-level data. They extracted common factors, used them to predict industrial production, and subsequently calculated the forecast errors. Increases in the volatility of forecast errors were interpreted as increases in uncertainty. The disadvantage of their indicator is that it is an *ex post* measure, which requires the actual outcome of the forecasted time series before computing the indicator [@Girardi2015].

A few studies have constructed proxies for uncertainty in the South African context. @Redl2015 constructed an index of uncertainty for South Africa, based on disagreement among professional forecasters, the number of newspaper articles that mentioned economic uncertainty in South Africa, and references to uncertainty in the SARB's Quarterly Review. 

@Hlatshwayo2016 created a measure for South African economic policy uncertainty, by looking at 'news chatter' in the media, similar to the method used in @Baker2015. They created both economic policy and political uncertainty indices at the sectoral and aggregate level, by counting the number of articles that matched specific search algorithms. Aggregate economic uncertainty, for example, was measured by counting articles containing 3 mentions of words related to policy, economics, and uncertainty (i.e. one mention of each area) within 10 words of 'South Africa'. The absolute counts were normalised and the indices were standardised. @McClean2015 created a similar news-based index for aggregate South African policy uncertainty. He found a moderate correlation between this index, the SAVI and SA government bond yields.

@Pellissier2007 used the BER's manufacturing surveys to construct a measure of uncertainty. 'Volatility' in survey expectations was derived from the (unweighted) percentage of survey respondents changing their expectation between survey periods. 'Realizations' of survey expectations was derived from changes in survey expectations in period $t-1$, compared with survey realisations in period $t$. They found a negative relationship between 'Volatility' and 'Realizations' for responses relating to business conditions, production, sales, fixed investment and prices. @Hart2015 also used the BER's manufacturing sector survey to create dispersion measures of uncertainty, similar to the method used in @Bachmann2010.

Recently, @NWU2016 created a policy uncertainty index for South Africa. The index has three components: the frequency of references to economic policy uncertainty in leading publications, expert opinions drawn from leading private sector economists, and responses from the BER manufacturing survey on whether the political climate is a constraint to doing business. This index is only available from July 2015.

None of these studies has fully exploited the information contained in the BER business tendency surveys. A primary aim of this chapter is to explore aggregation methods to try to improve on the existing measures of uncertainty for South Africa, using the microeconomic data from BER business tendency surveys. Survey-based measures have the advantage that they are derived from the opinions of key economic agents, which may help to measure business uncertainty directly. The composite indicators incorporate the survey responses from a number of questions, and are weighted to produce sectoral and aggregate indicators, which are analysed separately. In addition, a composite overall measure of uncertainty is created, which combines the survey-based indicators with financial market and economic policy uncertainty. These uncertainty indicators are then used to investigate the relationship between uncertainty and economic activity. The following section briefly reviews the evidence on the impact of uncertainty on economic outcomes.

####The impact of uncertainty
The majority of studies seems to find at least a negative relationship between uncertainty proxies and economic activity, although this does not necessarily imply causality. In the literature three approaches have been taken to identify the impact of uncertainty on activity [@Bloom2014]. The first approach uses structural models to identify the potential impact of uncertainty shocks. The second approach relies on timing, typically in a VAR framework, by estimating the movements in economic activity that follow changes in uncertainty. The third approach exploits natural experiments such as exchange rate movements, disasters, and political coups.

In a number of papers, structural models (i.e. DSGE models) have been used to investigate potential mechanisms through which uncertainty may influence economic activity. Empirical VAR models are then used to confirm the theoretical model predictions. In a seminal paper, @Bloom2009 used a structural model to simulate the impact of an uncertainty shock, which produced the rapid decrease and subsequent rebound in aggregate output and employment predicted by the 'wait-and-see' effect. This simulated impact was compared with VAR estimations on actual data, using stock market volatility as a proxy for uncertainty. The results matched in both magnitude and timing, with a shock to uncertainty generating a decrease and then an overshoot in employment and production. 

@Bloom2007 developed a model of firms' investment decisions to show that, with partial irreversibility, the impact of a firm-level demand shock on investment tends to be weaker for firms that are subject to higher uncertainty. They found evidence of more cautious investment behaviour for firms subject to higher uncertainty. @Leduc2015 used a structural model with nominal rigidities and search frictions to show the mechanism through which uncertainty could produce large economic effects. Their empirical model found that uncertainty shocks resembled aggregate demand shocks, reducing investment, short-term interest rates and inflation, and increasing credit spreads and unemployment. @Bonciani2015 investigated the impact of uncertainty under financial frictions with a structural model. They found that higher uncertainty reduced activity, and that the impact was potentially larger during a recession.

A number of studies have investigated the timing of the relationship between uncertainty and economic activity in a VAR framework [e.g. @Arslan2011; @Baker2015; @Girardi2015; and @Jurado2015]. The results were generally similar to @Bloom2009, with a positive shock to uncertainty followed by a significant decrease in output, investment and employment.

@Bachmann2010 found that innovations to their survey-based uncertainty indicators had prolonged negative effects on economic activity. The long-run effects of uncertainty shocks were similar to the long-run effects of negative confidence shocks. However, when uncertainty was restricted to have no long-run impact, which is what the 'wait-and-see' effect would predict, uncertainty had no significant impact on activity. @Bachmann2010 argued that uncertainty could be seen as a symptom of poor economic times rather than a causal mechanism. In a follow-up study, @Bachmann2013 found that positive shocks to uncertainty were associated with a significant decrease in production and employment in both Germany and the US. German production declined and rebounded relatively quickly following an increase in uncertainty, while the response of US output was protracted, with limited evidence of a rebound. The US results suggest that some of the other mechanisms proposed in the literature, such as financial frictions may be important.

A few studies have investigated the interaction of uncertainty and these financial frictions. @Popescu2010, for instance, argued that once a measure of financial stress is included in the regressions, the independent role of uncertainty shocks becomes minimal. They found that the real effects of financial risk premia were larger and more persistent than uncertainty effects. @Caldara2016 found that uncertainty shocks had a significant negative impact on both financial conditions and real economic activity. Their results suggested that increases in uncertainty associated with tighter financial conditions had a particularly large negative effect on real economic activity.

Other studies have exploited natural experiments such as disasters, political coups, and exchange rate movements. For instance, @Baker2013 used natural disasters, terrorist attacks and unexpected political shocks as instruments for the usual stock market proxies of uncertainty. They found that uncertainty shocks accounted for at least half of the variation in GDP growth. @Binding2015 showed how different uncertainty indicators reacted to an unexpected policy change when the Swiss National Bank decided to return to a floating exchange rate regime in 2015. Firms affected by this exogenous increase in uncertainty decreased their planned investment relative to firms that were unaffected. However, once they controlled for the degree of irreversibility of firm investment, the relationship was no longer significant. 

There is relatively little evidence on the impact of uncertainty on economic outcomes in South Africa. Developing countries, such as South Africa, tend to experience higher uncertainty because they tend to have less-diversified economies, which are more exposed to price and output fluctuations of volatile goods such as commodities [@Bloom2014]. Developing countries tend to have more political shocks and often have less effective stabilisation policies. Given that developing countries experience higher levels of uncertainty, it is possible that fluctuations in uncertainty have a more pronounced impact on output.

@Redl2015 argued that analysing uncertainty in developing countries could help to distinguish between the effects of financial and uncertainty shocks. During the Great Recession, many developing countries experienced high uncertainty, while not undergoing the same levels of financial stress as developed countries. He found that an increase in uncertainty in South Africa was associated with a subsequent decrease in output, investment, employment, and asset prices. The results were robust to the inclusion of consumer confidence and credit spreads as a measure of financial stress, although the sizes of the responses were moderated. 

@Hlatshwayo2016 explored the role of policy uncertainty in South Africa in reducing the responsiveness of exports to relative price changes, through the wait-and-see effect. They found that increased policy uncertainty reduced the responsiveness of exports to the real effective exchange rate and had short- and long-run effects on export performance. A measure of competitiveness that adjusted for uncertainty and supply-side constraints outperformed the real effective exchange rate in tracking export performance. Similarly, @Boshoff2008 argued that developments in the Rand did not translate into business cycle movements in the South African economy, and that a weaker exchange rate was less likely to boost either foreign investment or export performance in the face of regulatory uncertainty. 

@Hart2015 investigated the relationship between sentiment and economic activity in the South African manufacturing sector from 2001Q2 to 2014Q2. The study closely followed @Bachmann2010, which also measured uncertainty in the manufacturing sector using business survey data. A VAR framework was used to estimate the impact of confidence and uncertainty on investment, production and employment in the South African manufacturing sector. None of the uncertainty measures were found to be significant, possibly due to the limited sample period. 

In this chapter, the relationship between uncertainty and real activity in South Africa is examined, using standard agnostic econometric methods (VARs). An attempt is made at establishing whether there is a significant negative relationship between uncertainty and real GDP growth, and if it remains significant after controlling for other economic variables. In the following section the BER business tendency surveys used to create the sentiment indicators are discussed.

##Data: Business Tendency Surveys
Business tendency surveys are conducted to obtain qualitative information that is useful in monitoring the current business situation and in forecasting developments in the business cycle. This is reflected in the extensive use of confidence measures as leading indicators of the business cycle [@OECD2003]. Qualitative surveys often can be completed more easily and quickly than quantitative surveys. The results can be published before official statistics, which are often released with a significant delay. Survey data have the advantage of focusing on the assessments and expectations of economic developments by relevant economic decision makers. Variables related to expectations may reflect cyclical changes earlier than corresponding quantitative statistical series (i.e. expectations lead to plans that are implemented and which will then be picked up in quantitative statistics). 

###The BER Business Tendency Surveys
```{r readdata, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
setwd("C:\\Users\\Laurie\\OneDrive\\Documents\\BING\\BER Confidence Surveys\\Sentiment")

suppressMessages(library(ggplot2))
suppressMessages(library(plyr))
suppressMessages(library(dplyr))
suppressMessages(library(reshape2))
suppressMessages(library(stargazer))
suppressMessages(library(xtable))
suppressMessages(library(scales))
suppressMessages(library(quantmod))
suppressMessages(library(vars))
suppressMessages(library(tseries))
suppressMessages(library(urca))

GDPdata <- read.csv("GDP Data2.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
GDPdata$Date <- as.Date(GDPdata$Date, format = "%Y/%m/%d")

datums <- read.csv("dates2.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
datums$Datum <- as.Date(datums$Datum, format = "%Y/%m/%d")

##For Grpahing Business cycles
recessions.df = read.table(textConnection(
    "Peak, Trough
    1990-12-31, 1993-05-30
    1996-11-30, 1999-08-31
    2007-11-30, 2009-08-31
    2013-11-30, 2016-12-31"), sep=',',
    colClasses=c('Date', 'Date'), header=TRUE)

realGDP <- read.csv("RealGDP2.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
realGDP$Date <- as.Date(realGDP$Date, format = "%Y/%m/%d")

GDPgrowth4 <- as.data.frame(sapply(log(realGDP[,-1]), diff, lag =4))
GDPgrowth1 <- as.data.frame(sapply(log(realGDP[,-1]), diff, lag =1))


##====================================##
## READING IN THE DATA ##
##====================================##
BER.M <- read.csv("Manufacturing_new faktor.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
BER.M$Faktor <- BER.M$Gewig * BER.M$Sectorw
BER.M <- BER.M[,c(1:5,8:75)]
colnames(BER.M)[1:7] <- c("region","id","sector","weight","turnover","factor","surveyQ")
exclude <- c("2016Q4","2017Q1","2017Q2")
BER.M <- subset(BER.M, !(surveyQ %in% exclude))
BER.M$factor <- as.numeric(as.character(BER.M$factor))

##===============================##
BER.B <- read.csv("Building_93Q2-17Q2.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
colnames(BER.B)[1:6] <- c("region","id","sector","weight","factor","surveyQ")

BER.B$factor[BER.B$sector ==5000] <- 0.30
BER.B$factor[BER.B$sector ==5010] <- 0.15
BER.B$factor[BER.B$sector ==6000] <- 0.10
BER.B$factor[BER.B$sector ==6010] <- 0.15
BER.B$factor <- BER.B$factor*BER.B$weight

BER.B$temp <- NULL
for(i in 1:nrow(BER.B)) {
    ifelse(substr(BER.B$surveyQ[i], 1, 1)==9, 
           BER.B$temp[i] <- paste0("19",BER.B$surveyQ[i],sep=""),
           BER.B$temp[i] <- paste0("20",BER.B$surveyQ[i],sep=""))
}
BER.B$surveyQ <- BER.B$temp
BER.B <- BER.B[,-ncol(BER.B)]
BER.B$surveyQ <- factor(BER.B$surveyQ)
BER.B <- subset(BER.B, !(surveyQ %in% exclude))

##===============================##
skoon <- function(data) {
    colnames(data)[1:6] <- c("region","id","sector","weight","factor","surveyQ")
    data$surveyQ <- toupper(data$surveyQ)
    data$sector <- factor(data$sector) #could include labels
    data$id <- factor(data$id)
    data$region <- factor(data$region)
    
    data$temp <- NULL
    for(i in 1:nrow(data)) {
        data$temp[i] <- paste0("20",data$surveyQ[i],sep="")
    }
    data$surveyQ <- data$temp
    data <- data[,-ncol(data)]
    data$surveyQ <- factor(data$surveyQ)
    
    data$weight <- replace(data$weight, data$weight==0, 1)
    data$factor <- data$weight*0.10
    
    #data <- data[data$Latecomer == FALSE | is.na(data$Latecomer),]
    data <- data[,1:(ncol(data)-6)]
    
    data <- subset(data, !(surveyQ %in% exclude))
    return(data)
}


arc <- skoon(read.csv("Argitekte.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE))
civil <- skoon(read.csv("Civils.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE))
qs <- skoon(read.csv("QS.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE))

##============================##
skoon <- function(data) {
    colnames(data)[1:7] <- c("region","id","sector","weight","sectorw","factor","surveyQ")
    data$surveyQ <- toupper(data$surveyQ)
    data$sector <- factor(data$sector) #could include labels
    data$id <- factor(data$id)
    data$region <- factor(data$region)
    
    data$temp <- NULL
    for(i in 1:nrow(data)) {
        ifelse(substr(data$surveyQ[i], 1, 1)==9, 
               data$temp[i] <- paste0("19",data$surveyQ[i],sep=""),
               data$temp[i] <- paste0("20",data$surveyQ[i],sep=""))
    }
    data$surveyQ <- data$temp
    data <- data[,-ncol(data)]
    data$surveyQ <- factor(data$surveyQ)
    
    data$sectorw <- as.numeric(as.character(data$sectorw))
    data$factor <- as.numeric(as.character(data$factor))
    data$factor <- data$weight*data$sectorw
    
    #data <- data[data$Latecomer == FALSE | is.na(data$Latecomer),]
    data <- data[,1:(ncol(data)-5)]
    
    data <- subset(data, !(surveyQ %in% exclude))
    return(data)
}

BER.R <- skoon(read.csv("Retail_92Q2-17Q2.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE))
BER.W <- skoon(read.csv("Wholesale_92Q2-17Q2.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE))
BER.V <- skoon(read.csv("Motor_92Q2-17Q2.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE))
BER.V$factor <- BER.V$weight*0.2

##===============================##
BER.S <- read.csv("Services_05Q2-17Q2.csv", header=TRUE, sep=",",na.strings = "", skipNul = TRUE)
colnames(BER.S)[1:6] <- c("region","id","sector","weight","factor","surveyQ")

BER.S$temp <- NULL
for(i in 1:nrow(BER.S)) {
    BER.S$temp[i] <- paste0("20",BER.S$surveyQ[i],sep="")
}
BER.S$surveyQ <- BER.S$temp
BER.S <- BER.S[,-ncol(BER.S)]
BER.S$surveyQ <- factor(BER.S$surveyQ)

BER.S$sector[BER.S$sector==6000] <- 6001
BER.S$sector[BER.S$sector==6010] <- 6011

catering <- c(6001,6020,6030,6011)
transport <- c(7020,7010,7070,7090,7080,7060,7000,7040,7100,7120,7110,7050)
realestate <- c(8000,8010)
business <- c(8040,8080,8070,8090,8020,8060,8050,8030)
other <- c(8150,8120,8210,8180,8140,8160,8190,8100,8200,8230,8130,8110,8170,8240,8220)
community <- c(9000,9010,9030,9050,9060,9020,9040)

BER.S$factor[BER.S$sector %in% catering] <- 0.15
BER.S$factor[BER.S$sector %in% transport] <- 0.15 
BER.S$factor[BER.S$sector %in% realestate] <- 0.15
BER.S$factor[BER.S$sector %in% business] <- 0.05 
BER.S$factor[BER.S$sector %in% other] <- 0.45 
BER.S$factor[BER.S$sector %in% community] <- 0.05 

BER.S$factor <- BER.S$factor*BER.S$weight
BER.S <- subset(BER.S, !(surveyQ %in% exclude))

#==================
#AGGREGATING
#==================
#Create an unweighted stacked version of all the surveys
#Match the same or similar questions from the different surveys (see survey question examples)
#Create NAs for missing questions
tempBER.M <- cbind(BER.M[,c("id","sector","weight","factor","surveyQ","Q20","Q7A","Q7P","Q1A","Q1P","Q8A","Q8P",            "Q4A","Q4P")],"Manufacturing")
colnames(tempBER.M) <-    c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P",            "Q6A","Q6P",  "Sector")
tempBER.M[,c("Q5A","Q5P")] <- NA
tempBER.B <- cbind(BER.B[,c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P","Q5A","Q5P")],            "Construction")
colnames(tempBER.B) <-    c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P","Q5A","Q5P",              "Sector")
tempBER.B[,c("Q6A","Q6P")] <- NA
tempBER.R <- cbind(BER.R[,c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q5A","Q5P","Q8",       "Q4A","Q4P")],"Trade")
colnames(tempBER.R) <-    c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P","Q5A",      "Q6A","Q6P"  ,"Sector")
tempBER.R[,c("Q5P","Q6A","Q6P")] <- NA
tempBER.W <- cbind(BER.W[,c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q5A","Q5P","Q8",       "Q4A","Q4P")],"Trade")
colnames(tempBER.W) <-    c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P","Q5A",      "Q6A","Q6P"  ,"Sector")
tempBER.W[,c("Q5P","Q6A","Q6P")] <- NA
tempBER.V <- cbind(BER.V[,c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P",                        "Q4A","Q4P")],"Trade")
colnames(tempBER.V) <-    c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P",                        "Q6A","Q6P"  ,"Sector")
tempBER.V[,c("Q4A","Q4P","Q5A","Q5P")] <- NA
tempBER.S <- cbind(BER.S[,c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P","Q5A","Q5P")],            "Services")
colnames(tempBER.S) <-    c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P","Q5A","Q5P",              "Sector")
tempBER.S[,c("Q6A","Q6P")] <- NA

temparc <- cbind(arc[,c("id","sector","weight","factor","surveyQ", "Q1","Q6A","Q6P","Q5A","Q5P","Q2A","Q2P",                "Q4A","Q4P")],"Construction")
colnames(temparc) <-    c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P",              "Q6A","Q6P","Sector")
temparc[,c("Q5A","Q5P")] <- NA
tempqs <- cbind(qs[,c("id","sector","weight","factor","surveyQ", "Q1","Q6A","Q6P","Q5A","Q5P","Q2A","Q2P",                "Q4A","Q4P")],"Construction")
colnames(tempqs) <-    c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P",              "Q6A","Q6P","Sector")
tempqs[,c("Q5A","Q5P")] <- NA
tempcivil <- cbind(civil[,c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P","Q5A","Q5P")],            "Construction")
colnames(tempcivil) <-    c("id","sector","weight","factor","surveyQ", "Q1","Q2A","Q2P","Q3A","Q3P","Q4A","Q4P","Q5A","Q5P",              "Sector")
tempcivil[,c("Q6A","Q6P")] <- NA

BER <- tempBER.M
BER <- rbind(BER,tempBER.B,tempBER.R,tempBER.W,tempBER.V,tempBER.S,temparc,tempqs,tempcivil)
BER <- BER[,c(15,1:12,16,17,13,14)]
rm(tempBER.M,tempBER.B,tempBER.R,tempBER.W,tempBER.V,tempBER.S,temparc,tempqs,tempcivil)
rm(BER.M,BER.B,BER.R,BER.W,BER.V,BER.S,arc,qs,civil)

#Clean data
BER$surveyQ <- toupper(BER$surveyQ)
BER$sector <- factor(BER$sector) #could include labels
BER$id <- factor(BER$id)
BER$surveyQ <- factor(BER$surveyQ)

# replace 1,2,3 (Up, Same, Down) responses with 1,0,-1
for(i in 7:ncol(BER)) {
    BER[,i] <- replace(BER[,i], BER[,i]==2, 0)
    BER[,i] <- replace(BER[,i], BER[,i]==3,-1)
}
BER$Q1 <- replace(BER$Q1, BER$Q1==0,-1) # replace 0 (Unsatisfactory) responses with -1

#Maak factor reg
Ej <- aggregate(BER$weight, by=list(BER$surveyQ,BER$sector), FUN=sum)
BER <-  merge(BER, Ej, by.x=c("surveyQ","sector"), by.y=c("Group.1","Group.2"))
BER$factorn <- BER$factor/BER$x
BER <- BER[,c(3,4,2,5,6,19,1,7:17)]
```

The BER, a research institute attached to Stellenbosch University, has been conducting business tendency surveys in South Africa since March 1954. The BER's quarterly business surveys are similar to the business tendency surveys conducted all over the world, including the European Commission Business Tendency Surveys, the German Ifo Business Climate Survey, the Federal Reserve Bank of Philadelphia's Business Outlook Survey, and the Bank of Japan's Tankan Survey [@OECD2003].

During the last month of each quarter, questionnaires are sent to 1,000 firms in each of the manufacturing and services sectors and 1,400 firms in each of the construction and trade sectors (i.e. retail, wholesale and motor vehicles). The questionnaires are completed by senior executives of the firms. The questions have remained largely unchanged since inception, and include those on current and expected future developments regarding, among others, sales, orders, inventories, prices, employment, and constraints. For the most part, the survey answers fall into three categories: 'up', 'the same' or 'down'. 

Table 3.1 reports the details of the survey data. The sample runs from 1992Q1 to 2016Q3, although the survey of the services sector started only in 2005Q2. Figure 3.1 illustrates the number of respondents over time per sector. Around 1,000 completed questionnaires are received every quarter, leading to an overall sample size of 119,438. All of the surveys have a few missing quarters, when the microeconomic data was lost. The overall panel sizes and response rates have remained relatively stable over time, although the response rates are relatively low by international standards [@Kershoff2015]. 

```{r table3.1, echo=FALSE, results='asis', warning=FALSE, message=FALSE, cache = TRUE}
tafel <- aggregate(BER$id, by=list(BER$surveyQ,BER$Sector), FUN = length)
tafel <- cbind(obs=aggregate(tafel$x, by=list(tafel$Group.2), FUN = sum ),ave=aggregate(tafel$x, by=list(tafel$Group.2), FUN = mean ))[,-3]
tafel$obs.Group.1 <- as.character(tafel$obs.Group.1)
tafel$Resp <- tafel$ave.x/c(1000,1400,1400,1000)
tafel$Sample <- c("1992Q1-2016Q3","1993Q2-2016Q3","1992Q2-2016Q3","2005Q2-2016Q3") 
tafel$Missing <- c("1997Q4,2000Q1,2005Q4","1993Q4,1998Q3,2000Q2,2005Q4","1992Q4,1993Q3,2005Q4","2005Q4") 
tafel <- tafel[,c(1,5,2:4,6)]
tafel <- rbind(tafel,c("Total","1992Q1-2016Q3",nrow(BER),mean(aggregate(BER$id, by=list(BER$surveyQ),FUN = length)[,2]),
                       mean(aggregate(BER$id, by=list(BER$surveyQ), FUN = length)[,2])/4800,"2005Q4"))
tafel[, c(4:5)] <- sapply(tafel[, c(4:5)], as.numeric)
colnames(tafel) <- c("Sector","Sample","Total Obs","Obs/Quarter", "Response Rate","Missing Quarters")     
xt <- xtable(tafel, caption="Sample characteristics", digits=c(2), align= c('r', "p{3cm}", rep('r',5) ) )
print(xt, "latex",comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), scalebox = 0.8,
      include.rownames=FALSE)
```

```{r figure3.1, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="The number of respondents over time per sector (1992Q1-2016Q3)"}
BERplot <- aggregate(BER$id, by=list(BER$surveyQ,BER$Sector), FUN = length)
BERplot$Group.1 <- as.Date(as.yearqtr(BERplot$Group.1, format = "%YQ%q"), frac = 1)
g <- ggplot(BERplot, aes(x=Group.1, y=x,fill=Group.2))
g <- g + geom_bar(stat="identity")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + scale_fill_discrete(name="Sector")
g <- g + scale_y_continuous(labels=comma)
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))
g <- g + ylab("Number of Respondents") + xlab(" ")
g <- g + guides(fill = guide_legend(reverse = TRUE))
g
```

The sample of firms remains relatively stable from one survey to the next, effectively creating a panel. The panel is partly fixed and partly rotating, as inactive firms that fail to respond for a period of two years are removed and replaced with new firms. The fixed part reflects the opinions of the same firms over time, which ensures that the results remain comparable between surveys. The results are more likely to reflect changes in the variables under consideration than changes in the sample from one survey to the next [@Kershoff2002]. 

Stratified deliberate sampling is used to design the BER's survey panels, which is the international norm. Participants are selected to be representative of particular sectors, regions and firm sizes. The respondents are reviewed periodically to ensure reasonable representation of the population universe. The exact number of firms in the universe is unknown to the BER, as censuses of the business sector are not conducted regularly and the BER does not have access to the National Business Register [@Kershoff2002]. Practical experience has shown that non-random samples can give acceptable results in conducting these types of surveys [@OECD2003]. 

The BER makes no provision for firms that were not selected or did not respond during sampling, implicitly assuming that the non-participating or non-responding firms have the same distribution as the responding firms for the period. This corresponds to with the 'missing at random' assumption suggested by the @OECD2003. @Kershoff2015 argued that this is a reasonable assumption, given that the responses cannot vary infinitely, and the same factors influence firms in the same sector. He found evidence for this assumption when the inclusion of latecomers had almost no effect on the volatility and tracking record of the results, even at lower levels of aggregation.[^24]

[^24]: The BER does not adjust individual weights for changes in the response pattern. No calibration or post-stratification is carried out to correct the estimated value. Missing items (specific questions) and missing responses (questionnaires) are not imputed, and the results are not revised to provide for questionnaires received after the results have been processed (Kershoff 2015).

Panel sizes and response rates determine the representativeness of the sample. In order to be representative, panels have to include a minimum number of participants, which depends on the level of aggregation and the size of the population universe. The results often remain valid even if the sample size is small and the response rate relatively low. According to the @OECD2003, even as few as 30 respondents might be sufficient to obtain an acceptable level of precision for each stratum. This is because the variance of responses for ordinal-scaled data based on a stable panel is lower than for quantitative data derived from independent surveys. Moreover, certain activities are dominated by a few large firms. Representativeness therefore has a smaller impact on qualitative survey results than on quantitative surveys results. A panel that is not fully representative will probably produce similar results to a fully representative one [@Kershoff2002]. 

The sample sizes illustrated in Figure 3.1 therefore seem adequate to uncover trends in the data. @Kershoff2002 found that the degree of representation of the BER's construction and trade panels adequately reflects the universes, taking response rates into account and comparing the composition of the survey panels with census and other official data. However, the number of participants per subsector may be too low to consider subsectors or provinces as sub-panels. The survey responses are therefore not disaggregated further into subsectors below.

###The BER Business Confidence Indicator
The BER uses these business tendency surveys to construct its business confidence indicator. The BER BCI has proved useful as a leading indicator of the business cycle and economic growth in South Africa. It is used as one of twelve leading indicator series by the SARB to date official turning points in the business cycle. @Laubscher2014 also found that it can improve estimates of cyclical turning points. This is particularly useful in view of the early availability of the index. The BER index results for a particular quarter are available approximately two months before the official GDP estimates [@Kershoff2000]. 

In calculating the business confidence indicator, the most important issues are which survey questions to use and the weightings applied to the responses. The BER BCI is constructed from a specific question (Q1) that appears in all of the surveys: "Are prevailing business conditions: satisfactory, or unsatisfactory?" The BCI is the weighted percentage of respondents who rated prevailing business conditions as 'satisfactory' in a particular sector. The BCI is therefore a rating of business conditions at a specific point in time.

According to @Kershoff2000 there are two reasons for the use of this one question to construct the confidence indicator. Firstly, it is reasonable to assume that respondents who are satisfied with business conditions will have more confidence than those experiencing unsatisfactory conditions. Secondly, respondents take a variety of factors into account when rating prevailing business conditions, which solves the problem of weighting different factors [@Kershoff2000]. The @OECD2003 argues that responses on general business conditions are usually based on a combination of factors, such as order book appraisals, expectations of interest rates, exchange rates and political developments.

In line with international best practice, all survey responses are weighted (except for the building survey). Each response is multiplied by a factor, which is calculated as the product of a firm size weight and a subsector size weight (except for the motor trade, where there are no subsectors). Each firm receives a weighting in relation to turnover, or the size of workforce in the case of manufacturing.[^25] The subsector size weights are based on the composition of production or sales in each subsector, as calculated by StatsSA. The BER does not apply sample weights, as it does not have access to the National Business Register and cannot calculate selection probabilities.[^26] Responses are weighted by firm size and subsector size to obtain five sectoral indices: manufacturing, building contractors (other construction subsectors are omitted), retailers, wholesalers and new vehicle dealers. The BER BCI is calculated as the unweighted mean of the five sectoral indices (services are excluded altogether).

[^25]: Unlike quantitative surveys, where weighting is usually inherent in the variables, weighting is necessary for qualitative surveys, because the variables typically collected do not inherently represent the size of a business. The size weights are necessary because the economic significance of the responses should reflect the size of the firm (UN 2015). 

[^26]: The BER does not apply sample weights (i.e. the inverse of the probability of selection). This assumes that the probability of selection is the same for all units, which would be the case if firms were selected randomly (OECD 2003).

The BER BCI is a measure of current conditions, based on a single question, with survey responses weighted in an ad hoc manner. The business surveys contain a number of questions, all of which potentially have an impact on business confidence. A composite indicator can be calculated by combining the responses to a number of questions, which is often done internationally [@ECB2013]. Moreover, the BER BCI reflects confidence in current conditions, rather than forward-looking confidence. As the surveys contain questions on expectations, forward-looking responses may also provide valuable information. One of the aims in this chapter is to build on the BER BCI by calculating composite weighted indicators of confidence on current and expected conditions, at a sectoral level and in aggregate. The BER business tendency surveys are also uniquely suited to obtaining measures of uncertainty. Another aim in this chapter is to construct composite weighted forward-looking indicators of uncertainty, at the sectoral and aggregate levels. In the following section, the methodology for constructing these indicators of sentiment is set out.

##Methodology
This section provides the methodology for calculating the sentiment indicators based on the microdata from the BER business tendency surveys. Indicators of sentiment are constructed from the first and second moments of responses to business tendency survey questions. Two sets of composite confidence indicators are calculated: the first as the weighted cross-sectional mean of responses to questions on current business conditions and the second as the weighted cross-sectional mean of responses to questions on expected future business conditions [@OECD2003]. Three sets of composite uncertainty indicators are calculated. The first is the scaled weighted cross-sectional standard deviation of forward-looking responses. The second is the weighted cross-sectional mean of individual firm forecast errors, and the third is the weighted cross-sectional standard deviation of firm forecast errors [@Arslan2011; @Bachmann2013; @Girardi2015].

###Confidence
In this chapter, a distinction is made between confidence indicators of current conditions and of expected conditions. Both the Conference Board and the University of Michigan make this distinction and report two consumer confidence indices: a current conditions component and an expectations component [@Ludvigson2004]. 

Formally, one can define a $k$-period-ahead expectations measure of confidence $(C_t^k)$ at time $t$ as: $C _t^k = E_t f(\Delta^h Y_{t+k})$, where $Y_{t+k}$ is a measure of real activity (usually output) at time $t+k$ and $\Delta^h Y_{t+k} = Y_{t+k} - Y_{t+k-h}$. A common definition of $f(\Delta^h Y_{t+k})$ relies on an up, unchanged, or down classification (e.g. Q2A in the BER survey): 
$$ f(\Delta^h Y_{t+k}) = \begin{cases} -1,& \text{if } \Delta^h Y_{t+k} < 0\\ 0,& \text{if } \Delta^h Y_{t+k} = 0\\ 1,& \text{if } \Delta^h Y_{t+k} > 0\\ \end{cases} $$

An alternative would be to use a binary classification (e.g. Q1 in the BER survey): $$ f(\Delta^h Y_{t+k}) = \begin{cases} -1,& \text{if } \Delta^h Y_{t+k} < a\\ 1,& \text{if } \Delta^h Y_{t+k} \geq a\\ \end{cases} $$ where $a$ is determined by the preferences of the agent. 

In this chapter, a distinction is made between indicators of current conditions $C_t^k$ when $k=0$, and indicators of expected conditions $C_t^k$ when $k=1$. The confidence measure for current conditions $C^0_t$ is referred to as 'current', as it is reflects confidence about the current quarter (in the second month of the quarter). The confidence measure for expected conditions $C^1_t$ is referred to as 'expected', as it is reflects confidence about the following quarter.

The BER business tendency surveys make this distinction possible by asking for separate responses relating to current and expected future conditions. The questions on current conditions (e.g. Q2A) all have the following format: "(Estimated development in current quarter) Compared with the same quarter of a year ago, are general business conditions: better, the same, or poorer?" In other words, these questions ask whether the factor under consideration in time $t$ is better, the same, or poorer, compared with $t-4$. 

The forward-looking questions (e.g. Q2P) all have the following format: "(Expected development in next quarter) Compared with the same quarter of a year ago, will general business conditions be: better, the same, or poorer?" As with the questions on current conditions, these questions ask whether the factor under consideration in time $t+1$ is expected to be better, the same, or poorer, compared with $t-3$. Responses are relative to the same quarter of the previous year, which corresponds with year-on-year growth rates. 

Although the survey questions imply that seasonal adjustment is not required, a common challenge is that respondents may not use the correct reference period when answering the question [@OECD2003]. For example, answers to the forward-looking questions may compare expected outcomes in the next quarter $t+1$ with period $t$, instead of with period $t-3$. In many cases, the time series of balances show some residual seasonality. The indicators are therefore adjusted for seasonality [@UN2015]. The results are similar without seasonal adjustments.

As discussed above, confidence indicators are almost always based on balance statistics, which present a single figure summarising the responses of all participants to a particular question [@Santero1996]. It is the cross-sectional mean of survey responses if the standard quantification system is used: 'better' is quantified by +1, 'the same' by 0, and 'poorer' by -1. Confidence in period $t$ relating to current conditions $C_t^{0}$, and confidence in period $t$ relating to expected conditions $C_t^{1}$, may be defined as: 
$$C^{0}_t = \frac{1}{W_t} \sum^N_{i=1} w_{it} E_t f(\Delta^4 Y_{i,t })$$ 
$$C^{1}_t = \frac{1}{W_t} \sum^N_{i=1} w_{it} E_t f(\Delta^4 Y_{i,t+1}) ,$$ 
where $Y_{i,t+k}$ is again a measure of real activity at time $t+k$ for firm $i = 1,...,N$; $\Delta^h Y_{i,t+k} = Y_{i,t+k} - Y_{i,t+k-h}$ for firm $i$; $w_{it}$ is the weight that each firm $i$ receives at time $t$; and $W_{t} = \sum^N_{i=1}w_i$ is the sum of the weights. 

The weights are calculated as: $w_{it} = f_{it} s_{jt} / F_{jt} ,$ where $f_{it}$ the firm size weight (i.e. the inner weight reflecting turnover or number of employees) for firm $i$ at time $t$; $s_{jt}$ is the subsector weight (i.e. the outer weight reflecting the share of total value added) for subsector $j$ at time $t$; and $F_{jt} = \sum^N_{i=1} f_{it}$ is the total firm weight for subsector $j$ at time $t$. These weights are equivalent to an explicit two-step weighting procedure, whereby weighted means are calculated for each subsector separately (using firm size weights), and then aggregated with the subsector weightings [@UN2015]. The BER uses similar weights, except that the weightings equal the product of firm and subsector weights $w_{it} = f_{it} s_{jt}$, without dividing by the total firm weight for the subsector $F_{jt}$.

The weighted means are calculated for each question separately. The BER business surveys contain a number of questions that may be useful in gauging business sentiment in South Africa. These include questions on general business conditions, production, orders placed, employment, and profitability. Most international institutions calculate composite confidence indicators by combining the responses to a number of questions [@ECB2013]. Composite indicators react to various sources of economic fluctuations, while being resilient to fluctuations affecting single components. They may therefore exhibit fewer false alarms and fewer missed turning points than indicators based on a single question. 

This chapter therefore combines the responses to a number of questions in the BER surveys to calculate composite indicators. For consistency, the composite indicators are derived from questions that are present in most of the sectoral business surveys. Table 3.2 reports the questions included in each of the sectoral surveys. These questions cover six types of variables, namely business conditions, activity (production or sales),[^27] orders placed, employment, and profitability. Not all of the variables are covered in all the surveys. The measure of confidence about current conditions also include the question (Q1) on business satisfaction used to calculate the BER BCI. The composite sectoral indicators are calculated as the average of the weighted balances for the questions for each sector, as reported in Table 3.2. The results were very similar when the different questions were combined using principal components rather than averages. The sectoral indicators are then weighted by GDP share to form the overall aggregate composite indicators [@UN2015].

[^27]: The wording of the questions is adopted to the characteristics of each sector (Kershoff 2015). Activity is referred to as the 'volume of production' in the manufacturing survey, 'volume of building activity' in the construction survey, 'volume of sales' in the trade surveys, and 'volume of business' in the services survey.

\begin{table}[]
\centering
\caption{Survey questions used by sector}
\label{my-label}
\begin{tabular}{|l|r|r|r|r|}
\hline
\textbf{Survey Question} & \textbf{Manufacturing} & \textbf{Construction} & \textbf{Trade} & \multicolumn{1}{l|}{\textbf{Services}} \\ \hline
Business Conditions      & X                      & X                     & X              & X                                      \\ \hline
Activity                 & X                      & X                     & X              & X                                      \\ \hline
Employment               & X                      & X                     & X              & X                                      \\ \hline
Profitability            &                        & X                     & X              & X                                      \\ \hline
Orders Placed            & X                      &                       & X              &                                        \\ \hline
\end{tabular}
\end{table}

###Uncertainty
Following the literature (e.g. @Bachmann2010, @Bachmann2013, @Arslan2011, and @Girardi2015), this section sets out the methodology for calculating three composite forward-looking indicators of uncertainty: (i) the scaled weighted cross-sectional standard deviation of forward-looking responses, (ii) the weighted cross-sectional mean of individual firm forecast errors, and (iii) the weighted cross-sectional standard deviation of firm forecast errors. These measures are based on *ex ante* disagreement and *ex post* forecast errors and capture a low level of predictability. The BER survey microeconomic data is particularly useful in this case, as it allows individual firm forecast errors to be calculated.

The cross-sectional standard deviation of responses to forward-looking questions (e.g. Q2P) $D^{1}_t$ at time $t$, is a measure of the dispersion of responses and is often used as a proxy for uncertainty. This measure of dispersion is analogous to the proxy for uncertainty based on forecaster disagreement used by @Baker2013. It may be defined as: 
$$D^{1}_t = \frac{1}{W_t} \sum^N_{i=1} (w_{it} E_t f(\Delta^4 Y_{i,t+1}) - \mu_{t+1})^2 ,$$
where the variables are defined in the same way as above, and $\mu_{t+1} = \frac{1}{W_t} \sum^N_{i=1} w_{it} E_t f(\Delta^4 Y_{i,t+1})$ is the weighted sample mean. 

@Bachmann2010 and @Bachmann2013 noted that there are two potential problems with the dispersion measure suggested above as a proxy for uncertainty. First, time variation in the cross-sectional dispersion of responses may simply reflect firms reacting differently to aggregate shocks, without uncertainty changing over time.[^28] Second, time variation in dispersion may simply reflect time variation in the heterogeneity of expectations, without uncertainty changing over time. 

[^28]: They compared the 'within' and 'between' variance of uncertainty at a subsector level. The idea was that a difference in factor loadings for aggregate shocks might be due to industry-specific adjustments and production technologies. They argue that the finding of high 'within' variance and the low 'between' variance, implies that time-series movements in dispersion are not explained by manufacturing subsectors becoming more or less different over the business cycle. 

Accordingly, @Girardi2015 suggested scaling the forward-looking dispersion measures $D^1_t$ in period $t$ by the dispersion of responses to questions on current conditions $D^0_{t+1}$ in period $t+1$. The idea is that respondents' assessments of current conditions should not be uncertain. The dispersion of a 'current conditions' question does not reflect uncertainty, but rather the degree to which conditions differ between respondents. The dispersion of forward-looking questions reflects both the 'natural' degree of dispersion and uncertainty about the future. This proxy therefore measures the extent of uncertainty, expressed as a share of the 'natural' dispersion. The disadvantage of this indicator is that it is an *ex post* measure, which requires the outcome at time $t+1$ before computing the indicator [@Girardi2015].

The first uncertainty indicator $D_t$, or 'dispersion', is the weighted cross-sectional standard deviation of forward-looking responses $D^1_t$ at time $t$, scaled by the weighted cross-sectional standard deviation of responses on current conditions $D^0_{t+1}$ at time $t+1$. More formally: 
$$D^{0}_{t+1} = \frac{1}{W_{t+1}} \sum^N_{i=1} (w_{it+1} E_{t+1} f(\Delta^4 Y_{i,t+1}) - \mu_{t+1})^2 $$
$$D_t = \frac{D^{1}_t}{D^{0}_{t+1}} $$

@Bachmann2010 and @Bachmann2013 recommended the use of individual firms' forecast errors to estimate proxies for uncertainty. The panel dimension of the survey was exploited to construct the *ex post* forecast errors. Pairs of questions were used to construct the forecast errors for each respondent, by comparing the expectations in period $t$ for a specific question with the realisations for that question in period $t+1$. For instance, the survey responses to Q2P in period $t$ were used to extract the expectations of general business conditions in time $t+1$ relative to $t-3$. The errors were then calculated by subtracting these expectations from the realisations of the responses to Q2A at time $t+1$ relative to $t-3$. The forecast errors $\epsilon_{i,t+1}$ in period $t+1$ may be defined as the realisations $E_{t+1} f(\Delta^4 Y_{i,t+1})$ of a specific outcome in period $t+1$ minus the expectations $E_t f(\Delta^4 Y_{i,t+1})$ in period $t$ of that outcome in period $t+1$: 
$$\epsilon_{i,t+1} = E_{t+1} f(\Delta^4 Y_{i,t+1}) - E_t f(\Delta^4 Y_{i,t+1})$$

Table 3.3 illustrates the nine possible forecast errors. For example, for a firm that expected an improvement in (i.e. better) conditions, the realisation of better conditions would be recorded as a 0 forecast error, no change as a -1 forecast error, and poorer conditions as a -2 forecast error. 

\begin{table}[]
\centering
\caption{Possible forecast errors}
\label{my-label}
\begin{tabular}{llrrr}
                          &                                &                             & $Q2A_{t+1}$               &                             \\ \cline{2-5} 
\multicolumn{1}{l|}{}     & \multicolumn{1}{l|}{}          & \multicolumn{1}{r|}{Better} & \multicolumn{1}{r|}{Same} & \multicolumn{1}{r|}{Poorer} \\ \cline{2-5} 
\multicolumn{1}{l|}{}     & \multicolumn{1}{l|}{E(Better)} & \multicolumn{1}{r|}{0}      & \multicolumn{1}{r|}{-1}   & \multicolumn{1}{r|}{-2}     \\ \cline{2-5} 
\multicolumn{1}{l|}{$Q2P_t$} & \multicolumn{1}{l|}{E(Same)}   & \multicolumn{1}{r|}{1}      & \multicolumn{1}{r|}{0}    & \multicolumn{1}{r|}{-1}     \\ \cline{2-5} 
\multicolumn{1}{l|}{}     & \multicolumn{1}{l|}{E(Poorer)} & \multicolumn{1}{r|}{2}      & \multicolumn{1}{r|}{1}    & \multicolumn{1}{r|}{0}      \\ \cline{2-5} 
\end{tabular}
\end{table}

@Arslan2011 argued that firms make forecast errors because of uncertainty and that forecast errors should be treated as uncertainty. Following @Arslan2011, the second measure of uncertainty $A_t$, or 'aggregate error' uncertainty, is the square of the weighted cross-sectional mean of the forecast errors made across firms in each quarter:
$$A_t = \bar \epsilon_{it+1}^2 ,$$
where $\bar \epsilon_{it} = \frac{1}{W_t}\sum_{i=1}^N w_{it} \epsilon_{it}$. 

Aggregate error uncertainty increases if more firms make similar and larger forecast errors. Thus, if more firms make the same forecast errors, aggregate error uncertainty will increase. If the same proportion of firms make positive and negative forecast errors, it implies zero aggregate error uncertainty. This is akin to the measure based on the mean of the absolute forecast errors proposed in @Bachmann2013.

The third measure of uncertainty $I_t$, or 'idiosyncratic error' uncertainty, is the weighted cross-sectional standard deviation of the forecast errors in each quarter:
$$I_t = \frac{1}{W_{t+1}}\sum_{i=1}^N (w_{it+1} \epsilon_{it+1} - \bar{\epsilon}_{t+1})^2 ,$$
where the variables are defined in the same way as above. 

This proxy measures how individual firms depart from the overall mean forecast error. Idiosyncratic error uncertainty increases if firms make more dispersed forecast errors. If all firms make the same forecast error, it implies zero idiosyncratic error uncertainty. This is the measure of uncertainty proposed in @Bachmann2013.

Although these measures are based on the realised forecast errors in the next quarter $t+1$, they depend on the knowledge and level of uncertainty in the current quarter $t$. Thus, the mean and standard deviation of realised forecast errors at time $t+1$ constitutes uncertainty in $t$ [@Bachmann2010]. 

The composite uncertainty indicators for each sector are then calculated as the average of the same set of survey questions reported in Table 3.2. This should reduce their likelihood of producing 'false positives', i.e. signalling high uncertainty where there is none, and 'false negatives', i.e. failure to detect mounting uncertainty [@Girardi2015]. The sectoral indicators are then aggregated with GDP shares as weights, to form the overall uncertainty indicators. 

Thus, there are three distinct proxies for business uncertainty: dispersion $D_t$, aggregate error uncertainty $A_t$ and idiosyncratic error uncertainty $I_t$. Business uncertainty can come from a number of sources and may manifest itself in an array of variables [@Jurado2015]. Hence, this chapter also investigates two further proxies for uncertainty, namely economic policy uncertainty and financial market uncertainty. 

The economic policy uncertainty indicator is the news-based EPU index created by @Hlatshwayo2016, discussed above. It is constructed by counting the number of articles that contained 3 mentions of words related to policy, economics, and uncertainty within 10 words of 'South Africa'. The absolute counts were normalised and the index was standardised.

The financial market uncertainty indicator is a combination of implied and realised stock market volatility. The South African Volatility Index (SAVI) is a forecast of equity market risk on the Johannesburg Stock Exchange (JSE). It is modelled on the VIX, a popular measure for the volatility of the S&P 500, which has been used in a number of studies (e.g. @Bloom2009). The SAVI is a forward-looking index that provides a daily prediction of market volatility in three months' time. It is calculated using implied volatilities obtained daily from specific Top 40 options [@JSE2014]. The SAVI is available only from June 2007. Following the literature (e.g. @Bloom2009, @Valencia2013, @Bachmann2013 and @Redl2015), an index of realised stock return volatility was calculated as the standard deviation of the daily JSE All Share index for each quarter. The realised volatility for the period before June 2007 was then chained to the SAVI. 

The three survey-based uncertainty indicators can be combined with these two alternative indicators to form an overall uncertainty indicator for South Africa. The idea is to iron out the remaining idiosyncrasies by averaging the indicators to incorporate information from different sources of uncertainty. This is similar to practices in the literature, where uncertainty indicators are constructed from a range of different proxies (e.g. @Baker2007; @Baker2015, @Redl2015 and @NWU2016). In constructing their uncertainty measure, @Baker2007 and @Baker2015 use a simple average of their proxies, as well as the first principal component of the series.

In this chapter, the first principal component of the five standardised uncertainty proxies is used as an overall combined uncertainty measure ('combined'). A number of papers have used principal component analysis (PCA), or the related factor analysis, to reduce the dimensionality of their data (see @Stock2002 for a seminal contribution, and @Gupta2011, and @Bosch2013 for South African applications). PCA is used to reduce the dimensionality of a dataset consisting of a large number of variables, while retaining as much of the variation as possible [@Jolliffe2002]. The transformation is defined in such a way that the first principal component accounts for as much of the variability in the data as possible (see @Jolliffe2002 for a complete derivation of PCA). The results presented below indicate that the combined indicator exhibits a larger correlation with movements in real output growth than any of the separate components. The results are similar for an equal-weighted overall combined uncertainty index.

###Weighing the Survey Responses
In this section the weights used to calculate the sentiment indicators are presented. As discussed above, the weights for each respondent consist of a firm size weight, reflecting turnover, and a subsector weight, reflecting the share of value added for the subsector. The weights are calculated as: $w_{it} = f_{it} s_{jt} / F_{jt} ,$ where $f_{it}$ the firm size weight for firm $i$ at time $t$; $s_{jt}$ is the subsector weight for subsector $j$ at time $t$; and $F_{jt} = \sum^N_{i=1} f_{it}$ is the total firm weight for subsector $j$ at time $t$. These weights are equivalent to an explicit two-step weighting procedure, whereby weighted means are calculated for each subsector separately (using firm size weights), and then aggregated with the subsector weights [@UN2015].

Firm size weights were recorded by the BER for all respondents. The firm size weights are divided into nine categories. In this chapter, these firm size weights are applied to all the responses in all of the subsectors. In contrast, the BER uses exponential firm weights based on the nine categories, except for the building and motor vehicle surveys, where no weights are applied. 

Figure 3.2 to Figure 3.5 illustrate the subsector weights for each of the four main sectors: manufacturing, construction, trade and services. The weights for the manufacturing subsectors are updated periodically by the BER, based on the composition of production or sales in each subsector, as calculated by StatsSA. The subsector weights are cleaned versions of those used by the BER in calculating its Manufacturing BCI.

```{r manweights, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
#Illustrating weights
BER.M <- BER[BER$Sector=="Manufacturing",]
BER.M$Sector <- as.character(BER.M$Sector)
manufacturings <- unique(BER.M$sector)

food <- c(1010, 1011,1013,1019,1020,1021)
textiles <- c(1120,1040,1049,1042,1060,1070)
wood <- c(1109,1110,1080,1081)
chemicals <- c(1130,1140,1149,1219)
glass <- c(1153,1159)
metals <- c(1160,1161,1170,1179,1181,1182,1189)
electrical <- c(1190,1191,1199,1192,1194)
transport <- c(1200,1201,1209)
furniture <- c(1090,1099)


BER.M$Sector[BER.M$sector %in% food] <- "Food" 
BER.M$Sector[BER.M$sector %in% textiles] <- "Textiles" 
BER.M$Sector[BER.M$sector %in% wood] <- "Wood" 
BER.M$Sector[BER.M$sector %in% chemicals] <- "Chemicals" 
BER.M$Sector[BER.M$sector %in% glass] <- "Glass" 
BER.M$Sector[BER.M$sector %in% metals] <- "Metals" 
BER.M$Sector[BER.M$sector %in% electrical] <- "Eelectrical" 
BER.M$Sector[BER.M$sector %in% transport] <- "Transport" 
BER.M$Sector[BER.M$sector %in% furniture] <- "Furniture" 


BER.M$sectorw <- BER.M$factor/BER.M$weight
BERplot <- aggregate(BER.M$sectorw, by=list(BER.M$surveyQ,BER.M$sector,BER.M$Sector), FUN = mean, na.rm=TRUE)
colnames(BERplot) <- c("surveyQ","sector","Sector","weight")
BERplot1 <- dcast(BERplot, formula = surveyQ ~ Sector + sector)
BERplot1 <- merge(datums,BERplot1,by.x="Date",by.y ="surveyQ")
BERplot1[,-1:-2] <- na.locf(BERplot1[,-1:-2],fromLast = TRUE)
BERplot1[,-1:-2] <- na.locf(BERplot1[,-1:-2])

BERplot <- BERplot1
BERplot$Food <- rowMeans(BERplot1[,12:17])
BERplot$Textiles <- rowMeans(BERplot1[,29:34])
BERplot$Wood <- rowMeans(BERplot1[,38:41])
BERplot$Chemicals <- rowMeans(BERplot1[,3:6])
BERplot$Glass <- rowMeans(BERplot1[,20:21])
BERplot$Metals <- rowMeans(BERplot1[,22:28])
BERplot$Eelectrical <- rowMeans(BERplot1[,7:11])
BERplot$Transport <- rowMeans(BERplot1[,35:37])
BERplot$Furniture <- rowMeans(BERplot1[,18:19])
BERplot <- BERplot[,c(1,42:50)]
BERplot$Total <- rowSums(BERplot[,2:10])
BERplot[,-1] <- BERplot[,-1]/BERplot[,11]
```

```{r figure3.2, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Subsector weights applied in the manufacturing sector"}
BERplot$Date <- as.Date(as.yearqtr(BERplot$Date, format = "%YQ%q"), frac = 1)
BERplot <- BERplot[,c(1,5,8,2,10,6,7,3,9,4,11)]
index_plot <- melt(BERplot[,-11], id="Date")
g <- ggplot(index_plot, aes(x=Date,y=value,group=variable,fill=variable)) 
g <- g + geom_bar(stat="identity")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + scale_fill_discrete(name="Sub-sector")
g <- g + scale_y_continuous(labels=comma)
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))
g <- g + ylab("Weights") + xlab("Date")
g <- g + guides(fill = guide_legend(reverse = TRUE))
g
```

Subsector weights are not recorded by the BER for the construction sector. The BER Building BCI is based on the unweighted responses for contractors only. In this chapter, the relative subsector weights are set equal to the average number of respondents for each subsector over the period. The results are similar when using an equal weighting procedure. The microdata for architects, quantity surveyors and civil engineers are only available from 2001Q1.

```{r buildweights, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
BER.B <- BER[BER$Sector=="Construction",]
BER.B$Sector <- as.character(BER.B$Sector)
constructs <- unique(BER.B$sector)

contractor_res <- 5000
contractor_nonres <- 5010
subcon_res <- 6000
subcon_nonres <- 6010
arc <- 99
qs <- 88
civils <- c(700,701,702,703)

BER.B$Sector[BER.B$sector %in% contractor_res] <- "Contractor (Residential)" 
BER.B$Sector[BER.B$sector %in% contractor_nonres] <- "Contractor (Non-Residential)" 
BER.B$Sector[BER.B$sector %in% subcon_res] <- "Sub-contractor (Residential)" 
BER.B$Sector[BER.B$sector %in% subcon_nonres] <- "Sub-contractor (Non-Residential)" 

BER.B$Sector[BER.B$sector %in% arc] <- "Architects" 
BER.B$Sector[BER.B$sector %in% qs] <- "Quantity Surveyors" 
BER.B$Sector[BER.B$sector %in% civils] <- "Civil Engineers" 

BER.B$sectorw <- BER.B$factor/BER.B$weight

BERplot <- aggregate(BER.B$sectorw, by=list(BER.B$surveyQ,BER.B$sector,BER.B$Sector), FUN = mean,na.rm=TRUE)
colnames(BERplot) <- c("surveyQ","sector","Sector","weight")
BERplot1 <- dcast(BERplot, formula = surveyQ ~ Sector + sector)
BERplot1 <- merge(datums,BERplot1,by.x="Date",by.y ="surveyQ")
#BERplot1[,-1:-2] <- na.locf(BERplot1[,-1:-2],fromLast = TRUE)
BERplot1[,-1:-2] <- na.locf(BERplot1[,-1:-2])

BERplot <- BERplot1
BERplot$Arc <- BERplot1[,3]
BERplot$Civils <- rowMeans(BERplot1[,4:7],na.rm=TRUE)
BERplot$Con_nonres <- BERplot1[,8]
BERplot$Con_res <- BERplot1[,9]
BERplot$QS <- BERplot1[,10]
BERplot$Sub_nonres <- BERplot1[,11]
BERplot$Sub_res <- BERplot1[,12]
BERplot <- BERplot[,c(1,13:19)]
BERplot$Total <- rowSums(BERplot[,2:8],na.rm=TRUE)
BERplot[,-1] <- BERplot[,-1]/BERplot[,9]
colnames(BERplot) <- c("Date","Architects","Civil Engineers","Contractor (Non-Residential)","Contractor (Residential)",
                       "Quantity Surveyors","Sub-contractor (Non-Residential)","Sub-contractor (Residential)")
```

```{r figure3.3, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Subsector weights applied in the construction sector"}
BERplot$Date <- as.Date(as.yearqtr(BERplot$Date, format = "%YQ%q"), frac = 1)
#BERplot <- BERplot[,c(1,5,4,8,7,2,3,6)]
index_plot <- melt(BERplot[,-9], id="Date")
g <- ggplot(index_plot, aes(x=Date,y=value,group=variable,fill=variable)) 
g <- g + geom_bar(stat="identity")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + scale_fill_discrete(name="Sub-sector")
g <- g + scale_y_continuous(labels=comma)
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))
g <- g + ylab("Weights") + xlab("Date")
g <- g + guides(fill = guide_legend(reverse = TRUE))
g
```

The BER also updates the weights for the retail and wholesale subsectors periodically. The weights for these subsectors in this chapter are the same as those used by the BER in calculating its Retail and Wholesale BCIs. The BER Motor Vehicle BCI does not receive a subsector weighting. The BER assumes an equal weighting for the retail, wholesale and motor vehicle subsectors when calculating its total BCI. In this chapter, the relative weights are set equal to the average number of respondents for each subsector over the sample period. The results are similar when using an equal weighting procedure.

```{r tradeweights, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
BER.T <- BER[BER$Sector=="Trade",]
BER.T$Sector <- as.character(BER.T$Sector)
trades <- unique(BER.T$sector)

retailsd <- c(3110,3120,3160,3140,3130,3170,3150)
retailnd <- c(3230,3210,3240,3220)
retaild <- c(3330,3370,3310,3340,3350,3320,3380,3360)
retailo <- c(3410,3420,0,NA)
wholenc <- c(2120,2110,2130,2140)
wholec <- c(2250,2220,2230,2240,2210,2270,2260)
motor <- c(3510)

BER.T$Sector[BER.T$sector %in% retailsd] <- "Retail (semi-durable)" 
BER.T$Sector[BER.T$sector %in% retailnd] <- "Retail (non-durable)" 
BER.T$Sector[BER.T$sector %in% retaild] <- "Retail (durable)" 
BER.T$Sector[BER.T$sector %in% retailo] <- "Retail (other)" 
BER.T$Sector[BER.T$sector %in% wholenc] <- "Wholesale (non-consumer)" 
BER.T$Sector[BER.T$sector %in% wholec] <- "Wholesale (consumer)" 
BER.T$Sector[BER.T$sector %in% motor] <- "Motor Trade" 


BER.T$sectorw <- BER.T$factor/BER.T$weight
BERplot <- aggregate(BER.T$sectorw, by=list(BER.T$surveyQ,BER.T$sector,BER.T$Sector), FUN = mean, na.rm=TRUE)
colnames(BERplot) <- c("surveyQ","sector","Sector","weight")
BERplot1 <- dcast(BERplot, formula = surveyQ ~ Sector + sector)
BERplot1 <- merge(datums,BERplot1,by.x="Date",by.y ="surveyQ")
BERplot1[,-1:-2] <- na.locf(BERplot1[,-1:-2],fromLast = TRUE)
BERplot1[,-1:-2] <- na.locf(BERplot1[,-1:-2])
BERplot1[16,4] <- 0.04
BERplot1[16,18] <- 0.12

BERplot <- BERplot1
BERplot$retailsd <- rowMeans(BERplot1[,18:24])
BERplot$retailnd <- rowMeans(BERplot1[,12:15])
BERplot$retaild <- rowMeans(BERplot1[,4:11])
BERplot$retailo <- rowMeans(BERplot1[,16:17],na.rm = TRUE)
BERplot$wholenc <- rowMeans(BERplot1[,32:35])
BERplot$wholec <- rowMeans(BERplot1[,25:31])
BERplot$motor <- BERplot1[,3]
BERplot <- BERplot[,c(1,36:42)]
BERplot$Total <- rowSums(BERplot[,2:8])
BERplot[,-1] <- BERplot[,-1]/BERplot[,9]
colnames(BERplot) <- c("Date","Retail (semi-durable)","Retail (non-durable)","Retail (durable)","Retail (other)",
                       "Wholesale (non-consumer)","Wholesale (consumer)","Motor Trade")
```

```{r figure3.4, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Subsector weights applied in the trade sector"}
BERplot$Date <- as.Date(as.yearqtr(BERplot$Date, format = "%YQ%q"), frac = 1)
BERplot <- BERplot[,c(1,8,4,3,5,2,7,6,9)]
index_plot <- melt(BERplot[,-9], id="Date")
g <- ggplot(index_plot, aes(x=Date,y=value,group=variable,fill=variable)) 
g <- g + geom_bar(stat="identity")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + scale_fill_discrete(name="Sub-sector")
g <- g + scale_y_continuous(labels=comma)
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))
g <- g + ylab("Weights") + xlab("Date")
g <- g + guides(fill = guide_legend(reverse = TRUE))
g
```

Subsector weights are not recorded by the BER for the services sector and the BER does not publish a Services BCI. In this chapter, the weights are set equal to the average number of respondents for each subsector over the sample period, although the results are similar when using equal weights. 

```{r serveweights, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
BER.S <- BER[BER$Sector=="Services",]
BER.S$Sector <- as.character(BER.S$Sector)
servicess <- unique(BER.S$sector)[!is.na(unique(BER.S$sector))]


#Illustrating weights
catering <- c(6001,6020,6030,6011,NA)
transport <- c(7020,7010,7070,7090,7080,7060,7000,7040,7100,7120,7110,7050)
realestate <- c(8000,8010,8020)
business <- c(8040,8080,8070,8090,8060,8050,8030)
other <- c(8150,8120,8210,8180,8140,8160,8190,8100,8200,8230,8130,8110,8170,8240,8220)
community <- c(9000,9010,9030,9050,9060,9020,9040)


BER.S$Sector[BER.S$sector %in% catering] <- "Catering and Accommodation" 
BER.S$Sector[BER.S$sector %in% transport] <- "Transport and Storage" 
BER.S$Sector[BER.S$sector %in% realestate] <- "Real Estate" 
BER.S$Sector[BER.S$sector %in% business] <- "Business Services" 
BER.S$Sector[BER.S$sector %in% other] <- "Other Business Activities" 
BER.S$Sector[BER.S$sector %in% community] <- "Community and Personal Services" 


BER.S$sectorw <- BER.S$factor/BER.S$weight
BERplot <- aggregate(BER.S$sectorw, by=list(BER.S$surveyQ,BER.S$sector,BER.S$Sector), FUN = mean, na.rm=TRUE)
colnames(BERplot) <- c("surveyQ","sector","Sector","weight")
BERplot1 <- dcast(BERplot, formula = surveyQ ~ Sector + sector)
BERplot1 <- merge(datums,BERplot1,by.x="Date",by.y ="surveyQ")
BERplot1[,-1:-2] <- na.locf(BERplot1[,-1:-2],fromLast = TRUE)
BERplot1[,-1:-2] <- na.locf(BERplot1[,-1:-2])

BERplot <- BERplot1
BERplot$catering <- rowMeans(BERplot1[,11:14])
BERplot$transport <- rowMeans(BERplot1[,39:50])
BERplot$realestate <- rowMeans(BERplot1[,37:38])
BERplot$business <- rowMeans(BERplot1[,3:10])
BERplot$other <- rowMeans(BERplot1[,22:36])
BERplot$community <- rowMeans(BERplot1[,15:21])
BERplot <- BERplot[,c(1,51:56)]
BERplot$Total <- rowSums(BERplot[,2:7])
BERplot[,-1] <- BERplot[,-1]/BERplot[,8]
colnames(BERplot) <- c("Date","Catering and Accommodation","Transport and Storage","Real Estate","Business Services",
                       "Other Business Activities","Community and Personal Services")
```

```{r figure3.5, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Subsector weights applied in the services sector"}
BERplot$Date <- as.Date(as.yearqtr(BERplot$Date, format = "%YQ%q"), frac = 1)
BERplot <- BERplot[,c(1,5,2,7,6,4,3,8)]
index_plot <- melt(BERplot[,-8], id="Date")
g <- ggplot(index_plot, aes(x=Date,y=value,group=variable,fill=variable)) 
g <- g + geom_bar(stat="identity")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + scale_fill_discrete(name="Sub-sector")
g <- g + scale_y_continuous(labels=comma)
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))
g <- g + ylab("Weights") + xlab("Date")
g <- g + guides(fill = guide_legend(reverse = TRUE))
g

```

Figure 3.6 illustrates the GDP share weights that are used in aggregating the four sector indicators to calculate the aggregate indicators. The BER BCI, in contrast, is a simple equal weighted average of the sectoral indicators for manufacturing, contractors, retail, wholesale, and motor vehicles.  

```{r figure3.6, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="GDP share weights applied to the main sectors"}
weights <- GDPdata[,c(1:4,6)]
index_plot <- weights
index_plot[,-1] <- na.locf(index_plot[,-1],fromLast = TRUE)
index_plot[,2:5] <- index_plot[,2:5]/rowSums(index_plot[,2:5],na.rm=TRUE)
index_plot <- melt(index_plot, id="Date")
g <- ggplot(index_plot, aes(x=Date,y=value,group=variable,fill=variable)) 
g <- g + geom_bar(stat="identity")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + scale_fill_discrete(name="Sub-sector")
g <- g + scale_y_continuous(labels=comma)
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))
g <- g + ylab("Weights") + xlab("Date")
g <- g + guides(fill = guide_legend(reverse = TRUE))
g
```

Naturally, there are other ways to weigh the responses, but experience has shown that the balances are not very sensitive to the choice of weighting procedure [@OECD2003]. Indeed, in this case the specific weighting procedure turns out to have little impact on the confidence indices. The unweighted versions of the indicators, calculated by stacking all of the available responses from all the surveys (i.e. completely unweighted), are very similar to the weighted versions. The application of the BER weights also provides similar results.  The specific weighting procedure adopted therefore does not significantly alter the results.

This confirms the findings by @Kershoff2015, who tested alternative weighting procedures: a different allocation of firm size weights; the introduction of dynamic individual weights (post-stratification), to provide for changes in response patterns (to handle non-responses); the application of a two-step weighting procedure; the inclusion of latecomers to increase the number of responses; and the use of different sector size weights for export variables. The findings showed that the balance statistics were not sensitive to the use of alternative weighting procedures. The following section presents the confidence and uncertainty indicators.

##Results: Confidence
This section presents the composite sectoral and aggregate business confidence indicators for South Africa. Simple linear interpolation is used for the few missing quarters. The validity of the indicators is assessed by comparing them with existing measures of confidence for South Africa. The indicators are then evaluated according to their comovement with real GDP growth (i.e. their tracking record), to assess whether they improve on the existing indicators of confidence.

###Confidence Indicators
```{r confidence, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
calc_wconf <- function(data) {
    ##Weighted versions
    weeg <- function(temp) {  #calculate weighted mean for each quarter for all columns
        temp <- cbind(factor=temp$factorn,temp$factorn*temp[(match("surveyQ",colnames(temp))+1):ncol(temp)])
        #temp <- colSums(temp, na.rm=TRUE, dims = 1)/sum(temp$factor, na.rm=TRUE)
        #calculate the sum(wi*xi)/sum(wi)
        temp <- colSums(temp, na.rm=TRUE, dims = 1)/    
            sapply(colnames(temp), function(x) sum(temp$factor[!is.na(temp[colnames(temp) == x])]))
        #weight only by those that responded to a specific question
        return(temp)
    }
    
    w.confidence <- as.data.frame(t(sapply(levels(data$surveyQ), function(kwartaal) weeg(data[data$surveyQ==kwartaal,]))))
    w.confidence$Conf_cc <- rowMeans(w.confidence[,c("Q1","Q2A","Q3A","Q4A","Q6A")],na.rm = TRUE, dims = 1)
    w.confidence$Conf_fl <- rowMeans(w.confidence[,c("Q2P","Q3P","Q4P","Q6P")],na.rm = TRUE, dims = 1)
    #w.confidence$Conf_all <- rowMeans(w.confidence[,c("Q1","Q2A","Q3A","Q4A","Q5A","Q6A","Q2P","Q3P","Q4P","Q5P","Q6P")],na.rm = TRUE, dims = 1)
    w.confidence <- merge(datums,w.confidence,by.x="Date",by.y="row.names", all=TRUE)[,-3]
    w.confidence[,14:15] <- na.approx(w.confidence[,14:15],na.rm = FALSE)
    
    return(w.confidence)
}

w.indicators.M <- calc_wconf(BER[BER$Sector=="Manufacturing",])
w.indicators.B <- calc_wconf(BER[BER$Sector=="Construction",])
w.indicators.T <- calc_wconf(BER[BER$Sector=="Trade",])
w.indicators.S <- calc_wconf(BER[BER$Sector=="Services",])

seisoen <- function(product) {
    for(i in 2:ncol(product)) {
        product[,i] <- na.locf(product[,i], na.rm=FALSE, fromLast=TRUE)
        m <- ts(product[,i],start=c(1992,01), end= c(2016,3), frequency = 4)
        dec <- decompose(m, "additive")
        product[,i] <- as.numeric(m - dec$seasonal)
    }
    return(product)
}

##Weighted versions
weights <- GDPdata[,c(1:4,6)]
activity <- cbind(w.indicators.M[,c(2,14)],w.indicators.B[,14],w.indicators.T[,14],w.indicators.S[,14])
colnames(activity) <- c("Date","Manufacturing","Construction","Trade","Services")
conf <- cbind(w.indicators.M[,c(2,15)],w.indicators.B[,15],w.indicators.T[,15],w.indicators.S[,15])
colnames(conf) <- c("Date","Manufacturing","Construction","Trade","Services")

activity <- seisoen(activity)
conf <- seisoen(conf)
activity[1:5,3] <- NA
conf[1:5,3] <- NA
activity[1,4] <- NA
conf[1,4] <- NA
activity[1:53,5] <- NA
conf[1:53,5] <- NA

#create weighted means by GDP share
activity$Activity <- sapply(activity$Date, function(x) weighted.mean(activity[which(activity$Date==x),c(2:5)], 
                                                                     weights[weights$Date==x,-1],na.rm=TRUE))
conf$Confidence <- sapply(conf$Date, function(x) weighted.mean(conf[which(conf$Date==x),c(2:5)], 
                                                               weights[weights$Date==x,-1],na.rm=TRUE))
w.indicators <- cbind(activity[,c(1,6)],conf[,6])
#w.indicators <- seisoen(w.indicators)
colnames(w.indicators) <- c("Date","Activity","Confidence")
#w.indicators$C <- -1*princomp(w.indicators[,2:3])$scores[,1]
```

Figure 3.7 illustrates the weighted sectoral confidence indicators for current conditions (current) and expected conditions (expected). The confidence indicators on expected conditions lead the indicators on current conditions in each of the sectors, with turning points generally before the current conditions measures. This is what one would expect, given that the expected conditions indicators are based on forward-looking questions. 

The indicators appear to capture cyclical movements in the sectors. In general, they display an increase in the early 1990s until just after the first Democratic Elections in 1994Q2. They show a sustained decrease from 1995 into the recession of 1997-1998, associated with the East Asian and Russian crises. After troughs around the start of 1999, the indicators increase up to the global financial crisis at the end of 2007. During this extended upswing phase, the manufacturing and trade sectors reflect the two ambiguous periods in 2001 and 2003, when contractions in the SARB leading and coincident indicators obliged an evaluation of possible reference turning points [@Venter2005a]. The construction sector exhibited a particularly strong and sustained increase in confidence during this upswing phase, possibly due to the construction projects associated with hosting the FIFA World Cup.

The global financial crisis was followed by a large decline in the indicators for all of the sectors, which continued into the subsequent Great Recession. There was a relatively quick recovery in confidence in the manufacturing and trade sectors. Confidence in the construction sector showed a more gradual recovery, especially in confidence about current conditions (current). In the services sector, confidence about current conditions showed a slight recovery and then continued to decline, whereas confidence about expected conditions was quite erratic. The indicators for the other sectors exhibit a gradual decrease from around 2012, continuing into the downswing phase at the end of the sample period.

```{r figure3.7, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Weighted sectoral confidence indicators on current and expected conditions"}
index_plot <- cbind(activity[,1:2],conf[,2])
#index_plot <- w.indicators.M[,c(2,14:15)]
#colnames(index_plot) <- c("Date","Activity","Confidence")
colnames(index_plot) <- c("Date","Confidence_Current","Confidence_Expected")
index_plot <- melt(index_plot, id="Date")  # convert to long format
g1 <- ggplot(index_plot, aes(x=Date,y=value,group=variable,colour=variable)) 
g1 <- g1 + geom_line()
g1 <- g1 + theme(legend.title=element_blank())
g1 <- g1 + ggtitle("Manufacturing") 
g1 <- g1 + ylab("Indicator") + xlab("")
g1 <- g1 + theme(legend.position="none")
g1 <- g1 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g1 <- g1 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(activity[,c(1,3)],conf[,3])
#index_plot <- w.indicators.B[,c(2,14:15)]
#colnames(index_plot) <- c("Date","Activity","Confidence")
colnames(index_plot) <- c("Date","Confidence_Current","Confidence_Expected")
index_plot <- melt(index_plot, id="Date")  # convert to long format
g2 <- ggplot(index_plot, aes(x=Date,y=value,group=variable,colour=variable)) 
g2 <- g2 + geom_line()
g2 <- g2 + theme(legend.title=element_blank())
g2 <- g2 + ggtitle("Construction") 
g2 <- g2 + ylab("") + xlab("")
g2 <- g2 + theme(legend.position="none")
g2 <- g2 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g2 <- g2 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(activity[,c(1,4)],conf[,4])
#index_plot <- w.indicators.T[,c(2,14:15)]
#colnames(index_plot) <- c("Date","Activity","Confidence")
colnames(index_plot) <- c("Date","Confidence_Current","Confidence_Expected")
index_plot <- melt(index_plot, id="Date")  # convert to long format
g3 <- ggplot(index_plot, aes(x=Date,y=value,group=variable,colour=variable)) 
g3 <- g3 + geom_line()
g3 <- g3 + theme(legend.title=element_blank())
g3 <- g3 + ggtitle("Trade") 
g3 <- g3 + ylab("Indicator") + xlab("")
g3 <- g3 + theme(legend.position="bottom",plot.margin=unit(c(-0.5,0.4,0,0.4), "cm"))
g3 <- g3 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g3 <- g3 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(activity[,c(1,5)],conf[,5])
#index_plot <- w.indicators.S[-1:-52,c(2,14:15)]
#colnames(index_plot) <- c("Date","Activity","Confidence")
colnames(index_plot) <- c("Date","Confidence_Current","Confidence_Expected")
index_plot <- melt(index_plot, id="Date")  # convert to long format
g4 <- ggplot(index_plot, aes(x=Date,y=value,group=variable,colour=variable)) 
g4 <- g4 + geom_line()
g4 <- g4 + theme(legend.title=element_blank())
g4 <- g4 + ggtitle("Services") 
g4 <- g4 + ylab("") + xlab("")
g4 <- g4 + theme(legend.position="bottom",plot.margin=unit(c(-0.5,0.4,0,0.4), "cm"))
g4 <- g4 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g4 <- g4 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

library(gridExtra)
grid.arrange(g1, g2, g3, g4, ncol=2, nrow =2)
```

Figure 3.8 illustrates the weighted aggregate confidence indicators on current and expected conditions. The shaded areas denote the recessionary periods according to the official turning points of the SARB. The indices follow a similar cyclical trend over the period and are very highly correlated, as is reported in Table 3.4, below. 

The confidence indicator on expected conditions leads changes in the confidence indicator on current conditions to some extent. The indicators appear to match the different phases of the business cycle relatively well. Turning points are generally before the official turning points, as is discussed in more detail below. The indicators exhibit an increase following the recession of the early 1990s, with peaks around 1995. There is a prolonged decrease into the recession of 1997-1998, and a strong recovery just before the official trough in 1999. Both ambiguous periods are reflected in moderate decreases in the indicators in 2001 and 2003. Both indicators exhibit a significant decrease following the global financial crisis in 2007, and a relatively mild recovery just before the official trough in 2009. The indicators are relatively flat during the previous upswing phase (2010-2013) and decrease gradually during the downswing phase at the end of the sample period. 

```{r figure3.8, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Weighted confidence indicators on current and expected conditions"}
index_plot <- w.indicators
#colnames(index_plot) <- c("Date","Activity","Confidence")
colnames(index_plot) <- c("Date","Confidence_Current","Confidence_Expected")
g <- ggplot(index_plot) 
g <- g + geom_line(aes(x=Date, y=Confidence_Current, colour="Confidence_Current"), size = 1)
g <- g + geom_line(aes(x=Date, y=Confidence_Expected, colour="Confidence_Expected"), size = 1)
#g <- g + geom_line(aes(x=Date, y=C, colour="C"), size = 1)
g <- g + labs(color="Legend text")
g <- g + geom_rect(data=recessions.df, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='grey', alpha=0.5)
g <- g + ylab("Indicator") + xlab("")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + theme(legend.title=element_blank()) 
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"), expand=c(0,0), 
                      limits = as.Date(c("1990-12-31", NA)))
g <- g + theme(legend.position="bottom")
g
```

The survey-based confidence indicators therefore appear to be plausible and potentially useful indicators of business confidence in South Africa. The following section provides an assessment of the validity of the confidence indicators, by testing their conformity to the BER and SACCI BCIs, and evaluates the indicators in terms of their tracking record, i.e. the extent to which they track real GDP growth. 

###Validity Tests and Evaluation
This section provides a comparison of the characteristics of the confidence indicators on current and expected conditions to the two existing South African business confidence indices, the BER BCI and the SACCI BCI. Correlations are used to analyse the tracking record of the indicators with respect to their reference series (i.e. real GDP growth). The relationships between turning points is reported, to assess their usefulness as leading indicators of the business cycle. 

####Correlations between confidence indicators and real GDP growth
Figure 3.9 compares the confidence indicators on current and expected conditions with the BER and SACCI BCIs, as well as real GDP growth. Real GDP growth is calculated as annual quarter-on-quarter growth rates, e.g. 2015Q1 over 2014Q1, which corresponds to the reference period in the BER surveys. The official recessionary periods are shaded, and the indicators are standardised for plotting. The indicators appear to be strongly pro-cyclical, and follow real GDP growth closely. 

```{r figure3.9, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Confidence indicators compared to real GDP growth"}
conf_indices <- cbind(w.indicators,GDPdata$BER_BCI, GDPgrowth4$SACCI,GDPgrowth4$RGDP)
#colnames(conf_indices) <- c("Date","Activity","Confidence","BER_BCI","SACCI_Growth","RGDP_Growth")
colnames(conf_indices) <- c("Date","Confidence_Current","Confidence_Expected","BER_BCI","SACCI_Growth","RGDP_Growth")

conf_indices1 <- cbind(w.indicators,GDPdata$BER_BCI, GDPdata$SACCI,GDPgrowth4$RGDP)
#colnames(conf_indices1) <- c("Date","Activity","Confidence","BER_BCI","SACCI_BCI","RGDP_Growth")
colnames(conf_indices1) <- c("Date","Confidence_Current","Confidence_Expected","BER_BCI","SACCI_BCI","RGDP_Growth")

#conf_indices <- cbind(w.indicators_2,GDPdata$BER_BCI, GDPdata$SACCI_G,GDPgrowth4$RGDP)
#colnames(conf_indices) <- c("Date","Activity","Confidence","BER_BCI","SACCI_Growth","RGDP_Growth")

index_plot <- conf_indices1
index_plot[,2:6] <- scale(index_plot[,2:6])
g <- ggplot(index_plot) 
g <- g + geom_line(aes(x=Date, y=Confidence_Current, colour="Confidence_Current", linetype="Confidence_Current", size = "Confidence_Current"))
g <- g + geom_line(aes(x=Date, y=Confidence_Expected, colour="Confidence_Expected", linetype="Confidence_Expected", size = "Confidence_Expected"))
g <- g + geom_line(aes(x=Date, y=BER_BCI, colour="BER_BCI", linetype="BER_BCI", size = "BER_BCI"))
g <- g + geom_line(aes(x=Date, y=SACCI_BCI, colour="SACCI_BCI", linetype="SACCI_BCI", size = "SACCI_BCI"))
g <- g + geom_line(aes(x=Date, y=RGDP_Growth, colour="RGDP_Growth", linetype="RGDP_Growth", size = "RGDP_Growth"))
g <- g + scale_linetype_manual(values=c("twodash","solid","solid","dashed","longdash"))
g <- g + scale_size_manual(values=c(0.71,1.1,1.1,1.1,0.71))
g <- g + scale_colour_manual(values=c("#A3A500","#F8766D","#00BFC4","#E76BF3","#00BF7D"))
g <- g + labs(color="Legend text", linetype="Legend text", size="Legend text")
g <- g + geom_rect(data=recessions.df, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='grey', alpha=0.5)
g <- g + ylab("Standardised Indicator") + xlab("")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + theme(legend.title=element_blank()) 
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"), expand=c(0,0),limits = as.Date(c("1990-12-31", NA)))
g <- g + theme(legend.position="bottom")
g
```

The tracking record of the indicators is measured by their correlation with the corresponding quantitative reference series. Table 3.4 reports the contemporaneous correlations of the indicators and real GDP growth. Growth rates in the SACCI BCI are used to remove unit roots and are calculated as annual quarter-on-quarter growth rates. All the indicators exhibit a significant positive correlation with one another and with real GDP growth. The current conditions confidence indicator has a higher contemporaneous correlation with real GDP growth than the BER BCI or SACCI BCI, which are also based on current conditions. One would expect indicators of current conditions to have a better tracking record than indicators of expected conditions, although the correlation of the expected conditions confidence indicator is still relatively high.

```{r table3.4, echo=FALSE, results='asis', warning=FALSE, message=FALSE, cache = TRUE}
source("corstarsl.R")
xt <- xtable(corstarsl(conf_indices[,-1]), caption="Correlations between confidence indicators and real GDP growth")
print(xt, "latex",comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), scalebox = 0.8)
```

Cross-correlations can be used to illustrate the dynamic relationships between the indicators and real GDP growth. Figure 3.10 illustrates the cross-correlograms for the indicators and real GDP growth. All three survey-based measures exhibit relatively high correlations with lagged GDP growth. The highest correlation coefficient between the indicators of current conditions and real GDP growth occur contemporaneously. The confidence measure of expected conditions leads GDP growth, and exhibits the highest correlation coefficient when lagged by one period. The results imply that the indicators are all potentially useful leading or quasi-leading indicators of real activity.

```{r figure3.10, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Cross-correlograms of the confidence indicators and real GDP growth"}
Confidence_Current <- conf_indices[,2]
Confidence_Expected <- conf_indices[,3]
BER_BCI <- conf_indices[,4]
SACCI_Growth <- conf_indices[,5] 
SACCI_Growth <- na.locf(SACCI_Growth,fromLast = TRUE)
RGDP_Growth <- conf_indices[,6]

par(mfrow=c(2,2))
ccf(Confidence_Current, RGDP_Growth, na.action = na.pass, ylim=c(-0.3, 0.8), 
    ylab = "Correlation", xlab = "Number of Lags")
ccf(Confidence_Expected, RGDP_Growth, na.action = na.pass, ylim=c(-0.3, 0.8), 
    ylab = "Correlation", xlab = "Number of Lags")
ccf(BER_BCI, RGDP_Growth, na.action = na.pass, ylim=c(-0.3, 0.8), 
    ylab = "Correlation", xlab = "Number of Lags")
ccf(SACCI_Growth, RGDP_Growth, na.action = na.pass, ylim=c(-0.3, 0.8), 
    ylab = "Correlation", xlab = "Number of Lags")
```

Figure 3.11 compares the sectoral current and expected conditions confidence indicators with the BER sectoral indicators, as well as with the corresponding real sectoral GDP growth rates. The indicators capture cyclical movements in real output over the period. Table 3.5 reports the contemporaneous correlations of the sectoral indicators and their respective sectoral real GDP growth rates. All the indicators are highly positively correlated with real sectoral GDP growth rates. For the most part, the current conditions confidence indicators display the best tracking record, with the highest correlation with the reference series. In this sense, they are an improvement on existing confidence indicators. The exception is the construction sector, where the BER Building BCI has the highest correlation. This is interesting, as the BER Building BCI includes only building contractors. 

```{r figure3.11, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Sectoral confidence indicators compared to real sectoral GDP growth"}
manufac <- cbind(activity[,c(1,2)],conf[,2],(GDPdata$ManuConf-50)/50, GDPgrowth4$Manufacturing)
#manufac <- cbind(indicators.M[,c(2,14:15)],(GDPdata$ManuConf-50)/50, GDPgrowth4$Manufacturing)
#colnames(manufac) <- c("Date","Activity","Confidence","BER_BCI","RGDP")
colnames(manufac) <- c("Date","Confidence_Current","Confidence_Expected","BER_BCI","RGDP_Growth")

construct <- cbind(activity[,c(1,3)],conf[,3],(GDPdata$BuildingConf-50)/50, GDPgrowth4$Construction)
#construct <- cbind(indicators.B[,c(2,14:15)],(GDPdata$BuildingConf-50)/50, GDPgrowth4$Construction)
#colnames(construct) <- c("Date","Activity","Confidence","BER_BCI","RGDP_Growth")
colnames(construct) <- c("Date","Confidence_Current","Confidence_Expected","BER_BCI","RGDP_Growth")

GDPdata$TradeConf <- rowMeans(GDPdata[,c(14,15,17)])
trade <- cbind(activity[,c(1,4)],conf[,4],(GDPdata$TradeConf-50)/50, GDPgrowth4$Trade)
#trade <- cbind(indicators.T[,c(2,14:15)],(GDPdata$TradeConf-50)/50, GDPgrowth4$Trade)
#colnames(trade) <- c("Date","Activity","Confidence","BER_BCI","RGDP")
colnames(trade) <- c("Date","Confidence_Current","Confidence_Expected","BER_BCI","RGDP_Growth")

services <- cbind(activity[,c(1,5)],conf[,5], GDPgrowth4$Services)
#services <- cbind(indicators.S[,c(2,14:15)], GDPgrowth4$Services)
#colnames(services) <- c("Date","Activity","Confidence","RGDP")
colnames(services) <- c("Date","Confidence_Current","Confidence_Expected","RGDP_Growth")
services$BER_BCI <- 1
services <- services[,c(1,2,3,5,4)]

index_plot <- manufac
index_plot[,-1] <- scale(index_plot[,-1])
index_plot <- melt(index_plot, id="Date")  # convert to long format
g1 <- ggplot(index_plot, aes(x=Date,y=value,group=variable,colour=variable)) 
g1 <- g1 + geom_line()
g1 <- g1 + theme(legend.title=element_blank())
g1 <- g1 + ggtitle("Manufacturing") 
g1 <- g1 + ylab("Indicator") + xlab("")
g1 <- g1 + theme(legend.position="none")
g1 <- g1 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g1 <- g1 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- construct
index_plot[,-1] <- scale(index_plot[,-1])
index_plot <- melt(index_plot, id="Date")  # convert to long format
g2 <- ggplot(index_plot, aes(x=Date,y=value,group=variable,colour=variable)) 
g2 <- g2 + geom_line()
g2 <- g2 + theme(legend.title=element_blank())
g2 <- g2 + ggtitle("Construction") 
g2 <- g2 + ylab("") + xlab("")
g2 <- g2 + theme(legend.position="none")
g2 <- g2 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g2 <- g2 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- trade
index_plot[,-1] <- scale(index_plot[,-1])
index_plot <- melt(index_plot, id="Date")  # convert to long format
g3 <- ggplot(index_plot, aes(x=Date,y=value,group=variable,colour=variable)) 
g3 <- g3 + geom_line()
g3 <- g3 + theme(legend.title=element_blank())
g3 <- g3 + ggtitle("Trade") 
g3 <- g3 + ylab("Indicator") + xlab("")
g3 <- g3 + theme(legend.position="bottom")
g3 <- g3 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g3 <- g3 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- services
index_plot[,-1] <- scale(index_plot[,-1])
index_plot <- melt(index_plot, id="Date")  # convert to long format
g4 <- ggplot(index_plot, aes(x=Date,y=value,group=variable,colour=variable)) 
g4 <- g4 + geom_line()
g4 <- g4 + theme(legend.title=element_blank())
g4 <- g4 + ggtitle("Services") 
g4 <- g4 + ylab("") + xlab("")
g4 <- g4 + theme(legend.position="bottom")
g4 <- g4 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g4 <- g4 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

library(gridExtra)

grid_arrange_shared_legend <- function(...) {
    plots <- list(...)
    g <- ggplotGrob(plots[[1]] + theme(legend.position="bottom"))$grobs
    legend <- g[[which(sapply(g, function(x) x$name) == "guide-box")]]
    lheight <- sum(legend$height)
    grid.arrange(
        do.call(arrangeGrob, lapply(plots, function(x)
            x + theme(legend.position="none"))),
        legend,
        ncol = 1,
        heights = unit.c(unit(1, "npc") - lheight, lheight))
}

#grid_arrange_shared_legend(p1, p2, p3, p4)
grid_arrange_shared_legend(g1, g2, g3, g4, ncol=2, nrow =2)
```


```{r table3.5, echo=FALSE, results='asis', warning=FALSE, message=FALSE, cache = TRUE}
source("corstarsl.R")
xt1 <- cbind(corstarsl(manufac[,-1]),corstarsl(construct[,-1]))
xt2 <- cbind(corstarsl(trade[,-1]),corstarsl(services[,-1]))
xt1 <- sapply(xt1,as.character)
xt2 <- sapply(xt2,as.character)
xt2[3,4:5] <- ""
xt2[4,6] <- ""
xt1[1,] <- c("Current","Expected","BER_BCI","Current","Expected","BER_BCI")
xt2[1,] <- c("Current","Expected","BER_BCI","Current","Expected","BER_BCI")
colnames(xt1) <- c(" ","Manufacturing"," "," ","Construction"," ")
colnames(xt2) <- c(" ","Trade"," "," ","Services"," ")
row.names(xt1) <- c(" ","Expected","BER_BCI","RGDP_Growth")
row.names(xt2) <- c(" ","Expected","BER_BCI","RGDP_Growth")

xt <- xtable(xt1, caption="Correlations between sectoral confidence and real sectoral GDP growth")
print(xt, "latex",comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), scalebox = 0.8)
xt <- xtable(xt2)
print(xt, "latex",comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), scalebox = 0.85,floating=F)
```

Figure 3.12 illustrates the cross-correlograms for the manufacturing indicators and real GDP growth in the manufacturing sector. The results are similar to the aggregate results. Again, all three survey-based measures exhibit relatively high correlations with lagged GDP growth, and the expected conditions confidence measure leads the other indicators and real GDP growth. The cross-correlograms for the other sectors are very similar, except for the services sector, where the expected conditions confidence measure has an even longer leading relationship with real GDP growth. 

```{r figure3.12, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Cross-correlograms of the indicators and real GDP growth in the manufacturing sector"}
calc_ccf <- function(data, serv=0) {
    Confidence_Current <- data[,2]
    Confidence_Expected <- data[,3]
    BER_BCI <- data[,4]
    RGDP_Growth <- data[,5]
    
    par(mfrow=c(2,2))
    ccf(Confidence_Current, RGDP_Growth, na.action = na.omit, ylim=c(-0.3, 0.8), 
    ylab = "Correlation", xlab = "Number of Lags")
    ccf(Confidence_Expected, RGDP_Growth, na.action = na.omit, ylim=c(-0.3, 0.8), 
    ylab = "Correlation", xlab = "Number of Lags")
    if(serv==0) { ccf(BER_BCI, RGDP_Growth, na.action = na.pass, ylim=c(-0.3, 0.8), 
    ylab = "Correlation", xlab = "Number of Lags") }
}

calc_ccf(manufac)
```

####Turning points
An accurate leading indicator should show general conformity to economic activity (i.e. a high correlation), as well as a consistent matching of turning points with the reference cycle. Although there are too few cycles over the sample period to analyse cyclical turning points in full detail, it is still of interest to assess whether the indicators behave in a systematic way around cyclical turning points. In other words, do they systematically lead, coincide with, or lag the peaks and troughs of the business cycle. 

The turning points in the indicators are determined with the so-called Bry-Boschan method. This is a non-parametric dating algorithm that automates the Burns & Mitchell approach to determining classical turning points [@Bry1971]. The algorithm identifies local minima (troughs) and maxima (peaks) in a single time series. Censoring rules in the algorithm ensure that phases and cycles have a minimum duration. The algorithm has the advantage that it is a simple, transparent, easily replicable, and provides intuitively appealing results [@DuPlessis2006]. A variant of this algorithm for dealing with quarterly data, called the BBQ method, was developed by @Harding2002. Following their suggestion, a censoring rule based on a minimum of two quarters for each phase and five quarters for a full cycle is applied. 

The resulting phases are illustrated in Figure 3.13, with the recessionary periods shaded. The top panel of each graph illustrates the turning points of the confidence indices, while the bottom panel of each graph shows the official SARB reference turning points. The sample period includes three upswing phases and four downswing phases. In addition, in 2001 and 2003 the SARB indicators pointed to possible reference turning points. Although the SARB dating committee decided at the time that neither of these periods qualified, subsequent data revisions have shown that in hindsight there could have been official peaks, especially in 2003, if the dating procedure had been followed mechanically [@Venter2005a]. 

```{r turn, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
#Turning Points
suppressMessages(library(BCDating))
turning.df = read.table(textConnection(
    "Peaks,  Troughs 
    ,  1993Q2 
    1996Q4, 1999Q3 
    2007Q4, 2009Q3 
    2013Q4, "), 
    sep=',', header=TRUE)

dat <- BBQ(ts(conf_indices[,2],start =c(1992,1),end=c(2015,3),frequency=4), mincycle = 5, minphase = 2, name="Activity")
tp1 <- as.data.frame(show(dat))[,-3]
dat <- BBQ(ts(conf_indices[,3],start =c(1992,1),end=c(2015,3),frequency=4), mincycle = 5, minphase = 2, name="Activity")
tp2 <- as.data.frame(show(dat))[,-3]
dat <- BBQ(ts(conf_indices[,4],start =c(1992,1),end=c(2015,3),frequency=4), mincycle = 5, minphase = 2, name="Activity")
tp3 <- as.data.frame(show(dat))[,-3]
#dat <- BBQ(ts(conf_indices[,5],start =c(1992,1),end=c(2015,3),frequency=4), mincycle = 4, minphase = 2, name="Activity")
#tp4 <- as.data.frame(show(dat))[,-3]
dat <- BBQ(ts(GDPdata$SACCI_BCI,start =c(1992,1),end=c(2015,3),frequency=4), mincycle = 5, minphase = 2, name="Activity")
tp4 <- as.data.frame(show(dat))[,-3]
dat <- BBQ(ts(conf_indices[,6],start =c(1992,1),end=c(2015,3),frequency=4), mincycle = 5, minphase = 2, name="Activity")
tp5 <- as.data.frame(show(dat))[,-3]

detach("package:BCDating", unload=TRUE)

maak_datums <- function(data) {
    data$Peak <- as.Date(as.yearqtr(data[,1], format = "%YQ%q"), frac = 1)
    data$Trough <- as.Date(as.yearqtr(data[,2], format = "%YQ%q"), frac = 1)
    data$Peak[1] <- "1990-12-31"
    data$Trough[nrow(data)] <- "2016-12-31"
    return(data)
}

tp1 <- maak_datums(tp1)
tp2 <- maak_datums(tp2)
tp3 <- maak_datums(tp3)
tp4 <- maak_datums(tp4)
tp5 <- maak_datums(tp5)
```

```{r figure3.13, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Confidence indicator turning points compared to the official SARB turning points"}
index_plot <- conf_indices[,c(1,2)]
index_plot[,2] <- scale(index_plot[,2])
colnames(index_plot) <- c("Date","Confidence")
g1 <- ggplot(index_plot) 
g1 <- g1 + geom_line(aes(x=Date, y=Confidence, colour="Confidence"), size = 0.5)
g1 <- g1 + labs(color="Legend text")
g1 <- g1 + geom_rect(data=recessions.df, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=0), fill='grey', alpha=0.5)
g1 <- g1 + geom_rect(data=tp1, aes(xmin=Peak, xmax=Trough, ymin=0, ymax=+Inf), fill='blue', alpha=0.5)
g1 <- g1 + ylab("Indicator") + xlab("")
g1 <- g1 + ggtitle("Confidence_Current") 
g1 <- g1 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g1 <- g1 + theme(legend.title=element_blank()) 
g1 <- g1 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"), expand=c(0,0),
                        limits = as.Date(c("1990-12-31", NA)))
g1 <- g1 + theme(legend.position="none")

index_plot <- conf_indices[,c(1,3)]
index_plot[,2] <- scale(index_plot[,2])
colnames(index_plot) <- c("Date","Confidence")
g2 <- ggplot(index_plot) 
g2 <- g2 + geom_line(aes(x=Date, y=Confidence, colour="Confidence"), size = 0.5)
g2 <- g2 + labs(color="Legend text")
g2 <- g2 + geom_rect(data=recessions.df, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=0), fill='grey', alpha=0.5)
g2 <- g2 + geom_rect(data=tp2, aes(xmin=Peak, xmax=Trough, ymin=0, ymax=+Inf), fill='blue', alpha=0.5)
g2 <- g2 + ylab("") + xlab("")
g2 <- g2 + ggtitle("Confidence_Expected") 
g2 <- g2 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g2 <- g2 + theme(legend.title=element_blank()) 
g2 <- g2 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"), expand=c(0,0),
                        limits = as.Date(c("1990-12-31", NA)))
g2 <- g2 + theme(legend.position="none")

index_plot <- conf_indices[,c(1,4)]
index_plot[,2] <- scale(index_plot[,2])
colnames(index_plot) <- c("Date","Confidence")
g3 <- ggplot(index_plot) 
g3 <- g3 + geom_line(aes(x=Date, y=Confidence, colour="Confidence"), size = 0.5)
g3 <- g3 + labs(color="Legend text")
g3 <- g3 + geom_rect(data=recessions.df, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=0), fill='grey', alpha=0.5)
g3 <- g3 + geom_rect(data=tp3, aes(xmin=Peak, xmax=Trough, ymin=0, ymax=+Inf), fill='blue', alpha=0.5)
g3 <- g3 + ylab("Indicator") + xlab("")
g3 <- g3 + ggtitle("BER BCI") 
g3 <- g3 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g3 <- g3 + theme(legend.title=element_blank()) 
g3 <- g3 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"), expand=c(0,0),
                        limits = as.Date(c("1990-12-31", NA)))
g3 <- g3 + theme(legend.position="none")

index_plot <- GDPdata[,c("Date","SACCI_BCI")]
#index_plot <- conf_indices[,c(1,5)]
index_plot[,2] <- scale(index_plot[,2])
colnames(index_plot) <- c("Date","Confidence")
g4 <- ggplot(index_plot) 
g4 <- g4 + geom_line(aes(x=Date, y=Confidence, colour="Confidence"), size = 0.5)
g4 <- g4 + labs(color="Legend text")
g4 <- g4 + geom_rect(data=recessions.df, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=0), fill='grey', alpha=0.5)
g4 <- g4 + geom_rect(data=tp4, aes(xmin=Peak, xmax=Trough, ymin=0, ymax=+Inf), fill='blue', alpha=0.5)
g4 <- g4 + ylab("") + xlab("")
g4 <- g4 + ggtitle("SACCI BCI") 
g4 <- g4 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g4 <- g4 + theme(legend.title=element_blank()) 
g4 <- g4 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"), expand=c(0,0),
                        limits = as.Date(c("1990-12-31", NA)))
g4 <- g4 + theme(legend.position="none")

library(gridExtra)
grid.arrange(g1, g2, g3, g4, ncol=2, nrow =2)
```

The BBQ algorithm identifies eight recessionary periods in the current conditions confidence indicator and seven in the expected conditions confidence indicator. Four of these correspond to the official downswing phases. The turning points in the BER and SACCI BCI are similar to those for the current and expected conditions confidence indicators. As the indicators are quite volatile, the default censoring rule produces a few recessions (or false positives) during the ambiguous period (2001 and 2003), and the previous upswing phase (2012). 

The indicators exhibit troughs before the three official trough dates, between one and four quarters before they occurred. The indicators exhibit peaks long before the official peak dates, in some cases as much as 12 quarters before they occurred. Therefore, the indicators provided advanced warning of turning points, albeit long before the official peaks. The false positives are problematic for the use of the indicators as early warning signals, implying that the indicators should be used in conjunction with other series, as in @Laubscher2014. Still, the reference series, real GDP growth, exhibits even more phases when dated with the BBQ method. Its cycles corresponded more closely with those of the indicators. 

The comovement between these cycle phases can be measured with the concordance statistic suggested by @Harding2002. The concordance statistic measures the comovement of two series, by considering the proportion of time the two series are simultaneously in the same phase. This entails testing whether $I=Pr(S_{xt} =S_{yt})$ is close to 1, where $S_{xt} = 1$ identifies an expansion in indicator $x_t$, and $S_{yt}=1$ identifies a business cycle upswing phase at time $t$. The statistic is calculated as follows: $I = 1/T [\sum^T_{t=1} S_{xt} S_{yt} + \sum^T_{t=1} (1-S_{xt}) (1- S_{yt})$. Following @Harding2006, statistical significance is calculated with heteroskedasticity and autocorrelation consistent standard errors.

Table 3.6 reports the concordance statistics for the phases of the indicator variables, compared with the official SARB reference turning points. The indicators all exhibit significant concordance with the official SARB business cycle. The current conditions indicator has the highest concordance statistic with the official SARB cycle out of all the indicators, which occurs when it is lagged by one quarter, i.e. it leads the official cycle by one quarter. In this sense, it is an improvement on the existing indicators. The other three measures have the highest concordance statistics when they are lagged by two quarters, i.e. when they lead the official SARB cycle by two quarters. 

```{r concordance, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
#Concordance
S <- conf_indices
d <- NULL
for(i in 1:nrow(tp1)) {
    d <- c(d,seq(tp1[i,3], tp1[i,4], by="day")[-1]) 
}
S[,2] <- 1
S[S$Date %in% d,2] <- 0

d <- NULL
for(i in 1:nrow(tp2)) {
    d <- c(d,seq(tp2[i,3], tp2[i,4], by="day")[-1]) 
}
S[,3] <- 1
S[S$Date %in% d,3] <- 0

d <- NULL
for(i in 1:nrow(tp3)) {
    d <- c(d,seq(tp3[i,3], tp3[i,4], by="day")[-1]) 
}
S[,4] <- 1
S[S$Date %in% d,4] <- 0

d <- NULL
for(i in 1:nrow(tp4)) {
    d <- c(d,seq(tp4[i,3], tp4[i,4], by="day")[-1]) 
}
S[,5] <- 1
S[S$Date %in% d,5] <- 0

d <- NULL
for(i in 1:nrow(tp5)) {
    d <- c(d,seq(tp5[i,3], tp5[i,4], by="day")[-1]) 
}
S[,6] <- 1
S[S$Date %in% d,6] <- 0


d <- NULL
for(i in 1:nrow(recessions.df)) {
    d <- c(d,seq(recessions.df[i,1], recessions.df[i,2], by="day")[-1]) 
}
S$SARB <- 1
S[S$Date %in% d,7] <- 0

#S[1:60,2:7] <- NA
#S[1:127,6] <- NA

Concord_1<-NULL
Concord_2<-NULL
p_1<-NULL
p_2<-NULL

for(k in 0:3) {
    Concord1<-NULL
    Concord2<-NULL
    p.1<-NULL
    p.2<-NULL
    
    for(i in 2:5) {
        Concord1[i-1] <- (sum(S[1:(95-k),i]*S[(1+k):95,7], na.rm = TRUE)+sum((1-S[1:(95-k),i])*(1-S[(1+k):95,7]),na.rm = TRUE))/sum(!is.na(S[,i]))
        Concord2[i-1] <- (sum(S[1:(95-k),i]*S[(1+k):95,6], na.rm = TRUE)+sum((1-S[1:(95-k),i])*(1-S[(1+k):95,6]),na.rm = TRUE))/sum(!is.na(S[,i]))
        
        s_x <- S[1:(95-k),i]/sqrt(var(S[1:(95-k),i], na.rm = TRUE))/sqrt(var(S[(1+k):95,7], na.rm = TRUE))
        s_y1 <- S[(1+k):95,7]/sqrt(var(S[(1+k):95,7], na.rm = TRUE))/sqrt(var(S[1:(95-k),i], na.rm = TRUE))
        s_y2 <- S[(1+k):95,6]/sqrt(var(S[(1+k):95,6], na.rm = TRUE))/sqrt(var(S[1:(95-k),i], na.rm = TRUE))
        
        m <- lm(s_x ~ s_y1, na.action=na.exclude)
        p1 <- coeftest(m,vcov. = NeweyWest)[2,4]
        m <- lm(s_x ~ s_y1, na.action=na.exclude)
        p2 <- coeftest(m,vcov. = NeweyWest)[2,4]
        
        p.1 <- rbind(p.1,p1)
        p.2 <- rbind(p.2,p2)
    }
    Concord_1 <- cbind(Concord_1,Concord1)
    Concord_2 <- cbind(Concord_2,Concord2)
    
    p_1 <- cbind(p_1,p.1)
    p_2 <- cbind(p_2,p.2)
}

#Concord2[i-2] <- (sum(S[,i]*S[,2])+sum((1-S[,i])*(1-S[,2])))/nrow(S)    

Concord_1 <- t(round(Concord_1, digits = 4))
Concord_2 <- t(round(Concord_2, digits = 4))

p_1 <- t(round(p_1, digits = 6))
p_2 <- t(round(p_2, digits = 6))

mystars <- ifelse(p_1 < .01, "***", ifelse(p_1 < .05, "** ", ifelse(p_1 < .1, "* ", " ")))
Concord_1 <- matrix(paste(Concord_1, mystars, sep=""), ncol=4)
Concord_1 <- rbind(c("Confidence_Current","Confidence_Expected","BER_BCI","SACCI_BCI"),Concord_1)
row.names(Concord_1) <- c(" ","lag=0","lag=1","lag=2","lag=3")

mystars <- ifelse(p_2 < .01, "***", ifelse(p_2 < .05, "** ", ifelse(p_2 < .1, "* ", " ")))
Concord_2 <- matrix(paste(Concord_2, mystars, sep=""), ncol=4)
Concord_2 <- rbind(c("Confidence_Current","Confidence_Expected","BER_BCI","SACCI_BCI"),Concord_2)
row.names(Concord_2) <- c(" ","lag=0","lag=1","lag=2","lag=3")

#Concord_1 <- cbind(Concord_1,Concord_2)
```

```{r table3.6, echo=FALSE, results='asis', warning=FALSE, message=FALSE, cache = TRUE}
xt <- xtable(Concord_1, caption="Concordance statistics with the SARB business cycle")

print(xt, "latex",comment=FALSE, include.rownames=TRUE, include.colnames=F,
      caption.placement = getOption("xtable.caption.placement", "top"), scalebox = 0.9)
```

This section has presented the new composite confidence indicators. The validity tests indicate that the two composite confidence indicators on current and expected conditions are highly correlated with each other and with the two existing measures of confidence. All the indicators examined in this section exhibit a significant positive correlation with real GDP growth. The confidence indicators on current conditions generally have the highest correlation with real GDP growth and therefore the most successful tracking record. 

The indicators provide advanced warning of turning points, although there are a few false signals, especially over the ambiguous period of 2001-2003. The indicators also exhibit significant concordance with the phases of the business cycle, with a lead of one or two quarters. This implies that they are potentially useful leading indicators. The false positives imply that the indicators should be used in conjunction with other series when identifying turning points, as in @Laubscher2014.

As more microeconomic data from the BER's business tendency surveys become available, the analysis could be expanded by analysing the cyclical properties of the indicators in terms of duration, amplitude and steepness. The composite confidence indicator on current conditions is an improvement on existing confidence indicators in that it has a higher correlation with GDP growth and a higher concordance statistic with the official SARB business cycle. 

##Results: Uncertainty
This section presents the composite sectoral and aggregate indicators of uncertainty for South Africa. Simple linear interpolation is used for the few missing quarters and all the indicators are standardised. The validity of the survey-based indicators is assessed by comparing them with the existing measures of uncertainty for South Africa. The indicators are then evaluated in terms of their comovement with real GDP growth, to assess whether they improve on the existing indicators of uncertainty. An overall uncertainty indicator is then created, which tries to combine the information in all of the indicators.

###Uncertainty Indicators
```{r dispersion, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
se <- function(x) sqrt(var(x,na.rm=TRUE)/length(na.omit(x))*(length(na.omit(x))-1)) #adjust for (n-1)
##------------##
## Dispersion                    
##------------##
calc_wuncert <- function(data) {
    ##Weighted versions
    weeg.2 <- function(temp) {  #calculate weighted standard deviation for each quarter for all columns
        temp <- cbind(factor=temp$factorn,temp$factorn*temp[(match("surveyQ",colnames(temp))+1):ncol(temp)])
        #calculate total that responded up (1) and down (-1) over sum(wi) = fractions up and down
        frac.up <- sapply(1:ncol(temp), function(x) sum(temp[which(temp[,x]>0),x],na.rm=TRUE))/
            sapply(colnames(temp), function(x) sum(temp$factor[!is.na(temp[colnames(temp) == x])]))
        frac.dn <- sapply(1:ncol(temp), function(x) sum(temp[which(temp[,x]<0),x],na.rm=TRUE))/
            sapply(colnames(temp), function(x) sum(temp$factor[!is.na(temp[colnames(temp) == x])]))
        #weight only by those that responded to a specific question 
        ind <- sqrt(frac.up-frac.dn-(frac.up+frac.dn)^2)        #this is the standard devation
        return(ind)
    }
    
    w.uncertainty <- as.data.frame(t(sapply(levels(data$surveyQ), function(kwartaal) weeg.2(data[data$surveyQ==kwartaal,]))))
    w.uncertainty$Uncert_cc <- rowMeans(w.uncertainty[,c("Q2A","Q3A","Q4A","Q5A","Q6A")],na.rm = TRUE, dims = 1)
    w.uncertainty$Uncert_fl <- rowMeans(w.uncertainty[,c("Q2P","Q3P","Q4P","Q5P","Q6P")],na.rm = TRUE, dims = 1)
    w.uncertainty <- merge(datums,w.uncertainty,by.x="Date",by.y="row.names", all=TRUE)[,-3]
    w.uncertainty[,14:15] <- na.approx(w.uncertainty[,14:15],na.rm = FALSE)
    for(t in 2:nrow(w.uncertainty)) { w.uncertainty$Disp[t-1] <- w.uncertainty$Uncert_fl[t-1]/w.uncertainty$Uncert_cc[t] }
    w.uncertainty$Disp[t] <- NA
    return(w.uncertainty)
}

w.uncertainty.M <- calc_wuncert(BER[BER$Sector=="Manufacturing",])
w.uncertainty.B <- calc_wuncert(BER[BER$Sector=="Construction",])
w.uncertainty.T <- calc_wuncert(BER[BER$Sector=="Trade",])
w.uncertainty.S <- calc_wuncert(BER[BER$Sector=="Services",])

##Weighted versions
weights <- GDPdata[,c(1:4,6)]
w.uncertainty <- cbind(w.uncertainty.M[,c(2,16)],w.uncertainty.B[,16],w.uncertainty.T[,16],w.uncertainty.S[,16])
colnames(w.uncertainty) <- c("Date","Manufacturing","Construction","Trade","Services")
w.uncertainty[,-1] <- scale(w.uncertainty[,-1])

w.uncertainty$Dispersion <- sapply(w.uncertainty$Date,function(x) weighted.mean(w.uncertainty[which(w.uncertainty$Date==x),c(2:5)], 
                                                                                 weights[weights$Date==x,-1],na.rm=TRUE))

w.uncertainty <- seisoen(w.uncertainty)
w.uncertainty[1,3] <- NA
w.uncertainty[1:5,4] <- NA
w.uncertainty[1:53,5] <- NA
```

```{r experrors1, eval=FALSE, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
calc_errors <- function(data) {
    #remove duplicates
    dups <- data[duplicated(data[,c("id","surveyQ")]) | duplicated(data[,c("id","surveyQ")], fromLast = TRUE),]
    data <- data[!duplicated(data[,c("id","surveyQ")]),]
    
    #Compare the expectations of firms in Q7P (forward-looking) in period t to the realisations in Q7A in period t+1.
    #see example survey questions
    exp.error <- function(temp) { #calculate errors for each respondent
        #merge to create easier format
        error <- merge(datums,temp,by.x="Date",by.y="surveyQ", all.x=TRUE)
        for(t in 1:nrow(error)) {
            error$eQ2[t]  <- error$Q2A[(t+1)] - error$Q2P[t]
            error$eQ3[t]  <- error$Q3A[(t+1)] - error$Q3P[t]
            error$eQ4[t]  <- error$Q4A[(t+1)] - error$Q4P[t]
            error$eQ5[t]  <- error$Q5A[(t+1)] - error$Q5P[t]
            error$eQ6[t]  <- error$Q6A[(t+1)] - error$Q6P[t]
        }
        error <- error[,c(2,8,20:24)]
        error <- error[rowSums(is.na(error[,3:7]))!=5, ]
        return(error)
    }
    
    errors <- data.frame()
    for(i in unique(data$id)){
        errors <- rbind(errors, exp.error(data[which(data$id==i),])) 
    }
    #errors <- rbind(errors,sapply(head(levels(data$id),1), function(i) exp.error(data[which(data$id==i),]) ) )
    return(errors)
}

#Save for speed
m_errors <- calc_errors(BER[BER$Sector=="Manufacturing",])
write.csv2(m_errors,"Manufacturing_errors3.csv")

b_errors <- calc_errors(BER[BER$Sector=="Construction",])
write.csv2(b_errors,"Building_errors3.csv")

t_errors <- calc_errors(BER[BER$Sector=="Trade",])
write.csv2(t_errors,"Trade_errors3.csv")

s_errors <- calc_errors(BER[BER$Sector=="Services",])
write.csv2(s_errors,"Services_errors3.csv")
```

```{r experrors2, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
#Read for speed
m_errors <- read.csv2("Manufacturing_errors3.csv", header=TRUE)[,-1]
m_errors$Datum <- as.Date(m_errors$Datum)
b_errors <- read.csv2("Building_errors3.csv", header=TRUE)[,-1]
b_errors$Datum <- as.Date(b_errors$Datum)
t_errors <- read.csv2("Trade_errors3.csv", header=TRUE)[,-1]
t_errors$Datum <- as.Date(t_errors$Datum)
s_errors <- read.csv2("Services_errors3.csv", header=TRUE)[,-1]
s_errors$Datum <- as.Date(s_errors$Datum)

calc_wuncert.ee <- function(data) {
    ##Weighted versions
    weeg.3 <- function(data) {  #calculate weighted standard deviation for each quarter for all columns
        temp <- cbind(factor=data$factorn,data$factorn*data[,3:ncol(data)])
        xbar <- colSums(temp, na.rm=TRUE, dims = 1)/
            sapply(colnames(temp), function(x) sum(temp$factor[!is.na(temp[colnames(temp) == x])]))
        temp <- data[,-1]
        #this is the weighted standard devation: sum[wi*(xi-xbar)^2]/sum(wi) 
        idio <- sqrt(sapply(colnames(temp), function(x) sum((temp[,x]-xbar[x])*(temp[,x]-xbar[x])*temp$factor,na.rm=TRUE))/
                         sapply(colnames(temp), function(x) sum(temp$factor[!is.na(temp[colnames(temp) == x])],na.rm=TRUE))) 
        aggr <- sapply(colnames(temp), function(x) xbar[x]*xbar[x]) 
        ind <- cbind(idio,aggr)
        return(ind)
    }
    w.errors <- as.data.frame(t(sapply(datums$Datum, function(kwartaal) weeg.3(data[data$Datum==kwartaal,]))))
    w.errors <- cbind(datums$Datum,w.errors)
    colnames(w.errors) <- c("Date","Idio.factor","Idio.Q2","Idio.Q3","Idio.Q4","Idio.Q5","Idio.Q6",
                            "Aggr.factor","Aggr.Q2","Aggr.Q3","Aggr.Q4","Aggr.Q5","Aggr.Q6")
    w.errors[w.errors==0] <- NA
    w.errors[,-1] <- scale(w.errors[,-1])
    w.errors$Idio <- rowMeans(w.errors[,3:7],na.rm = TRUE, dims = 1)
    w.errors$Aggr <- rowMeans(w.errors[,9:13],na.rm = TRUE, dims = 1)
    w.errors[,14:15] <- na.approx(w.errors[,14:15],na.rm=FALSE)
    w.errors <- w.errors[,c(1,14:15)]
    #w.errors[,2] <- c(NA,w.errors[-99,2])
    #w.errors[,3] <- c(NA,w.errors[-99,3])
    return(w.errors)
}

w.uncert_error.M <- calc_wuncert.ee(m_errors)
w.uncert_error.B <- calc_wuncert.ee(b_errors)
w.uncert_error.T <- calc_wuncert.ee(t_errors)
w.uncert_error.S <- calc_wuncert.ee(s_errors)

##Weighted versions
weights <- GDPdata[,c(1:4,6)]
idio.errors <- cbind(w.uncert_error.M[,c(1,2)],w.uncert_error.B[,2],w.uncert_error.T[,2],w.uncert_error.S[,2])
colnames(idio.errors) <- c("Date","Manufacturing","Construction","Trade","Services")

aggr.errors <- cbind(w.uncert_error.M[,c(1,3)],w.uncert_error.B[,3],w.uncert_error.T[,3],w.uncert_error.S[,3])
colnames(aggr.errors) <- c("Date","Manufacturing","Construction","Trade","Services")

#create weighted means by GDP share
idio.errors$Idio.errors <- sapply(idio.errors$Date, function(x) weighted.mean(idio.errors[which(idio.errors$Date==x),c(2:5)], 
                                                                              weights[weights$Date==x,-1],na.rm=TRUE))
aggr.errors$Aggr.errors <- sapply(aggr.errors$Date, function(x) weighted.mean(aggr.errors[which(aggr.errors$Date==x),c(2:5)], 
                                                                              weights[weights$Date==x,-1],na.rm=TRUE))

aggr.errors <- seisoen(aggr.errors)
idio.errors <- seisoen(idio.errors)
aggr.errors[1:5,3] <- NA
aggr.errors[1,4] <- NA
aggr.errors[1:53,5] <- NA
idio.errors[1:5,3] <- NA
idio.errors[1,4] <- NA
idio.errors[1:53,5] <- NA

w.uncert_error <- cbind(w.uncertainty[,c(1,6)],idio.errors[,6],aggr.errors[,6])
colnames(w.uncert_error) <- c("Date","Dispersion","Idiosyncratic_error","Aggregate_error")
```

Figure 3.14 illustrates the weighted sectoral indicators of uncertainty based on dispersion. These indicators are quite volatile by construction [@Girardi2015]. The indicators of dispersion for the manufacturing, construction and trade sectors spike during the 1997-1998 recession, associated with the East Asian and Russian crises. In those three sectors the indicators also increased in the recessionary period following the global financial crisis. The dispersion indicator for the manufacturing sector also exhibits a spike at the beginning of the period during the Democratic transition. The dispersion indicator for the services sector is particularly volatile and does not exhibit the large increase during the Great Recession which is present in the indicators for the other sectors.

```{r figure3.14, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Weighted sectoral indicators of dispersion"}
index_plot <- cbind(w.uncertainty[,c(1,2)])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Dispersion")
g1 <- ggplot(index_plot, aes(x=Date,y=Dispersion,group=1))
g1 <- g1 + geom_line(colour="#7CAE00")
g1 <- g1 + theme(legend.title=element_blank())
g1 <- g1 + ggtitle("Manufacturing") 
g1 <- g1 + ylab("Indicator") + xlab("")
g1 <- g1 + theme(legend.position="none")
g1 <- g1 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g1 <- g1 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- w.uncertainty[,c(1,3)]
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Dispersion")
g2 <- ggplot(index_plot, aes(x=Date,y=Dispersion,group=1))
g2 <- g2 + geom_line(colour="#7CAE00")
g2 <- g2 + theme(legend.title=element_blank())
g2 <- g2 + ggtitle("Construction") 
g2 <- g2 + ylab("") + xlab("")
g2 <- g2 + theme(legend.position="none")
g2 <- g2 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g2 <- g2 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(w.uncertainty[,c(1,4)])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Dispersion")
g3 <- ggplot(index_plot, aes(x=Date,y=Dispersion,group=1))
g3 <- g3 + geom_line(colour="#7CAE00")
g3 <- g3 + theme(legend.title=element_blank())
g3 <- g3 + ggtitle("Trade") 
g3 <- g3 + ylab("Indicator") + xlab("")
g3 <- g3 + theme(legend.position="none")#,plot.margin=unit(c(-0.5,0.4,0,0.4), "cm"))
g3 <- g3 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g3 <- g3 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(w.uncertainty[,c(1,5)])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Dispersion")
g4 <- ggplot(index_plot, aes(x=Date,y=Dispersion,group=1))
g4 <- g4 + geom_line(colour="#7CAE00")
g4 <- g4 + theme(legend.title=element_blank())
g4 <- g4 + ggtitle("Services") 
g4 <- g4 + ylab("") + xlab("")
g4 <- g4 + theme(legend.position="none")#,plot.margin=unit(c(-0.5,0.4,0,0.4), "cm"))
g4 <- g4 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g4 <- g4 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

library(gridExtra)
grid.arrange(g1, g2, g3, g4, ncol=2, nrow =2)
```

Figure 3.15 illustrates the weighted sectoral indicators of aggregate error uncertainty. The indicators in the manufacturing, construction and trade sectors spike at similar times as the corresponding indicators of dispersion. There are spikes during the Democratic transition, the 1997-1998 recession, the two semi-recessions (in 2001 and 2003), and the Great Recession. In addition, all four indicators exhibit spikes during the European Debt crisis in 2011, and again in 2014, at the start of the downswing phase at the end of the sample period. 

```{r figure3.15, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Weighted sectoral indicators of aggregate error uncertainty"}
index_plot <- cbind(aggr.errors[,c(1,2)])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Aggregate")
g1 <- ggplot(index_plot, aes(x=Date,y=Aggregate,group=1))
g1 <- g1 + geom_line(colour="#F8766D")
g1 <- g1 + theme(legend.title=element_blank())
g1 <- g1 + ggtitle("Manufacturing") 
g1 <- g1 + ylab("Indicator") + xlab("")
g1 <- g1 + theme(legend.position="none")
g1 <- g1 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g1 <- g1 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(aggr.errors[,c(1,3)])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Aggregate")
g2 <- ggplot(index_plot, aes(x=Date,y=Aggregate,group=1))
g2 <- g2 + geom_line(colour="#F8766D")
g2 <- g2 + theme(legend.title=element_blank())
g2 <- g2 + ggtitle("Construction") 
g2 <- g2 + ylab("") + xlab("")
g2 <- g2 + theme(legend.position="none")
g2 <- g2 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g2 <- g2 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(aggr.errors[,c(1,4)])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Aggregate")
g3 <- ggplot(index_plot, aes(x=Date,y=Aggregate,group=1))
g3 <- g3 + geom_line(colour="#F8766D")
g3 <- g3 + theme(legend.title=element_blank())
g3 <- g3 + ggtitle("Trade") 
g3 <- g3 + ylab("Indicator") + xlab("")
g3 <- g3 + theme(legend.position="none")#,plot.margin=unit(c(-0.5,0.4,0,0.4), "cm"))
g3 <- g3 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g3 <- g3 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(aggr.errors[,c(1,5)])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Aggregate")
g4 <- ggplot(index_plot, aes(x=Date,y=Aggregate,group=1))
g4 <- g4 + geom_line(colour="#F8766D")
g4 <- g4 + theme(legend.title=element_blank())
g4 <- g4 + ggtitle("Services") 
g4 <- g4 + ylab("") + xlab("")
g4 <- g4 + theme(legend.position="none")#,plot.margin=unit(c(-0.5,0.4,0,0.4), "cm"))
g4 <- g4 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g4 <- g4 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

library(gridExtra)
grid.arrange(g1, g2, g3, g4, ncol=2, nrow =2)

```

Figure 3.16 illustrates the weighted sectoral indicators of idiosyncratic error uncertainty. These indicators do not always point to the same periods of heightened uncertainty than the ones highlighted above. The indicator of idiosyncratic error uncertainty in the manufacturing sector exhibits spikes in 1994, with the first Democratic election, and again in 1996, with the adoption of the new Constitution. This indicator decreases during the Great Recession. The indicator in the construction sector exhibits a marked decrease during the 1997-1998 recession, which is following by spikes in 2000 and during the two semi-recessions. It is relatively flat for the rest of the period. The indicator for the trade sector is relatively volatile at the beginning of the period, and exhibits substantial decreases during all four recessionary periods. The indicator for the services sector is relatively high and volatile during the Great Recession, and exhibits a spike at the start of the downswing phase in 2014. 

```{r figure3.16, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Weighted sectoral indicators of idiosyncratic error uncertainty"}
index_plot <- cbind(idio.errors[,1:2])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Idiosyncratic")
g1 <- ggplot(index_plot, aes(x=Date,y=Idiosyncratic,group=1))
g1 <- g1 + geom_line(colour="#00BFC4")
g1 <- g1 + theme(legend.title=element_blank())
g1 <- g1 + ggtitle("Manufacturing") 
g1 <- g1 + ylab("Indicator") + xlab("")
g1 <- g1 + theme(legend.position="none")
g1 <- g1 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g1 <- g1 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(idio.errors[,c(1,3)])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Idiosyncratic")
g2 <- ggplot(index_plot, aes(x=Date,y=Idiosyncratic,group=1))
g2 <- g2 + geom_line(colour="#00BFC4")
g2 <- g2 + theme(legend.title=element_blank())
g2 <- g2 + ggtitle("Construction") 
g2 <- g2 + ylab("") + xlab("")
g2 <- g2 + theme(legend.position="none")
g2 <- g2 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g2 <- g2 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(idio.errors[,c(1,4)])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Idiosyncratic")
g3 <- ggplot(index_plot, aes(x=Date,y=Idiosyncratic,group=1))
g3 <- g3 + geom_line(colour="#00BFC4")
g3 <- g3 + theme(legend.title=element_blank())
g3 <- g3 + ggtitle("Trade") 
g3 <- g3 + ylab("Indicator") + xlab("")
g3 <- g3 + theme(legend.position="none")#,plot.margin=unit(c(-0.5,0.4,0,0.4), "cm"))
g3 <- g3 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g3 <- g3 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

index_plot <- cbind(idio.errors[,c(1,5)])
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Idiosyncratic")
g4 <- ggplot(index_plot, aes(x=Date,y=Idiosyncratic,group=1))
g4 <- g4 + geom_line(colour="#00BFC4")
g4 <- g4 + theme(legend.title=element_blank())
g4 <- g4 + ggtitle("Services") 
g4 <- g4 + ylab("") + xlab("")
g4 <- g4 + theme(legend.position="none")#,plot.margin=unit(c(-0.5,0.4,0,0.4), "cm"))
g4 <- g4 + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g4 <- g4 + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"))

library(gridExtra)
grid.arrange(g1, g2, g3, g4, ncol=2, nrow =2)

```

In some cases, therefore, the individual indicators for each sector do not point to the same periods of heightened uncertainty. Table 3.8, below, reports that the indicators are only weakly correlated in a few cases. The lack of correlation is due to the different calculation methods used to construct the proxies. The dispersion indicator measures the disagreement in expectations, expressed as a share of the natural dispersion. The aggregate error and idiosyncratic error uncertainty indicators measure respectively the mean and standard deviation of firm forecast errors. Aggregate error uncertainty will increase if more firms make similar and larger errors, while idiosyncratic error uncertainty will decrease if more firms make similar errors. Consequently, the indicators do not generally point to the same periods of heightened uncertainty.

This feature is also present for the aggregate indicators. Figure 3.17 illustrates the three weighted uncertainty indicators at the aggregate level, with the recessionary periods shaded. As with the sectoral proxies, the indicators are relatively volatile, and are weakly correlated only in a few cases, as Table 3.7 below reports. 

The dispersion indicator seems to follow an anti-cyclical pattern, with spikes during the recessionary periods. In particular, it points to periods of heightened uncertainty during the recessions of the early 1990s, the late 1990s, and the late 2000s. The aggregate error uncertainty indicator also seems to be broadly anti-cyclical. It exhibits large spikes in all four recessionary periods and during the two semi-recessions of the early 2000s. It also exhibits two large spikes in 2010 and 2011, during the period associated with the European debt crisis.

The idiosyncratic error indicator tends to decrease as the economy enters a recessionary period and then to increase towards the end of the recession and into the start of the recovery phase. This is probably because the majority of firms expected poorer general conditions with more certainty, as the recession took hold. Uncertainty about the future then increased around the trough, as expectations became more dispersed. The idiosyncratic error uncertainty indicator at the aggregate level also exhibits the two large spikes in 1994 and 1996, with the first Democratic election and the adoption of the new Constitution.

```{r figure3.17, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Weighted indicators of dispersion, aggregate error and idiosyncratic error uncertainty"}
index_plot <- w.uncert_error 
index_plot[,-1] <- scale(index_plot[,-1])
g <- ggplot(index_plot) 
g <- g + geom_line(aes(x=Date, y=Aggregate_error, colour="Aggregate_error"), size = 1)
g <- g + geom_line(aes(x=Date, y=Idiosyncratic_error, colour="Idiosyncratic_error"), size = 1)
g <- g + geom_line(aes(x=Date, y=Dispersion, colour="Dispersion"), size = 1)
g <- g + labs(color="Legend text")
g <- g + geom_rect(data=recessions.df, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='grey', alpha=0.5)
g <- g + ylab("Indicator") + xlab("")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + theme(legend.title=element_blank()) 
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"), expand=c(0,0),
                      limits = as.Date(c("1990-12-31", NA)))
g <- g + theme(legend.position="bottom")
g

```

More formal tests of validity are undertaken in the following section. This is done by comparing the uncertainty indicators with alternative measures of uncertainty, the EPU and the SAVI, and by evaluating the indicators in terms of their correlation with real GDP growth. A combined indicator is then constructed from all five proxies, which tries to combine the information in all of the individual indicators. The relationships are analysed for the aggregate variables, as well as for each sector separately. The advantage of also looking at specific sectors separately is that general equilibrium effects are mitigated. The wait-and-see effect may be dampened by general equilibrium price adjustments (e.g. at least some firms will continue hiring if wages adjust in equilibrium). The focus on sectoral indicators offers a better chance of detecting the wait-and-see effect [@Bachmann2010].

###Validity Tests and Evaluation
This section provides a comparison of the survey-based uncertainty indicators and the two alternative indicators of uncertainty in South Africa, the EPU and the SAVI. The information from all of the indicators is combined to form an overall combined uncertainty indicator, and their correlations with real GDP growth are subsequently evaluated. 

####Correlations between uncertainty indicators and real GDP growth
Figure 3.18 illustrates the two alternative indicators, as well as the combined overall uncertainty indicator (combined), which was calculated as the first principal component of the five standardised uncertainty indicators. The results are similar when calculating the combined uncertainty measure as an equal weighted average.

The combined indicator seems particularly plausible as a proxy for uncertainty, as a number of large spikes coincide with periods when uncertainty in South Africa was thought to be relatively high. For instance, uncertainty was relatively high during South Africa's Democratic transition up to 1994. There was quite a large spike, mainly in policy and idiosyncratic uncertainty, during the adoption of the new Constitution in 1996. Other spikes coincide with the East Asian and Russian crises, and the related recessionary period in 1997-1998; the semi-recession in 2003; the global financial crisis in 2008 and the subsequent recession; the European Debt crisis in 2011; and the start of the downswing phase in 2014.

```{r pca, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE}
uncert_indices <- cbind(w.uncert_error,GDPdata$IMF_Uncertainty, GDPdata$SAVI,GDPgrowth4$RGDP)
colnames(uncert_indices) <-c("Date","Dispersion","Idiosyncratic_error","Aggregate_error","EPU","SAVI","RGDP_Growth")
uncert_indices[,-1] <- scale(uncert_indices[,-1])
un <- uncert_indices #un <- na.locf(uncert_indices)
un[is.na(un)] <- 0
uncert_indices$Uncertainty_Combined <- princomp(un[,c(2:6)])$scores[,1]
uncert_indices <- uncert_indices[,c(1:6,8,7)]
```

```{r figure3.18, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Indicators of economic policy, financial market, and combined uncertainty"}
index_plot <- uncert_indices
g <- ggplot(index_plot) 
g <- g + geom_line(aes(x=Date, y=EPU, colour="EPU"), size = 0.8)
g <- g + geom_line(aes(x=Date, y=SAVI, colour="SAVI"), size = 0.8)
g <- g + geom_line(aes(x=Date, y=Uncertainty_Combined, colour="Uncertainty_Combined"), size = 1)
g <- g + labs(color="Legend text")
g <- g + geom_rect(data=recessions.df, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='grey', alpha=0.5)
g <- g + ylab("Indicator") + xlab("")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + theme(legend.title=element_blank()) 
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"), expand=c(0,0),
                      limits = as.Date(c("1990-12-31", NA)))
g <- g + theme(legend.position="bottom")
g

```

Table 3.7 reports the contemporaneous correlations of the indicators and real GDP growth. The dispersion, EPU and combined uncertainty indicators exhibit significant negative correlations with real GDP growth. These indicators are contemporaneously counter-cyclical, as is the case for the majority of the uncertainty indicators in the international literature [e.g. @Bloom2014]. The idiosyncratic error uncertainty indicator does not exhibit the negative correlation with real GDP growth found in @Bachmann2010 and @Bachmann2013.[^32]

[^32]: It is possible that there is a structural explanation for the different relationship between idiosyncratic error uncertainty and real GDP growth. For instance, South African firms may react later to events such as recessions than US firms (i.e. they may be less forward-looking). Alternatively, it could be that something growth effect is in operation in South Africa. There may also be problems with the survey data, either in terms of errors or unrepresentativeness.   

The individual indicators are only weakly correlated with one another in a few cases. This is not too surprising as they attempt to capture different types of uncertainty [@Leduc2015]. Survey-based measures capture the opinions of key agents in the economy and are driven by changes in firm-level uncertainty. Due to their qualitative nature, however, they are poorly equipped to fully capture large increases in uncertainty during extreme events [@Bachmann2013]. The SAVI captures broad uncertainty in financial markets, but is derived from a specific segment of firms that are publicly traded, while the EPU is focused specifically on policy uncertainty. This is the motivation for using a combined indicator, which captures different types of uncertainty from multiple sources. The combined uncertainty indicator has a significant positive correlation with all of the indicators, except for idiosyncratic error uncertainty, which reflects the factor loadings used in deriving the first principal component. 

```{r table3.7, echo=FALSE, results='asis', warning=FALSE, message=FALSE, cache = TRUE}
source("corstarsl.R")
colnames(uncert_indices)[7] <- "Combined"
xt <- xtable(corstarsl(uncert_indices[,-1]), caption="Correlations between the uncertainty indicators")
print(xt, "latex",comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), scalebox = 0.8)

```

Figure 3.19 illustrates the cross-correlograms for the uncertainty indicators and real GDP growth. All of the indicators, except for idiosyncratic error uncertainty, exhibit a significant negative correlation with real GDP growth, albeit at different horizons. All the indicators seem to lead changes in real GDP growth. The combined indicator exhibits the highest negative correlation with real GDP growth at a lag of 2 quarters.

```{r figure3.19, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=7.5, fig.width=7.5, fig.cap="Cross-correlograms of uncertainty indicators and real GDP growth"}
Dispersion <- uncert_indices[,2]
Idiosyncratic_error <- uncert_indices[,3]
Aggregate_error <- uncert_indices[,4]
EPU <- uncert_indices[,5] 
SAVI <- uncert_indices[,6] 
Uncertainty_Combined <- uncert_indices[,7]
RGDP_Growth <- conf_indices[,6]

par(mfrow=c(3,2))
ccf(Dispersion, RGDP_Growth, na.action = na.pass, ylim=c(-0.5, 0.5), 
    ylab = "Correlation", xlab = "Number of Lags")
ccf(Idiosyncratic_error, RGDP_Growth, na.action = na.pass, ylim=c(-0.5, 0.5), 
    ylab = "Correlation", xlab = "Number of Lags")
ccf(Aggregate_error, RGDP_Growth, na.action = na.pass, ylim=c(-0.5, 0.5), 
    ylab = "Correlation", xlab = "Number of Lags")
ccf(EPU, RGDP_Growth, na.action = na.pass, ylim=c(-0.5, 0.5), 
    ylab = "Correlation", xlab = "Number of Lags")
ccf(SAVI, RGDP_Growth, na.action = na.pass, ylim=c(-0.5, 0.5), 
    ylab = "Correlation", xlab = "Number of Lags")
ccf(Uncertainty_Combined, RGDP_Growth, na.action = na.pass, ylim=c(-0.5, 0.5), 
    ylab = "Correlation", xlab = "Number of Lags")
```

Table 3.8 reports the contemporaneous correlations for the sectoral indicators and sectoral real GDP growth. The combined uncertainty indicator for each sector is the first principal component of the three survey-based measures. The indicators of dispersion and combined uncertainty for the manufacturing, construction, and trade sectors are significantly negatively, if weakly, correlated with contemporaneous real sectoral GDP growth. 

```{r table3.8, echo=FALSE, results='asis', warning=FALSE, message=FALSE, cache = TRUE}
#Sectoral Analysis
manufac2 <- cbind(w.uncertainty[,c(1,2)],aggr.errors[,2],idio.errors[,2], GDPgrowth4$Manufacturing)
colnames(manufac2) <- c("Date","Dispersion","Aggregate","Idiosyncratic","RGDP_Growth")
manufac2[,2:4] <- scale(manufac2[,2:4])
#manufac2$Uncertainty <- rowMeans(manufac2[,c(2:4)],na.rm = TRUE)
manufac2 <- manufac2[-99,]
manufac2$Uncertainty <- -1*princomp(na.locf(manufac2[,2:4]))$scores[,1]
manufac2 <- manufac2[,c(1:4,6,5)]

construct2 <- cbind(w.uncertainty[,c(1,3)],aggr.errors[,3],idio.errors[,3], GDPgrowth4$Construction)
colnames(construct2) <- c("Date","Dispersion","Aggregate","Idiosyncratic","RGDP_Growth")
construct2[,2:4] <- scale(construct2[,2:4])
#construct2$Uncertainty <- rowMeans(construct2[,c(2:4)],na.rm = TRUE)
construct2 <- construct2[c(-1:-5,-99),] #un <- na.locf(uncert_indices)
construct2[is.na(construct2)] <- 0
construct2$Uncertainty <- -1*princomp(na.locf(construct2[,2:4]))$scores[,1]
construct2 <- construct2[,c(1:4,6,5)]

trade2 <- cbind(w.uncertainty[,c(1,4)],aggr.errors[,4],idio.errors[,4], GDPgrowth4$Trade)
colnames(trade2) <- c("Date","Dispersion","Aggregate","Idiosyncratic","RGDP_Growth")
trade2[,2:4] <- scale(trade2[,2:4])
#trade2$Uncertainty <- rowMeans(trade2[,c(2:4)],na.rm = TRUE)
trade2 <- trade2[c(-1,-99),] #un <- na.locf(uncert_indices)
trade2[is.na(trade2)] <- 0
trade2$Uncertainty <- princomp(na.locf(trade2[,2:4]))$scores[,1]
trade2 <- trade2[,c(1:4,6,5)]

services2 <- cbind(w.uncertainty[,c(1,5)],aggr.errors[,5],idio.errors[,5], GDPgrowth4$Services)
colnames(services2) <- c("Date","Dispersion","Aggregate","Idiosyncratic","RGDP_Growth")
services2[,2:4] <- scale(services2[,2:4])
#services2$Uncertainty <- rowMeans(services2[,c(2:4)],na.rm = TRUE)
services2 <- services2[c(-1:-53,-99),] #un <- na.locf(uncert_indices)
services2[is.na(services2)] <- 0
services2$Uncertainty <- princomp(na.locf(services2[,2:4]))$scores[,1]
services2 <- services2[,c(1:4,6,5)]

source("corstarsl.R")
xt1 <- cbind(corstarsl(manufac2[,-1]),corstarsl(construct2[,-1]))
xt2 <- cbind(corstarsl(trade2[,-1]),corstarsl(services2[,-1]))
xt1 <- sapply(xt1,as.character)
xt2 <- sapply(xt2,as.character)
xt1[1,] <- c("Dispersion","Aggregate","Idiosyncratic","Combined","Dispersion","Aggregate","Idiosyncratic","Combined")
xt2[1,] <- c("Dispersion","Aggregate","Idiosyncratic","Combined","Dispersion","Aggregate","Idiosyncratic","Combined")
colnames(xt1) <- c(" "," ","Manufacturing"," "," "," ","Construction"," ")
colnames(xt2) <- c(" "," ","Trade"," "," "," ","Services"," ")
row.names(xt1) <- c(" ","Aggregate","Idiosyncratic","Combined","RGDP")
row.names(xt2) <- c(" ","Aggregate","Idiosyncratic","Combined","RGDP")

xt <- xtable(xt1, caption="Correlations of uncertainty indicators and growth")
print(xt, "latex",comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), scalebox = 0.7)
xt <- xtable(xt2)
print(xt, "latex",comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), scalebox = 0.75)
```

Figure 3.20 illustrates the cross-correlograms for the manufacturing indicators and real GDP growth in the manufacturing sector. The correlograms are similar to the aggregated results reported above, where the dispersion and aggregate error measures have a significant negative relationship with real GDP growth. The results for the construction and trade sectors are similar, while the indicators for the services sector do not exhibit a negative relationship with real services GDP growth. 

```{r figure3.20, echo=FALSE, warning=FALSE, message=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="Cross-correlograms of manufacturing uncertainty indicators and real manufacturing GDP growth"}
calc_ccf <- function(data) {
    Dispersion <- data[,2]
    Aggregate_error <- data[,3]
    Idiosyncratic_error <- data[,4]
    Uncertainty_Combined <- data[,5]
    RGDP_Growth <- data[,6]
    
    par(mfrow=c(2,2))
    ccf(Dispersion, RGDP_Growth, na.action = na.omit, ylim=c(-0.5, 0.5), 
    ylab = "Correlation", xlab = "Number of Lags")
    ccf(Aggregate_error, RGDP_Growth, na.action = na.omit, ylim=c(-0.5, 0.5), 
    ylab = "Correlation", xlab = "Number of Lags")
    ccf(Idiosyncratic_error, RGDP_Growth, na.action = na.omit, ylim=c(-0.5, 0.5), 
    ylab = "Correlation", xlab = "Number of Lags")
    ccf(Uncertainty_Combined, RGDP_Growth, na.action = na.omit, ylim=c(-0.5, 0.5), 
    ylab = "Correlation", xlab = "Number of Lags")
}

calc_ccf(manufac2)
```

This section has presented three survey-based indicators of uncertainty, as well as two additional popular proxies from the literature: stock market volatility and the news-based EPU created by @Hlatshwayo2016. All the indicators, except idiosyncratic error uncertainty, appear to be anti-cyclical in the sense that they exhibit a significant negative correlation with real GDP growth, albeit at different horizons. All of the indicators seem to lead changes in real GDP growth. None of the indicators are a perfect measure of an elusive and multidimensional phenomenon, but all of them may contribute to our understanding of uncertainty [@Bachmann2013]. The five indicators were combined to form an overall combined uncertainty indicator, similar to those of @Baker2013 and @Redl2015, to reflect the different sources of uncertainty from the different proxies. This combined indicator appears to be a plausible indicator of uncertainty in South Africa, reflecting key economic events. The composite dispersion and combined uncertainty indicators, in particular, improve on the existing uncertainty indicators in that they exhibit a larger negative correlation with real GDP growth.

##The Relationship between Business Sentiment and Real Economic Activity
The ancillary aim in this chapter is to further examine the relationship between business sentiment and real economic activity in South Africa, including the timing of this relationship and the extent to which correlation is conditional on other economic variables. This demonstrates the usefulness of the aggregation methods and the estimated indicators, and provides an additional validity test of the indicators. In this section the hypothesis is tested that there is significant comovement between the sentiment indicators and real GDP growth. Granger causality tests are used to illuminate the timing of the relationships between the indicators and real output growth. Simple bivariate VARs are then estimated to investigate the dynamic effects of confidence and uncertainty shocks on the economy. A three-variable VAR and an extended VAR are then estimated to examine whether the results hold after the inclusion of additional variables.

###Granger Causality Tests
Granger causality tests are often performed when investigating the comovement between variables. This test determines whether one time series is useful in forecasting another, by measuring the ability of lagged values of a time series to predict the future values of another time series. A time series $Z$ is said to Granger-cause $Y$ if it can be shown that the $Z$ values provide statistically significant information of future values of $Y$. If the hypothesis that a sentiment indicator does not Granger-cause an economic variable is rejected, it implies that past values of sentiment provide significant information for the economic variable, in addition to its own history.

Table 3.9 reports the results for Granger causality tests for the confidence indicators and real GDP growth. The results suggest that the lagged values of all four confidence indicators significantly predict real GDP growth, with no evidence of Granger-causality in the reverse direction. In other words, the results suggest that all the confidence indicators contain relevant information for the prediction of output growth. This implies that the measures all exhibit a leading relationship with real GDP growth.

```{r vars, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
calc_var <- function(data) {
    vardat <- data
    infocrit <- VARselect(vardat, lag.max = 12, type = "const")
    k_aic <- infocrit$selection[1]
    k_hq  <- infocrit$selection[2]
    k_sic <- infocrit$selection[3]
    k <- min(k_aic,k_sic,k_hq)
    var_model <- VAR(vardat,p=k,type="const")
    return(var_model)
}

var1 <- calc_var(cbind(Confidence_Current,RGDP_Growth))
var2 <- calc_var(cbind(Confidence_Expected, RGDP_Growth))
var3 <- calc_var(cbind(BER_BCI, RGDP_Growth))
var4 <- calc_var(cbind(SACCI_Growth, RGDP_Growth))

G <- data.frame()
G[1,1] <- causality(var1,cause = "Confidence_Current")$Granger[4]
G[1,2] <- as.numeric(as.character(causality(var1,cause = "Confidence_Current")$Granger[1]))
G[1,3] <- as.numeric(as.character(causality(var1,cause = "Confidence_Current")$Granger[3]))
G[2,1] <- causality(var1,cause = "RGDP_Growth")$Granger[4]
G[2,2] <- as.numeric(as.character(causality(var1,cause = "RGDP_Growth")$Granger[1]))
G[2,3] <- as.numeric(as.character(causality(var1,cause = "RGDP_Growth")$Granger[3]))

G[3,1] <- causality(var2,cause = "Confidence_Expected")$Granger[4]
G[3,2] <- as.numeric(as.character(causality(var2,cause = "Confidence_Expected")$Granger[1]))
G[3,3] <- as.numeric(as.character(causality(var2,cause = "Confidence_Expected")$Granger[3]))
G[4,1] <- causality(var2,cause = "RGDP_Growth")$Granger[4]
G[4,2] <- as.numeric(as.character(causality(var2,cause = "RGDP_Growth")$Granger[1]))
G[4,3] <- as.numeric(as.character(causality(var2,cause = "RGDP_Growth")$Granger[3]))

G[5,1] <- causality(var3,cause = "BER_BCI")$Granger[4]
G[5,2] <- as.numeric(as.character(causality(var3,cause = "BER_BCI")$Granger[1]))
G[5,3] <- as.numeric(as.character(causality(var3,cause = "BER_BCI")$Granger[3]))
G[6,1] <- causality(var3,cause = "RGDP_Growth")$Granger[4]
G[6,2] <- as.numeric(as.character(causality(var3,cause = "RGDP_Growth")$Granger[1]))
G[6,3] <- as.numeric(as.character(causality(var3,cause = "RGDP_Growth")$Granger[3]))

G[7,1] <- causality(var4,cause = "SACCI_Growth")$Granger[4]
G[7,2] <- as.numeric(as.character(causality(var4,cause = "SACCI_Growth")$Granger[1]))
G[7,3] <- as.numeric(as.character(causality(var4,cause = "SACCI_Growth")$Granger[3]))
G[8,1] <- causality(var4,cause = "RGDP_Growth")$Granger[4]
G[8,2] <- as.numeric(as.character(causality(var4,cause = "RGDP_Growth")$Granger[1]))
G[8,3] <- as.numeric(as.character(causality(var4,cause = "RGDP_Growth")$Granger[3]))

G[,2:3] <- round(G[,2:3],3)
mystars <- ifelse(G[,3] < .01, "***", ifelse(G[,3] < .05, "** ", ifelse(G[,3] < .1, "* ", " ")))
Gnew <- matrix(paste(G[,2], mystars, sep=""), ncol=1) 
G[,1] <- sub(".*: ", "", G[,1])
G[,2] <- Gnew
colnames(G) <- c("Granger causality H0:","statistic","p-value")

```

```{r table3.9, echo=FALSE, results='asis', warning=FALSE, message=FALSE, cache = TRUE}
xt <- xtable(G, caption="Granger causality tests: confidence")
print(xt, "latex", include.rownames=FALSE,comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), 
      scalebox = 0.8)

```

Table 3.10 reports the results of the Granger causality tests for the sectoral confidence indicators and their corresponding real sectoral GDP growth rates. The results are similar to those for the aggregate indicators, except for the trade sector, where lagged values of real GDP growth significantly predict all three survey-based confidence indicators. This implies that the confidence indicators for the trade sector are lagging indicators of real GDP growth in that sector.

```{r table3.10, echo=FALSE, results='asis', warning=FALSE, message=FALSE, cache = TRUE}
calc_sectoralvar <- function(data, serv=0) {
    Confidence_Current <- data[,2]
    Confidence_Expected <- data[,3]
    BER_BCI <- data[,4]
    RGDP_Growth <- data[,5]
    
    var1 <- calc_var(cbind(Confidence_Current,RGDP_Growth))
    var2 <- calc_var(cbind(Confidence_Expected, RGDP_Growth))
    var3 <- calc_var(cbind(BER_BCI, RGDP_Growth))
    
    G <- data.frame()
    G[1,1] <- causality(var1,cause = "Confidence_Current")$Granger[4]
    G[1,2] <- as.numeric(as.character(causality(var1,cause = "Confidence_Current")$Granger[1]))
    G[1,3] <- as.numeric(as.character(causality(var1,cause = "Confidence_Current")$Granger[3]))
    G[2,1] <- causality(var1,cause = "RGDP_Growth")$Granger[4]
    G[2,2] <- as.numeric(as.character(causality(var1,cause = "RGDP_Growth")$Granger[1]))
    G[2,3] <- as.numeric(as.character(causality(var1,cause = "RGDP_Growth")$Granger[3]))
    
    G[3,1] <- causality(var2,cause = "Confidence_Expected")$Granger[4]
    G[3,2] <- as.numeric(as.character(causality(var2,cause = "Confidence_Expected")$Granger[1]))
    G[3,3] <- as.numeric(as.character(causality(var2,cause = "Confidence_Expected")$Granger[3]))
    G[4,1] <- causality(var2,cause = "RGDP_Growth")$Granger[4]
    G[4,2] <- as.numeric(as.character(causality(var2,cause = "RGDP_Growth")$Granger[1]))
    G[4,3] <- as.numeric(as.character(causality(var2,cause = "RGDP_Growth")$Granger[3]))
    
    if(serv==0) {
        G[5,1] <- causality(var3,cause = "BER_BCI")$Granger[4]
        G[5,2] <- as.numeric(as.character(causality(var3,cause = "BER_BCI")$Granger[1]))
        G[5,3] <- as.numeric(as.character(causality(var3,cause = "BER_BCI")$Granger[3]))
        G[6,1] <- causality(var3,cause = "RGDP_Growth")$Granger[4]
        G[6,2] <- as.numeric(as.character(causality(var3,cause = "RGDP_Growth")$Granger[1]))
        G[6,3] <- as.numeric(as.character(causality(var3,cause = "RGDP_Growth")$Granger[3]))
    }    
    G[,2:3] <- round(G[,2:3],3)
    mystars <- ifelse(G[,3] < .01, "***", ifelse(G[,3] < .05, "** ", ifelse(G[,3] < .1, "* ", " ")))
    Gnew <- matrix(paste(G[,2], mystars, sep=""), ncol=1) 
    G[,1] <- sub(".*: ", "", G[,1])
    G[,2] <- Gnew
    colnames(G) <- c("Granger causality H0:","statistic","p-value")
    
    return(G)
}

G_manu <- calc_sectoralvar(manufac)
G_build <- calc_sectoralvar(construct[-1:-5,])
G_trade <- calc_sectoralvar(trade[-1,])
G_serv <- calc_sectoralvar(services[-1:-53,],1)
G_serv <- rbind(G_serv, c("BER_BCI do not Granger-cause RGDP_Growth","",""), 
                c("RGDP_Growth do not Granger-cause BER_BCI","",""))

G_sector <- cbind(G_manu[,1:2],G_build[,2],G_trade[,2],G_serv[,2])
colnames(G_sector)[2:5] <- c("Manufacturing", "Construction","Trade","Services")

xt <- xtable(G_sector, caption="Granger causality tests: sectoral confidence")
print(xt, "latex", include.rownames=FALSE,comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), 
      scalebox = 0.75)
```

Table 3.11 reports the results of Granger causality tests for the uncertainty indicators and real GDP growth. The results suggest that the lagged values of three of the uncertainty indicators significantly predict real GDP growth, with no evidence of Granger-causality in the reverse direction. In other words, the results suggest that the dispersion, aggregate error, and combined uncertainty indicators contain relevant information for the prediction of output growth. This implies that these measures exhibit a leading relationship with real GDP growth.

```{r vars2, echo=FALSE, results='hide', message=FALSE, warning=FALSE, cache = TRUE}
calc_var <- function(data) {
    vardat <- data
    infocrit <- VARselect(vardat, lag.max = 12, type = "const")
    k_aic <- infocrit$selection[1]
    k_hq  <- infocrit$selection[2]
    k_sic <- infocrit$selection[3]
    k <- min(k_aic,k_sic,k_hq)
    var_model <- VAR(vardat,p=k,type="const")
    return(var_model)
}

var1 <- calc_var(cbind(Dispersion,RGDP_Growth)[-99,])
var2 <- calc_var(cbind(Aggregate_error, RGDP_Growth)[-99,])
var3 <- calc_var(cbind(Idiosyncratic_error, RGDP_Growth)[-99,])
var4 <- calc_var(cbind(EPU, RGDP_Growth)[-98:-99,])
var5 <- calc_var(cbind(SAVI,RGDP_Growth)[-1:-14,])
var6 <- calc_var(cbind(Uncertainty_Combined, RGDP_Growth))


G <- data.frame()
G[1,1] <- causality(var1,cause = "Dispersion")$Granger[4]
G[1,2] <- as.numeric(as.character(causality(var1,cause = "Dispersion")$Granger[1]))
G[1,3] <- as.numeric(as.character(causality(var1,cause = "Dispersion")$Granger[3]))
G[2,1] <- causality(var1,cause = "RGDP_Growth")$Granger[4]
G[2,2] <- as.numeric(as.character(causality(var1,cause = "RGDP_Growth")$Granger[1]))
G[2,3] <- as.numeric(as.character(causality(var1,cause = "RGDP_Growth")$Granger[3]))

G[3,1] <- causality(var2,cause = "Aggregate_error")$Granger[4]
G[3,2] <- as.numeric(as.character(causality(var2,cause = "Aggregate_error")$Granger[1]))
G[3,3] <- as.numeric(as.character(causality(var2,cause = "Aggregate_error")$Granger[3]))
G[4,1] <- causality(var2,cause = "RGDP_Growth")$Granger[4]
G[4,2] <- as.numeric(as.character(causality(var2,cause = "RGDP_Growth")$Granger[1]))
G[4,3] <- as.numeric(as.character(causality(var2,cause = "RGDP_Growth")$Granger[3]))

G[5,1] <- causality(var3,cause = "Idiosyncratic_error")$Granger[4]
G[5,2] <- as.numeric(as.character(causality(var3,cause = "Idiosyncratic_error")$Granger[1]))
G[5,3] <- as.numeric(as.character(causality(var3,cause = "Idiosyncratic_error")$Granger[3]))
G[6,1] <- causality(var3,cause = "RGDP_Growth")$Granger[4]
G[6,2] <- as.numeric(as.character(causality(var3,cause = "RGDP_Growth")$Granger[1]))
G[6,3] <- as.numeric(as.character(causality(var3,cause = "RGDP_Growth")$Granger[3]))

G[7,1] <- causality(var4,cause = "EPU")$Granger[4]
G[7,2] <- as.numeric(as.character(causality(var4,cause = "EPU")$Granger[1]))
G[7,3] <- as.numeric(as.character(causality(var4,cause = "EPU")$Granger[3]))
G[8,1] <- causality(var4,cause = "RGDP_Growth")$Granger[4]
G[8,2] <- as.numeric(as.character(causality(var4,cause = "RGDP_Growth")$Granger[1]))
G[8,3] <- as.numeric(as.character(causality(var4,cause = "RGDP_Growth")$Granger[3]))

G[9,1] <- causality(var5,cause = "SAVI")$Granger[4]
G[9,2] <- as.numeric(as.character(causality(var5,cause = "SAVI")$Granger[1]))
G[9,3] <- as.numeric(as.character(causality(var5,cause = "SAVI")$Granger[3]))
G[10,1] <- causality(var5,cause = "RGDP_Growth")$Granger[4]
G[10,2] <- as.numeric(as.character(causality(var5,cause = "RGDP_Growth")$Granger[1]))
G[10,3] <- as.numeric(as.character(causality(var5,cause = "RGDP_Growth")$Granger[3]))

G[11,1] <- causality(var6,cause = "Uncertainty_Combined")$Granger[4]
G[11,2] <- as.numeric(as.character(causality(var6,cause = "Uncertainty_Combined")$Granger[1]))
G[11,3] <- as.numeric(as.character(causality(var6,cause = "Uncertainty_Combined")$Granger[3]))
G[12,1] <- causality(var6,cause = "RGDP_Growth")$Granger[4]
G[12,2] <- as.numeric(as.character(causality(var6,cause = "RGDP_Growth")$Granger[1]))
G[12,3] <- as.numeric(as.character(causality(var6,cause = "RGDP_Growth")$Granger[3]))

G[,2:3] <- round(G[,2:3],3)
mystars <- ifelse(G[,3] < .01, "***", ifelse(G[,3] < .05, "** ", ifelse(G[,3] < .1, "* ", " ")))
Gnew <- matrix(paste(G[,2], mystars, sep=""), ncol=1) 
G[,1] <- sub(".*: ", "", G[,1])
G[,2] <- Gnew
colnames(G) <- c("Granger causality H0:","statistic","p-value")
```

```{r table3.11, echo=FALSE, results='asis', warning=FALSE, message=FALSE, cache = TRUE}
xt <- xtable(G, caption="Granger causality tests: uncertainty")
print(xt, "latex", include.rownames=FALSE,comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), 
      scalebox = 0.8)

```

The results for the sectoral indices, reported in Table 3.12, are not consistent across the sectors. There is some evidence of Granger-causality for a few of the indicators for the manufacturing sector. The tests are not significant at conventional levels in the trade sector, and in the construction sector only the combined uncertainty indicator significantly Granger-causes real trade GDP growth. In the services sector dispersion indicator seems to lag real GDP growth.

```{r table3.12, echo=FALSE, results='asis', warning=FALSE, message=FALSE, cache = TRUE}
calc_sectoralvar <- function(data) {
    Dispersion <- data[,2]
    Aggregate <- data[,3]
    Idiosyncratic <- data[,4]
    Uncertainty <- data[,5]
    RGDP_Growth <- data[,6]
    
    var1 <- calc_var(cbind(Dispersion, RGDP_Growth))
    var2 <- calc_var(cbind(Aggregate, RGDP_Growth))
    var3 <- calc_var(cbind(Idiosyncratic,RGDP_Growth))
    var4 <- calc_var(cbind(Uncertainty, RGDP_Growth))
    
    ##Granger causality tests
    G <- data.frame()
    G[1,1] <- causality(var1,cause = "Dispersion")$Granger[4]
    G[1,2] <- as.numeric(as.character(causality(var1,cause = "Dispersion")$Granger[1]))
    G[1,3] <- as.numeric(as.character(causality(var1,cause = "Dispersion")$Granger[3]))
    G[2,1] <- causality(var1,cause = "RGDP_Growth")$Granger[4]
    G[2,2] <- as.numeric(as.character(causality(var1,cause = "RGDP_Growth")$Granger[1]))
    G[2,3] <- as.numeric(as.character(causality(var1,cause = "RGDP_Growth")$Granger[3]))
    
    G[3,1] <- causality(var2,cause = "Aggregate")$Granger[4]
    G[3,2] <- as.numeric(as.character(causality(var2,cause = "Aggregate")$Granger[1]))
    G[3,3] <- as.numeric(as.character(causality(var2,cause = "Aggregate")$Granger[3]))
    G[4,1] <- causality(var2,cause = "RGDP_Growth")$Granger[4]
    G[4,2] <- as.numeric(as.character(causality(var2,cause = "RGDP_Growth")$Granger[1]))
    G[4,3] <- as.numeric(as.character(causality(var2,cause = "RGDP_Growth")$Granger[3]))
    
    G[5,1] <- causality(var3,cause = "Idiosyncratic")$Granger[4]
    G[5,2] <- as.numeric(as.character(causality(var3,cause = "Idiosyncratic")$Granger[1]))
    G[5,3] <- as.numeric(as.character(causality(var3,cause = "Idiosyncratic")$Granger[3]))
    G[6,1] <- causality(var3,cause = "RGDP_Growth")$Granger[4]
    G[6,2] <- as.numeric(as.character(causality(var3,cause = "RGDP_Growth")$Granger[1]))
    G[6,3] <- as.numeric(as.character(causality(var3,cause = "RGDP_Growth")$Granger[3]))
    
    G[7,1] <- causality(var4,cause = "Uncertainty")$Granger[4]
    G[7,2] <- as.numeric(as.character(causality(var4,cause = "Uncertainty")$Granger[1]))
    G[7,3] <- as.numeric(as.character(causality(var4,cause = "Uncertainty")$Granger[3]))
    G[8,1] <- causality(var4,cause = "RGDP_Growth")$Granger[4]
    G[8,2] <- as.numeric(as.character(causality(var4,cause = "RGDP_Growth")$Granger[1]))
    G[8,3] <- as.numeric(as.character(causality(var4,cause = "RGDP_Growth")$Granger[3]))
    
    G[,2:3] <- round(G[,2:3],3)
    mystars <- ifelse(G[,3] < .01, "***", ifelse(G[,3] < .05, "** ", ifelse(G[,3] < .1, "* ", " ")))
    Gnew <- matrix(paste(G[,2], mystars, sep=""), ncol=1) 
    G[,1] <- sub(".*: ", "", G[,1])
    G[,2] <- Gnew
    colnames(G) <- c("Granger causality H0:","statistic","p-value")
    
    return(G)
}

G_manu <- calc_sectoralvar(manufac2)
G_build <- calc_sectoralvar(construct2)
G_trade <- calc_sectoralvar(trade2)
G_serv <- calc_sectoralvar(services2)

G_sector <- cbind(G_manu[,1:2],G_build[,2],G_trade[,2],G_serv[,2])
colnames(G_sector)[2:5] <- c("Manufacturing", "Construction","Trade","Services")

xt <- xtable(G_sector, caption="Granger causality tests: sectoral uncertainty")
print(xt, "latex", include.rownames=FALSE,comment=FALSE, caption.placement = getOption("xtable.caption.placement", "top"), 
      scalebox = 0.8)
```

###VAR Analysis
This section provides evidence on the dynamic effects of sentiment shocks on real economic activity. As many economic variables move together over time, without an obvious causal direction, it can be challenging to identify the directions of relationships. In the literature, timing has often been relied on for identification. In this section, the literature (e.g. @Taylor2007; @Barsky2012; @Bachmann2013) is followed in using standard recursive VARs to trace out the dynamic responses of economic activity to surprise shocks in sentiment. The aim is to investigate whether the indicators have a significant dynamic relationship with real output, whether they contain predictive content for output growth, and whether shocks to sentiment generate responses that are in line with the theory and the findings in the literature. 

The relationships were investigated for the aggregate variables, as well as separately for each sector, using bivariate recursive VARs featuring a measure of sentiment and real GDP growth. A bivariate system is a parsimonious way to model the joint dynamics of sentiment and real economic activity [@Bachmann2013]. In the bivariate case, both variables are treated as endogenous:
$$y_t = \beta_{10} - \beta_{12} z_t + \gamma_{11} y_{t-1} + \gamma_{12} z_{t-1} + \epsilon_{yt}$$
$$z_t = \beta_{20} - \beta_{21} y_t + \gamma_{21} y_{t-1} + \gamma_{22} z_{t-1} + \epsilon_{zt} ,$$
where $y$ is output, $z$ is sentiment, and $\epsilon$ is the residual of each equation. 

A range of VARs were estimated for the quarterly data running from 1992Q1 to 2016Q3. The indicators enter in levels, while the real GDP series enter as annual quarter-on-quarter growth rates, which corresponds with the survey reference period. Unit root tests indicate that virtually all of the aggregate and sectoral indicators, and the corresponding real GDP growth rates are stationary. The exception is real GDP growth in the services sector, which may be due to the shorter sample period. The appropriate number of lags are selected by means of the Akaike information criterion (AIC), the Schwarz criterion (SC) and the Hannan-Quinn criterion (HQ). The most parsimonious model is selected, provided that the diagnostic tests (i.e. no serial correlation, homoscedasticity and normality) are satisfied. In the majority of cases, the information criteria point to two lags. The model fit is best when a constant term is included. 

The sentiment indicators are ordered first in a recursive identification strategy, with the Cholesky decomposition used to identify structural shocks. With this ordering, shocks to sentiment are allowed to have a contemporaneous impact on output, but shocks to output have no contemporaneous impact on sentiment ($\beta_{21} = 0$). In other words, innovations to the confidence indicators influence economic output on impact, but not vice versa. This is the identification strategy and ordering used in the literature (e.g. @Leduc2013, @Bachmann2013, @Girardi2015, @Baker2015, and @Redl2015). It can be motivated by the timing of the surveys before the release of most macroeconomic data [@Leduc2015]. When the survey is completed in time $t$, the respondents do not know the realisations of output growth in time $t$, as the response deadline is generally the second month of the quarter. 

####Confidence
Impulse response functions (IRFs) can be generated to illustrate the dynamic impact of a shock to sentiment on the system. The shock is an innovation to the residual in the equation. Figure 3.21 illustrates the IRFs of a bivariate VAR for the confidence indicator on current conditions and real GDP growth. The left panel plots the responses of real GDP growth to an orthogonal shock in the indicator, with 95% bootstrap confidence intervals. Following an increase in confidence, real GDP growth increases by around 0.3% on impact, with a peak at two quarters. The impact on the growth rate is transitory, dying out after approximately seven quarters. This is equivalent to a permanent increase in the level of output, which confirms the findings in the literature (e.g. @Barsky2012). The right panel plots the response of confidence to an orthogonal shock in real GDP growth. Following an increase in real GDP growth, there is an insignificant increase in confidence of around 2% after two quarters. The results are virtually identical for the confidence indicator on expected conditions and the BER BCI, whereas the SACCI growth rate exhibits a smaller significant relationship with real activity after two quarters. The results are similar for alternative orderings.

```{r figure3.21, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="IRFs of confidence (current conditions) and real GDP growth"}
vardat <- cbind(conf_indices[,2],conf_indices[,6])
colnames(vardat) <- c("Confidence_Current","RGDP_Growth")
infocrit <- VARselect(vardat, lag.max = 12, type = "const")
k_aic <- infocrit$selection[1]
k_hq  <- infocrit$selection[2]
k_sic <- infocrit$selection[3]
k <- min(k_aic,k_sic,k_hq)
var1 <- VAR(vardat,p=k,type="const")

irf.y1 <- irf(var1,impulse = "Confidence_Current", response = "RGDP_Growth", n.ahead = 12,runs = 1000, seed=12345) 
irf.y2 <- irf(var1,impulse = "RGDP_Growth", response = "Confidence_Current", n.ahead = 12,runs = 1000, seed=12345)

par(mfrow=c(1,1), new=FALSE)
nf <- layout(matrix(c(1,2,1,2), 1, 2, byrow = TRUE))
plot(irf.y1,plot.type = c("single"), main="Response from Confidence", xlab="Horizon in quarters")
par(new = TRUE)
plot(irf.y2,plot.type = c("single"), main="Response from RGDP Growth", xlab="Horizon in quarters")
```

The importance of innovations can also be examined with variance decompositions. While the IRFs describe the reaction of a variable of interest to an exogenous shock, the decomposition of the forecast error variance of a given variable shows how much of the error can be explained by exogenous shocks to the other variables in the system [@Girardi2015]. The forecast error variance decomposition (FEVD) shows the proportion of the movements in a sequence due to its own shocks and shocks to the other variable. Figure 3.22 illustrates the FEVDs for the current conditions confidence indicator and real GDP growth. Up to around half (46%) of the movements in real GDP growth are explained by the confidence indicator over the longer term, while real GDP explains up to 2% of the variance in the confidence indicator.

```{r figure3.22, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="FEVDs of confidence (current conditions) and real GDP growth"}
source("plot_varfevd.R")
par(mfrow=c(1,1), new=FALSE)
par(mfrow=c(1,2))
plot.varfevd(fevd(var1, n.ahead = 10 ),plot.type = "single", xlab="Horizon in quarters", ylab="Proportion of variance explained")
```

The results for the sectoral indicators are very similar to the aggregate results. Figure 3.23 illustrates the IRFs of a bivariate VAR for the current conditions confidence indicator in the manufacturing sector and real GDP growth in the manufacturing sector. Following an increase in confidence, real GDP growth increases on impact, with a peak at two quarters. The impact on the growth rate dies out after approximately four quarters. Following an increase in real GDP growth, there is a significant increase in confidence in the following quarter. The results are similar for alternative orderings. The results for the other sectoral indicators are very similar to those for the manufacturing sector, with the exception that in the construction sector, the impact of a shock to confidence on GDP growth does not die out within the forecast horizon of 12 quarters.

```{r figure3.23, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="IRFs of confidence (current conditions) and real GDP growth in the manufacturing sector"}
vardat <- cbind(manufac[,2],manufac[,5])
colnames(vardat) <- c("Confidence_Current","RGDP_Growth")
infocrit <- VARselect(vardat, lag.max = 12, type = "const")
k_aic <- infocrit$selection[1]
k_hq  <- infocrit$selection[2]
k_sic <- infocrit$selection[3]
k <- min(k_aic,k_sic,k_hq)
varm <- VAR(vardat,p=k,type="const")

irf.y1 <- irf(varm,impulse = "Confidence_Current", response = "RGDP_Growth", n.ahead = 12,runs = 1000, seed=12345) 
irf.y2 <- irf(varm,impulse = "RGDP_Growth", response = "Confidence_Current", n.ahead = 12,runs = 1000, seed=12345)

par(mfrow=c(1,1), new=FALSE)
nf <- layout(matrix(c(1,2,1,2), 1, 2, byrow = TRUE))
#layout.show(nf)
#par(cex=1)
plot(irf.y1,plot.type = c("single"), main="Response from Confidence", xlab="Horizon in quarters")
par(new = TRUE)
plot(irf.y2,plot.type = c("single"), main="Response from RGDP Growth", xlab="Horizon in quarters")
```

Figure 3.24 illustrates the FEVDs for the current conditions confidence indicator and real GDP growth in the manufacturing sector. Up to more than a third (37%) of the movements in real GDP growth are explained by confidence over the longer term, while real GDP explains up to 5% of the variance in confidence. Overall, the results suggest that shocks to the confidence indicators account for between 20% and 60% of the forecast error variance of the real GDP growth rate, depending on the level of aggregation and the indicator.

```{r figure3.24, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="FEVDs of confidence (current conditions) and real GDP growth in the manufacturing sector"}
source("plot_varfevd.R")
par(mfrow=c(1,2))
plot.varfevd(fevd(varm, n.ahead = 10 ),plot.type = "single")
```

####Uncertainty
Figure 3.25 illustrates the IRFs of a bivariate VAR with the dispersion indicator and real GDP growth. The left panel plots the responses of real GDP growth to an orthogonal shock in dispersion, with 95% bootstrap confidence intervals. A shock to dispersion is followed by a significant decrease in real GDP growth in the following quarter. The right panel plots the response of dispersion to an orthogonal shock in real GDP growth. Following a shock to real GDP growth, there is an insignificant response in the dispersion indicator. The IRFs for the aggregate error, EPU, and SAVI indicators of uncertainty are very similar. Shocks to these indicators are associated with a moderately significant decreases in real GDP growth, while shocks to real GDP growth do not lead to a significant changes in the uncertainty indicators. The IRFs for the idiosyncratic error uncertainty indicator are not significant. The results are similar for alternative orderings.

```{r figure3.25, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="IRFs of uncertainty (dispersion) and real GDP growth"}
vardat <- cbind(uncert_indices[,2],conf_indices[,6])[-99,]
colnames(vardat) <- c("Dispersion","RGDP_Growth")
infocrit <- VARselect(vardat, lag.max = 12, type = "const")
k_aic <- infocrit$selection[1]
k_hq  <- infocrit$selection[2]
k_sic <- infocrit$selection[3]
k <- min(k_aic,k_sic,k_hq)
var1 <- VAR(vardat,p=k,type="const")

irf.y1 <- irf(var1,impulse = "Dispersion", response = "RGDP_Growth", n.ahead = 12,runs = 1000, seed=12345) 
irf.y2 <- irf(var1,impulse = "RGDP_Growth", response = "Dispersion", n.ahead = 12,runs = 1000, seed=12345)

par(mfrow=c(1,1), new=FALSE)
nf <- layout(matrix(c(1,2,1,2), 1, 2, byrow = TRUE))
#layout.show(nf)
#par(cex=1)
plot(irf.y1,plot.type = c("single"), main="Response from Dispersion", xlab="Horizon in quarters")
par(new = TRUE)
plot(irf.y2,plot.type = c("single"), main="Response from RGDP Growth", xlab="Horizon in quarters")
```

Figure 3.26 illustrates the IRFs of a bivariate VAR with the combined uncertainty indicator and real GDP growth. A shock to uncertainty is followed by a significant decrease in real GDP growth, with a peak at three quarters. The impact is larger and more significant than for any of the component uncertainty indicators separately. The impact on the growth rate is also transitory, dying out after approximately seven quarters. This result confirms the findings in much of the literature (e.g. @Bachmann2013 and @Redl2015), where innovations to uncertainty have protracted negative effects on economic activity. 

```{r figure3.26, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="IRFs of uncertainty (combined) and real GDP growth"}
vardat <- cbind(uncert_indices[,7],conf_indices[,6])
colnames(vardat) <- c("Uncertainty","RGDP_Growth")
infocrit <- VARselect(vardat, lag.max = 12, type = "const")
k_aic <- infocrit$selection[1]
k_hq  <- infocrit$selection[2]
k_sic <- infocrit$selection[3]
k <- min(k_aic,k_sic,k_hq)
var6 <- VAR(vardat,p=k,type="const")

irf.y1 <- irf(var6,impulse = "Uncertainty", response = "RGDP_Growth", n.ahead = 12,runs = 1000, seed=12345) 
irf.y2 <- irf(var6,impulse = "RGDP_Growth", response = "Uncertainty", n.ahead = 12,runs = 1000, seed=12345)

par(mfrow=c(1,1), new=FALSE)
nf <- layout(matrix(c(1,2,1,2), 1, 2, byrow = TRUE))
plot(irf.y1,plot.type = c("single"), main="Response from Uncertainty", xlab="Horizon in quarters")
par(new = TRUE)
plot(irf.y2,plot.type = c("single"), main="Response from RGDP Growth", xlab="Horizon in quarters")

```

Figure 3.27 illustrates the FEVDs for the combined uncertainty indicator and real GDP growth. Over 30% of the movements in real GDP growth are explained by the uncertainty indicator over the longer term, while real GDP explains about 1% of the variance in uncertainty. This is in line with findings in the literature (e.g. @Bachmann2013).

```{r figure3.27, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="FEVDs of uncertainty (combined) and real GDP growth"}
source("plot_varfevd.R")
par(mfrow=c(1,2))
plot.varfevd(fevd(var6, n.ahead = 10 ),plot.type = "single")

```

Figure 3.28 illustrates the IRFs of a bivariate VAR for the combined manufacturing uncertainty indicator and real GDP growth in the manufacturing sector. A shock to uncertainty is followed by a significant decrease in real GDP growth, with a peak at two quarters. There is even some evidence of a subsequent rebound predicted by the 'wait-and-see' effect demonstrated in @Bloom2009. The FEVDs illustrated in Figure 3.29 show that around 30% of the movements in real manufacturing GDP growth are explained by uncertainty over the longer term. 

```{r figure3.28, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="IRFs of uncertainty (combined) and real GDP growth in the manufacturing sector"}
vardat <- cbind(manufac2[,5],manufac2[,6])
colnames(vardat) <- c("Uncertainty","RGDP_Growth")
infocrit <- VARselect(vardat, lag.max = 12, type = "const")
k_aic <- infocrit$selection[1]
k_hq  <- infocrit$selection[2]
k_sic <- infocrit$selection[3]
k <- min(k_aic,k_sic,k_hq)
varm <- VAR(vardat,p=k,type="const")

irf.y1 <- irf(varm,impulse = "Uncertainty", response = "RGDP_Growth", n.ahead = 12,runs = 1000, seed=12345) 
irf.y2 <- irf(varm,impulse = "RGDP_Growth", response = "Uncertainty", n.ahead = 12,runs = 1000, seed=12345)

par(mfrow=c(1,1), new=FALSE)
nf <- layout(matrix(c(1,2,1,2), 1, 2, byrow = TRUE))
#par(cex=1)
plot(irf.y1,plot.type = c("single"), main="Response from Uncertainty", xlab="Horizon in quarters")
par(new = TRUE)
plot(irf.y2,plot.type = c("single"), main="Response from RGDP Growth", xlab="Horizon in quarters")

```

```{r figure3.29, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="FEVDs of uncertainty (combined) and real GDP growth in the manufacturing sector"}
source("plot_varfevd.R")
par(mfrow=c(1,2), new = FALSE)
plot.varfevd(fevd(varm, n.ahead = 10 ),plot.type = "single")
```

There is no a consistent negative relationship for any single indicator and real GDP growth in the other three sectors. In the construction sector, the dispersion and combined uncertainty indicators have a significant negative impact on real GDP growth. In the trade sector, only the dispersion indicator has a significant negative impact, while in the services sector only the idiosyncratic error indicator has a significant impact on real GDP growth. 

####Expanded VAR
Though instructive, the results from a bivariate system are prone to misspecification [@Girardi2015]. In order to test the robustness of the negative effect of uncertainty shocks, a number of authors have extended the baseline setup to include measures of confidence (@Girardi2015, @Leduc2015, @Baker2015 and @Bachmann2010). Periods of increased uncertainty also tend to be periods of bad economic news. Confidence is usually included to control for the possibility that the impact of uncertainty may reflect respondents' perceptions of bad news rather than of an uncertain future [@Baker2015]. 

Figure 3.30 illustrates the current conditions measure of confidence and the combined uncertainty indicator with recessionary periods shaded. The two sentiment indicators do not appear to be mirror images of each other, with a correlation of -0.36. Although confidence is pro-cyclical and uncertainty is mostly anti-cyclical, they appear to capture different phenomena. 

```{r figure3.30, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4, fig.width=7.5, fig.cap="Confidence (current) and Uncertainty (combined)"}
index_plot <- cbind(conf_indices[,c(1,2)],Uncertainty_Combined) 
index_plot[,-1] <- scale(index_plot[,-1])
colnames(index_plot) <- c("Date","Confidence_Current","Uncertainty_Combined")
g <- ggplot(index_plot) 
g <- g + geom_line(aes(x=Date, y=Confidence_Current, colour="Confidence_Current"), size = 1)
g <- g + geom_line(aes(x=Date, y=Uncertainty_Combined, colour="Uncertainty_Combined"), size = 1)
g <- g + labs(color="Legend text")
g <- g + geom_rect(data=recessions.df, aes(xmin=Peak, xmax=Trough, ymin=-Inf, ymax=+Inf), fill='grey', alpha=0.5)
g <- g + ylab("Indicator") + xlab("")
g <- g + theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
g <- g + theme(legend.title=element_blank()) 
g <- g + scale_x_date(labels = date_format("%Y"),breaks = date_breaks("year"), expand=c(0,0),
                      limits = as.Date(c("1990-12-31", NA)))
g <- g + theme(legend.position="bottom")
g
```

Figure 3.31 illustrates the IRFs of a three-variable VAR including confidence on current conditions, combined uncertainty and real GDP growth. Following @Girardi2015, confidence was ordered first under a recursive identification scheme. The results are very similar to the IRFs for the bivariate VARs reported earlier. A positive shock to confidence is followed by a significant increase in real GDP growth, while a positive shock to uncertainty is followed by a significant decrease in real GDP growth. Figure 3.32 illustrates the FEVDs for this three-variable VAR. Up to around 30% of the variance in real GDP growth is explained by confidence over the longer term, while uncertainty explains around 25% of the variance.

```{r figure3.31, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4, fig.width=7.5, fig.cap="IRFs of real GDP growth to confidence and uncertainty in the three-variable VAR"}
Confidence_Current <- conf_indices[,2]
Uncertainty_Combined <- uncert_indices[,7]
RGDP_Growth <- conf_indices[,6]

vardat <- cbind(Confidence_Current,Uncertainty_Combined,RGDP_Growth)  
infocrit <- VARselect(vardat, lag.max = 16, type = "const")
k_aic <- infocrit$selection[1]
k_hq  <- infocrit$selection[2]
k_sic <- infocrit$selection[3]
k <- min(k_aic,k_sic,k_hq)
var_3 <- VAR(vardat,p=2,type="const")

irf.y1 <- irf(var_3,impulse = c("Confidence_Current","Uncertainty_Combined"), response = "RGDP_Growth", n.ahead = 12,runs = 1000, seed=12345) 
par(mfrow=c(1,2),mar=c(5,4,4,2), cex=0.6)
plot(irf.y1,plot.type = c("single"))
```

```{r figure3.32, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="FEVDs of the three-variable VAR"}
source("plot_varfevd.R")
par(mfrow=c(1,3))
plot.varfevd(fevd(var_3, n.ahead = 10 ),plot.type = "single")
```

A larger VAR system was also estimated to test the robustness of the relationships. The extended VAR includes the variables suggested by @Redl2015 for South Africa: confidence, uncertainty, the JSE All Share Index, the yield spread (i.e. the Government Bond Yield minus the three-month T-Bill rate), GDP, industrial production, investment, and an employment index. These variables are typically included in the literature (e.g. @Leduc2013, @Bachmann2013, and @Baker2015). 

The variables were ordered with the sentiment variables first, the financial variables next and the real variables last. The financial variables were expected to move faster than the real variables [@Redl2015]. An alternative ordering of placing the sentiment indicators last provides qualitatively similar results. As was the case in the previous VARs, the variables enter as real annual quarter-on-quarter growth rates, except for the sentiment indices and the yield spread. The model was estimated with two lags, with the caveat that the information criteria indicate that more than the maximum number of lags are appropriate. The results with four lags are qualitatively similar. 

The IRFs for the impact of confidence (current conditions) and uncertainty (combined) on the growth rate of real GDP, real production and real investment are illustrated in Figure 3.33. The top panels illustrate the responses of the real variables to a shock in confidence, and the bottom panels show the responses to a shock in uncertainty. The larger system seems to provide similar results to the findings in bivariate VARs. The response in real GDP growth are similar to those in the three-variable model. The impacts of the shocks are larger on real production and investment growth than on real GDP growth. This is what the wait-and-see theory would predict. The responses of employment (not illustrated) are very similar to those of real GDP growth. According to the FEVD, confidence explains around 35%, 25%, and 40% of the variance in real GDP growth, real production growth and real investment growth, while uncertainty explains around 15%, 25% and 20% of the variance in the three real variables.

```{r figure3.33, echo=FALSE, warning=FALSE, cache = TRUE, fig.height=4.5, fig.width=7.5, fig.cap="IRFs of real activity growth to confidence (top row) and uncertainty (bottom row) shocks"}
JSE <- GDPgrowth4$RJSE
Bond <- GDPdata$Bond2
TBill <- GDPdata$T.Bill
Spread <- Bond-TBill
Employment <- GDPgrowth4$Employ
Investment <- GDPgrowth4$Rinvestment 
Production <- GDPgrowth4$RProduction

vardat <- cbind(Confidence_Current,Uncertainty_Combined,JSE,Spread,RGDP_Growth,
                Production,Employment,Investment)  
vare <- VAR(vardat,p=2,type="const")

irf.y1 <- irf(vare,impulse = c("Confidence_Current","Uncertainty_Combined"),
              response = c("RGDP_Growth","Production","Investment"), n.ahead = 12,runs = 1000, seed=12345) 
par(mfrow=c(2,3),mar=c(3,4,2,1), cex=0.6)
plot(irf.y1,plot.type = c("single"), main=c(" "))
```

###Summary and Suggested Future Research
The ancillary aim in this chapter was to examine the relationship between business sentiment and real economic activity in South Africa. In this section the hypothesis was tested that there was significant comovement between the sentiment indicators and real GDP growth. The aim was to investigate whether the indicators have a significant dynamic relationship with real output, whether they contain predictive content for output growth, and whether shocks to sentiment generate responses that are in line with the theory and the findings in the literature.

This section presented evidence that the confidence indicators contain relevant information for predicting output growth. The lagged values of both new confidence indicators significantly Granger-caused real GDP growth, with limited evidence of Granger-causality in the reverse direction. The indicators had a positive and significant impact on real GDP growth in the bivariate VAR models, which confirmed the results in the literature. Shocks to the indicators accounted for a sizeable fraction of variation in economic activity. This is the case for the aggregate indicators as well as the sectoral indicators. This implies that the confidence indicators contain useful information about current and future economic developments. As a result, the confidence indicators may be useful for monitoring developments in a timely manner and for forecasting future economic activity. 

The results suggest that the lagged values of the dispersion, aggregate error and combined uncertainty indicators significantly predict real GDP growth. Thus, the results suggest that three uncertainty indicators contain relevant information for the prediction of output growth. The results from the bivariate VAR analysis indicated that a shock to the uncertainty indicator was followed by a significant decrease in real GDP growth. This confirms the findings in most of the literature, where innovations to uncertainty have protracted negative effects on economic activity. 

The results from the larger VAR systems confirmed the findings from the bivariate VARs. The impulse responses of real GDP growth were similar to those in the bivariate model. The responses of real production and investment growth to shocks to the sentiment indicators were larger than the responses of real GDP growth. This is what the wait-and-see theory would predict for the uncertainty indicators [@Bloom2009]. Overall, the results provide evidence at least of significant comovement between the sentiment indicators and real economic activity. 

A future avenue for investigation would be to assess the usefulness of the indicators in improving out-of-sample forecasts. Significant in-sample evidence of forecasting power does not guarantee significant out-of-sample ability. The usefulness of the confidence indicators for real-time forecasting could also be assessed, given that they are available around two months before many official series.

An additional avenue for investigation would be to test whether there is asymmetry in the frequency horizon of shock effects. Deeper or systemic shocks may be associated with medium-term, rather than high-frequency fluctuations in output. An extension would be to test whether the relationship is non-linear or asymmetric, depending on the size or duration of the change in sentiment. The forecasting ability of the indicators might be offset completely by other variables during ordinary times, while increasing notably in the presence of unusual events. For instance, shocks to sentiment might play an important role only during episodes of economic tension associated with large decreases in confidence and heightened uncertainty. Moreover, the relation during a recovery phase (and potentially the late stages of a recession) may be different from the relation during the rest of an expansion. It may also be instructive to determine what factors influence the indicators of sentiment.

##Conclusion
The primary aim in this dissertation is to demonstrate aggregation methods that may be useful in overcoming specific data challenges in order to create useful macroeconomic indicators. This chapter has demonstrated aggregation methods to estimate proxies for business confidence and uncertainty using the microeconomic data from the BER business tendency surveys. 

The challenge in aggregating the microeconomic data from the BER business tendency surveys is to identify an underlying pattern from the disparate views of individual agents. The chapter used different combinations of the weighted cross-sectional first and second moments of the distribution of the qualitative survey responses to create composite indicators of confidence and uncertainty. The composite indicators incorporated the survey responses from questions on general business conditions, output, employment, orders placed and profitability. For each question, the responses were weighted by firm size and subsector size to produce sectoral indicators, including the services sector. The sectoral indicators were then weighted by GDP share to produce the overall aggregate composite indicators.

Two composite confidence indicators were calculated. The first was the cross-sectional mean of responses to questions on current business conditions, and the second was the cross-sectional mean of responses to questions on expected future business conditions [@OECD2003]. These confidence indicators exhibited a significant positive correlation with real GDP growth. The indicators provided advanced warning of business cycle turning points, although there were a few false signals. The new composite indicators outperformed the existing confidence indicators in terms of their correlation with real GDP growth (tracking record) and their concordance with the official SARB business cycle.

Three composite uncertainty indicators were calculated. The first was the scaled cross-sectional standard deviation of forward-looking responses [@Girardi2015]. The second was the cross-sectional mean of individual firm forecast errors, and the third was the cross-sectional standard deviation of firm forecast errors [@Arslan2011; @Bachmann2013]. In addition, an overall combined uncertainty indicator was created, which combined the information from the three survey-based indicators, as well as a financial market uncertainty indicator and an economic policy uncertainty indicator. The combined indicator appeared to be a plausible proxy of macroeconomic uncertainty in South Africa, reflecting key economic events. For the most part, the uncertainty indicators were counter-cyclical in the sense that they exhibited a significant negative correlation with real GDP growth. The composite dispersion and combined uncertainty indicators, in particular, exhibited larger negative correlations with real GDP growth than the existing uncertainty indicators.

The ancillary aim in this chapter was to examine the relationship between business sentiment and real economic activity in South Africa. This demonstrates the usefulness of the aggregation methods and the estimated indicators, and provides an additional validity test of the indicators. The hypothesis that there was significant comovement between the sentiment indicators and real GDP growth was tested. In the VAR models, a shock to the confidence indicators was followed by a significant increase in real GDP growth. A shock to the combined uncertainty indicator was followed by a significant decrease in real GDP growth. 

The results from the larger VAR systems confirmed the findings in bivariate VARs. The significant relationships between the sentiment indicators and real economic activity held after the inclusion of additional variables. Shocks to the sentiment indicators had larger impacts on real production and investment growth than on real GDP growth. This is what the wait-and-see effect would predict for the uncertainty indicators.

The results provide evidence at least of important comovement between the indicators of sentiment and real economic activity. The indicators may therefore be useful for monitoring economic developments in a timely manner and contain potentially useful predictive information for output growth.

Three contributions to the literature were attempted in this chapter. The first was to demonstrate aggregation methods to estimate sentiment indicators from the disparate qualitative responses of individual firms. The previous chapter constructed various quality-adjusted measures of the mean of the distribution of growth rates in art prices. This chapter calculated various weighted measures of the mean and standard deviation of survey responses, as well as forecast errors, as proxies for confidence and uncertainty.

The weighted cross-sectional moments employed in this chapter would be useful in other applications with qualitative survey responses, such as consumer surveys, where there are challenges in capturing the full richness in the data. Consumer confidence measures are popular indicators and are often calculated using qualitative surveys. Popular international confidence indicators include the European Commission's Consumer Confidence Indicator and the University of Michigan's Consumer Sentiment Index for the US [@UN2015]. The BER calculates consumer confidence for South Africa using their consumer tendency surveys. It would be possible to improve on the existing measures of consumer confidence using the techniques demonstrated in this chapter to identify an underlying pattern from the disparate views of individual agents. Moreover, it would be possible create new measures of consumer uncertainty, by calculating the weighted cross-sectional dispersion of responses. The consumer sentiment indicators may also be combined with the business sentiment indicators to create general sentiment indicators, in the same way in which the European Commission creates its Economic Sentiment Index.

The second contribution was to produce new composite indicators of confidence and uncertainty for South Africa, which are reported in the Appendix below. The sectoral indicators are available on request. The third contribution was to use these indicators to contribute to the literature on the relationship between sentiment and real economic activity in the South African setting. The results indicated that both sets of sentiment indicators contained significant predictive information for real economic activity. 

The indicators may be useful for a range of further applications. For instance, the confidence indicators might be useful for forecasting and nowcasting exercises, especially given that they are available before official statistics are published. The BER BCI is often used as a leading indicator of the business cycle, for example, by the SARB and @Laubscher2014. The new confidence indicators, which have higher correlations with real GDP growth and higher concordance with the business cycle, may be useful as improved leading indicators of the business cycle. The uncertainty indicator could be used to further investigate the importance of uncertainty shocks for business cycle fluctuations and credit cycles, and whether this relationship is non-linear or asymmetric. It may be used to inform other analyses, such as the influence of uncertainty on the responsiveness of exports to relative price changes, studied in @Hlatshwayo2016. Moreover, it may be informative to investigate the factors that drive the indicators of sentiment. The new sentiment indicators created in this chapter may facilitate these inquiries.

\newpage
##Appendix
```{r ap2, echo=FALSE, results='asis',warning=FALSE, message=FALSE, cache = TRUE, fig.pos='H'}
setwd("C:\\Users\\Laurie\\OneDrive\\Documents\\BING\\BER Confidence Surveys\\Sentiment")
suppressMessages(library(xtable))

conf_indices <- read.csv2("conf_indices.csv")[,-1]
uncert_indices <- read.csv2("uncert_indices.csv")[,-1]

colnames(conf_indices)[2:3] <- c("Confidence_Current","Confidence_Expected")
colnames(uncert_indices)[7] <- c("Uncertainty_Combined")

all_indices <- cbind(conf_indices[,c(1:3)],uncert_indices[,c(2:4,7)])
xt <- xtable(all_indices[1:48,], caption="Sentiment indicators")
print(xt, "latex",comment=FALSE, include.rownames=FALSE,
      caption.placement = getOption("xtable.caption.placement", "top"),scalebox=0.6)
```

\newpage
```{r ap3, echo=FALSE, results='asis',warning=FALSE, message=FALSE, cache = TRUE}
setwd("C:\\Users\\Laurie\\OneDrive\\Documents\\BING\\BER Confidence Surveys\\Sentiment")
suppressMessages(library(xtable))

conf_indices <- read.csv2("conf_indices.csv")[,-1]
uncert_indices <- read.csv2("uncert_indices.csv")[,-1]

colnames(conf_indices)[2:3] <- c("Confidence_Current","Confidence_Expected")
colnames(uncert_indices)[7] <- c("Uncertainty_Combined")

all_indices <- cbind(conf_indices[,c(1:3)],uncert_indices[,c(2:4,7)])
xt <- xtable(all_indices[48:99,])
print(xt, "latex",comment=FALSE, include.rownames=FALSE,
      scalebox=0.6)
```


\newpage
#References



